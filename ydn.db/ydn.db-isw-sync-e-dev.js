(function (name, definition, context) {if (typeof context['module'] !== 'undefined' && context['module']['exports']) {context['module']['exports'] = definition.apply(context);}else if (typeof context['define'] !== 'undefined' && context['define'] === 'function' && context['define']['amd']) {define(name, [], definition);}else {context[name] = definition();}})('ydn', function () {var l,aa=aa||{},t=this;function u(a){return void 0!==a}function ba(a){a=a.split(".");for(var b=t,c;c=a.shift();)if(null!=b[c])b=b[c];else return null;return b}function ca(){}
function da(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function v(a){return"array"==da(a)}function w(a){var b=da(a);return"array"==b||"object"==b&&"number"==typeof a.length}function x(a){return"string"==typeof a}function ea(a){return"boolean"==typeof a}function y(a){return"number"==typeof a}function fa(a){return"function"==da(a)}function A(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ga="closure_uid_"+(1E9*Math.random()>>>0),ha=0;
function ia(a,b,c){return a.call.apply(a.bind,arguments)}function ja(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function ka(a,b,c){ka=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja;return ka.apply(null,arguments)}var la=Date.now||function(){return+new Date};
function ma(a,b){var c=a.split("."),d=t;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&u(b)?d[e]=b:d[e]?d=d[e]:d=d[e]={}}function B(a,b){function c(){}c.prototype=b.prototype;a.l=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Sc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};function na(a){a.prototype.then=a.prototype.then;a.prototype.$goog_Thenable=!0}function pa(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}};function qa(a){if(Error.captureStackTrace)Error.captureStackTrace(this,qa);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}B(qa,Error);qa.prototype.name="CustomError";var ra;function sa(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}function ta(a){return/^[\s\xa0]*$/.test(a)}var ua=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};
function va(a){if(!wa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(xa,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(ya,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(za,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Aa,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(Ca,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(Da,"&#0;"));return a}var xa=/&/g,ya=/</g,za=/>/g,Aa=/"/g,Ca=/'/g,Da=/\x00/g,wa=/[\x00&<>"']/;
function Ea(a){for(var b=0;1>b;b++)if('"'==a.charAt(0)&&'"'==a.charAt(a.length-1))return a.substring(1,a.length-1);return a}var Fa={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"},Ga={"'":"\\'"};
function Ha(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0),f=c+1,g;if(!(g=Fa[d])){if(!(31<e&&127>e))if(d in Ga)d=Ga[d];else if(d in Fa)d=Ga[d]=Fa[d];else{e=d;g=d.charCodeAt(0);if(31<g&&127>g)e=d;else{if(256>g){if(e="\\x",16>g||256<g)e+="0"}else e="\\u",4096>g&&(e+="0");e+=g.toString(16).toUpperCase()}d=Ga[d]=e}g=d}b[f]=g}b.push('"');return b.join("")}function Ia(a,b){return a<b?-1:a>b?1:0};function Ja(a,b){b.unshift(a);qa.call(this,sa.apply(null,b));b.shift()}B(Ja,qa);Ja.prototype.name="AssertionError";function Ka(a,b){throw new Ja("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1));};var La=Array.prototype,Ma=La.indexOf?function(a,b,c){return La.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(x(a))return x(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Na=La.forEach?function(a,b,c){La.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},Oa=La.map?function(a,b,c){return La.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=
x(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Pa=La.some?function(a,b,c){return La.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1},Qa=La.every?function(a,b,c){return La.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};function Ra(a,b){var c=Sa(a,b,void 0);return 0>c?null:x(a)?a.charAt(c):a[c]}
function Sa(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1}function Ta(a,b){return 0<=Ma(a,b)}function Ua(a){if(!v(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0}function Va(a,b){var c=Ma(a,b),d;(d=0<=c)&&La.splice.call(a,c,1);return d}function Wa(a){return La.concat.apply(La,arguments)}function Xa(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}
function Ya(a,b){if(!w(a)||!w(b)||a.length!=b.length)return!1;for(var c=a.length,d=Za,e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}function Za(a,b){return a===b};var $a;a:{var ab=t.navigator;if(ab){var bb=ab.userAgent;if(bb){$a=bb;break a}}$a=""}function cb(a){return-1!=$a.indexOf(a)};function db(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function eb(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function fb(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function gb(a,b){for(var c=w(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],u(a));c++);return a}var hb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
function ib(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<hb.length;f++)c=hb[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function jb(a){var b=arguments.length;if(1==b&&v(arguments[0]))return jb.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};function lb(a){t.setTimeout(function(){throw a;},0)}var mb;
function nb(){var a=t.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&(a=function(){var a=document.createElement("iframe");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=ka(function(a){if(("*"==d||a.origin==d)&&a.data==c)this.port1.onmessage()},
this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!cb("Trident")&&!cb("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(u(c.next)){c=c.next;var a=c.Wb;c.Wb=null;a()}};return function(a){d.next={Wb:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("script")?function(a){var b=document.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=
null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){t.setTimeout(a,0)}};function ob(a,b){pb||qb();rb||(pb(),rb=!0);sb.push(new tb(a,b))}var pb;function qb(){if(t.Promise&&t.Promise.resolve){var a=t.Promise.resolve();pb=function(){a.then(ub)}}else pb=function(){var a=ub;!fa(t.setImmediate)||t.Window&&t.Window.prototype.setImmediate==t.setImmediate?(mb||(mb=nb()),mb(a)):t.setImmediate(a)}}var rb=!1,sb=[];function ub(){for(;sb.length;){var a=sb;sb=[];for(var b=0;b<a.length;b++){var c=a[b];try{c.a.call(c.b)}catch(d){lb(d)}}}rb=!1}function tb(a,b){this.a=a;this.b=b};function vb(a,b){this.b=wb;this.f=void 0;this.a=this.c=null;this.d=this.e=!1;try{var c=this;a.call(b,function(a){xb(c,yb,a)},function(a){if(!(a instanceof zb))try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}xb(c,Ab,a)})}catch(d){xb(this,Ab,d)}}var wb=0,yb=2,Ab=3;vb.prototype.then=function(a,b,c){return Cb(this,fa(a)?a:null,fa(b)?b:null,c)};na(vb);function Db(a){a.b==wb&&ob(function(){var a=new zb(void 0);Eb(this,a)},a)}
function Eb(a,b){if(a.b==wb)if(a.c){var c=a.c;if(c.a){for(var d=0,e=-1,f=0,g;g=c.a[f];f++)if(g=g.Ga)if(d++,g==a&&(e=f),0<=e&&1<d)break;0<=e&&(c.b==wb&&1==d?Eb(c,b):(d=c.a.splice(e,1)[0],Fb(c,d,Ab,b)))}}else xb(a,Ab,b)}function Gb(a,b){a.a&&a.a.length||a.b!=yb&&a.b!=Ab||Hb(a);a.a||(a.a=[]);a.a.push(b)}
function Cb(a,b,c,d){var e={Ga:null,bc:null,ec:null};e.Ga=new vb(function(a,g){e.bc=b?function(c){try{var e=b.call(d,c);a(e)}catch(m){g(m)}}:a;e.ec=c?function(b){try{var e=c.call(d,b);!u(e)&&b instanceof zb?g(b):a(e)}catch(m){g(m)}}:g});e.Ga.c=a;Gb(a,e);return e.Ga}vb.prototype.g=function(a){this.b=wb;xb(this,yb,a)};vb.prototype.k=function(a){this.b=wb;xb(this,Ab,a)};
function xb(a,b,c){if(a.b==wb){if(a==c)b=Ab,c=new TypeError("Promise cannot resolve to itself");else{if(pa(c)){a.b=1;c.then(a.g,a.k,a);return}if(A(c))try{var d=c.then;if(fa(d)){Ib(a,c,d);return}}catch(e){b=Ab,c=e}}a.f=c;a.b=b;Hb(a);b!=Ab||c instanceof zb||Jb(a,c)}}function Ib(a,b,c){function d(b){f||(f=!0,a.k(b))}function e(b){f||(f=!0,a.g(b))}a.b=1;var f=!1;try{c.call(b,e,d)}catch(g){d(g)}}function Hb(a){a.e||(a.e=!0,ob(a.m,a))}
vb.prototype.m=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=0;b<a.length;b++)Fb(this,a[b],this.b,this.f)}this.e=!1};function Fb(a,b,c,d){if(c==yb)b.bc(d);else{if(b.Ga)for(;a&&a.d;a=a.c)a.d=!1;b.ec(d)}}function Jb(a,b){a.d=!0;ob(function(){a.d&&Kb.call(null,b)})}var Kb=lb;function zb(a){qa.call(this,a)}B(zb,qa);zb.prototype.name="cancel";/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
*/
function E(a,b){this.k=[];this.H=b||null;this.b=this.c=!1;this.d=void 0;this.ca=this.v=this.m=!1;this.f=0;this.g=null;this.G=0}l=E.prototype;l.Ta=function(a,b){this.m=!1;Lb(this,a,b)};function Lb(a,b,c){a.c=!0;a.d=c;a.b=!b;a.Db()}function Mb(a){if(a.c){if(!a.ca)throw new Nb;a.ca=!1}}l.j=function(a){Mb(this);Lb(this,!0,a)};l.h=function(a){Mb(this);Lb(this,!1,a)};l.R=function(a,b){return G(this,a,null,b)};l.yb=function(a,b){return G(this,null,a,b)};l.Q=function(a,b){return G(this,a,a,b)};
function G(a,b,c,d){a.k.push([b,c,d]);a.c&&a.Db();return a}l.then=function(a,b,c){var d,e,f=new vb(function(a,b){d=a;e=b});G(this,d,function(a){e(a)});return f.then(a,b,c)};na(E);function Ob(a){return Pa(a.k,function(a){return fa(a[1])})}
E.prototype.Db=function(){this.f&&this.c&&Ob(this)&&(Pb(this.f),this.f=0);this.g&&(this.g.G--,delete this.g);for(var a=this.d,b=!1,c=!1;this.k.length&&!this.m;){var d=this.k.shift(),e=d[0],f=d[1],d=d[2];if(e=this.b?f:e)try{var g=e.call(d||this.H,a);u(g)&&(this.b=this.b&&(g==a||g instanceof Error),this.d=a=g);pa(a)&&(this.m=c=!0)}catch(h){a=h,this.b=!0,Ob(this)||(b=!0)}}this.d=a;c&&(c=ka(this.Ta,this,!0),g=ka(this.Ta,this,!1),a instanceof E?(G(a,c,g),a.v=!0):a.then(c,g));b&&(a=new Qb(a),Rb[a.$a]=a,
this.f=a.$a)};function Sb(a){var b=new E;b.j(a);return b}function Nb(){qa.call(this)}B(Nb,qa);Nb.prototype.message="Deferred has already fired";Nb.prototype.name="AlreadyCalledError";function Qb(a){this.$a=t.setTimeout(ka(this.b,this),0);this.a=a}Qb.prototype.b=function(){delete Rb[this.$a];throw this.a;};var Rb={};function Pb(a){var b=Rb[a];b&&(t.clearTimeout(b.$a),delete Rb[a])};function H(a){qa.call(this,a);this.name="ydn.error.ArgumentException"}B(H,qa);function Tb(a){qa.call(this,a);this.name="ydn.error.NotSupportedException"}B(Tb,qa);function Ub(a){qa.call(this,a);this.name="ydn.error.NotImplementedException"}B(Ub,qa);function Vb(a){qa.call(this,a);this.name="ydn.error.InvalidOperationException"}B(Vb,qa);
function Wb(a){Error.captureStackTrace?Error.captureStackTrace(this,Wb):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}B(Wb,Error);Wb.prototype.name="ydn.error.InternalError";function Xb(a){if("function"==typeof a.u)return a.u();if(x(a))return a.split("");if(w(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return eb(a)}function Yb(a,b){if("function"==typeof a.forEach)a.forEach(b,void 0);else if(w(a)||x(a))Na(a,b,void 0);else{var c;if("function"==typeof a.C)c=a.C();else if("function"!=typeof a.u)if(w(a)||x(a)){c=[];for(var d=a.length,e=0;e<d;e++)c.push(e)}else c=fb(a);else c=void 0;for(var d=Xb(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}};var Zb="StopIteration"in t?t.StopIteration:Error("StopIteration");function $b(){}$b.prototype.next=function(){throw Zb;};$b.prototype.Ea=function(){return this};function ac(a){if(a instanceof $b)return a;if("function"==typeof a.Ea)return a.Ea(!1);if(w(a)){var b=0,c=new $b;c.next=function(){for(;;){if(b>=a.length)throw Zb;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");}
function bc(a,b){if(w(a))try{Na(a,b,void 0)}catch(c){if(c!==Zb)throw c;}else{a=ac(a);try{for(;;)b.call(void 0,a.next(),void 0,a)}catch(d){if(d!==Zb)throw d;}}};function cc(a,b){this.b={};this.a=[];this.d=this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)ec(this,arguments[d],arguments[d+1])}else if(a){a instanceof cc?(c=a.C(),d=a.u()):(c=fb(a),d=eb(a));for(var e=0;e<c.length;e++)ec(this,c[e],d[e])}}l=cc.prototype;l.r=function(){return this.c};l.u=function(){fc(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};l.C=function(){fc(this);return this.a.concat()};
l.Z=function(){return 0==this.c};l.clear=function(){this.b={};this.d=this.c=this.a.length=0};function gc(a,b){return hc(a.b,b)?(delete a.b[b],a.c--,a.d++,a.a.length>2*a.c&&fc(a),!0):!1}function fc(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];hc(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){for(var e={},c=b=0;b<a.a.length;)d=a.a[b],hc(e,d)||(a.a[c++]=d,e[d]=1),b++;a.a.length=c}}l.get=function(a,b){return hc(this.b,a)?this.b[a]:b};
function ec(a,b,c){hc(a.b,b)||(a.c++,a.a.push(b),a.d++);a.b[b]=c}l.forEach=function(a,b){for(var c=this.C(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};l.clone=function(){return new cc(this)};l.Ea=function(a){fc(this);var b=0,c=this.a,d=this.b,e=this.d,f=this,g=new $b;g.next=function(){for(;;){if(e!=f.d)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw Zb;var g=c[b++];return a?g:d[g]}};return g};
function hc(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function ic(a){this.a=new cc;if(a){a=Xb(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])}}function jc(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+(a[ga]||(a[ga]=++ha)):b.substr(0,1)+a}l=ic.prototype;l.r=function(){return this.a.r()};l.add=function(a){ec(this.a,jc(a),a)};l.ka=function(a){return gc(this.a,jc(a))};l.clear=function(){this.a.clear()};l.Z=function(){return this.a.Z()};l.contains=function(a){a=jc(a);return hc(this.a.b,a)};l.u=function(){return this.a.u()};l.clone=function(){return new ic(this)};
l.Ea=function(){return this.a.Ea(!1)};var kc=cb("Opera")||cb("OPR"),lc=cb("Trident")||cb("MSIE"),mc=cb("Gecko")&&-1==$a.toLowerCase().indexOf("webkit")&&!(cb("Trident")||cb("MSIE")),nc=-1!=$a.toLowerCase().indexOf("webkit");nc&&cb("Mobile");cb("Macintosh");cb("Windows");cb("Linux");var oc=t.navigator||null;oc&&(oc.appVersion||"").indexOf("X11");cb("Android");!cb("iPhone")||cb("iPod")||cb("iPad");cb("iPad");function pc(){var a=t.document;return a?a.documentMode:void 0}
var qc=function(){var a="",b;if(kc&&t.opera)return a=t.opera.version,fa(a)?a():a;mc?b=/rv\:([^\);]+)(\)|;)/:lc?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:nc&&(b=/WebKit\/(\S+)/);b&&(a=(a=b.exec($a))?a[1]:"");return lc&&(b=pc(),b>parseFloat(a))?String(b):a}(),rc={};
function sc(a){var b;if(!(b=rc[a])){b=0;for(var c=ua(String(qc)).split("."),d=ua(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",k=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var n=k.exec(g)||["","",""],p=m.exec(h)||["","",""];if(0==n[0].length&&0==p[0].length)break;b=Ia(0==n[1].length?0:parseInt(n[1],10),0==p[1].length?0:parseInt(p[1],10))||Ia(0==n[2].length,0==p[2].length)||Ia(n[2],p[2])}while(0==b)}b=rc[a]=0<=b}return b}
var tc=t.document,uc=tc&&lc?pc()||("CSS1Compat"==tc.compatMode?parseInt(qc,10):5):void 0;function vc(a){var b;b||(b=wc(a||arguments.callee.caller,[]));return b}
function wc(a,b){var c=[];if(Ta(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(xc(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=xc(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(wc(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?
c.push("[...long stack...]"):c.push("[end]");return c.join("")}function xc(a){if(yc[a])return yc[a];a=String(a);if(!yc[a]){var b=/function ([^\(]+)/.exec(a);yc[a]=b?b[1]:"[Anonymous]"}return yc[a]}var yc={};function zc(a,b,c,d,e){"number"==typeof e||Ac++;this.f=d||la();this.e=a;this.d=b;this.c=c;delete this.b;delete this.a}zc.prototype.b=null;zc.prototype.a=null;var Ac=0;function Bc(a){this.e=a;this.a=this.d=this.b=this.c=null}function Cc(a,b){this.name=a;this.value=b}Cc.prototype.toString=function(){return this.name};var Dc=new Cc("SHOUT",1200),Ec=new Cc("SEVERE",1E3),Fc=new Cc("WARNING",900),Gc=new Cc("INFO",800),Hc=new Cc("CONFIG",700),Ic=new Cc("FINE",500),Jc=new Cc("FINER",400),Kc=new Cc("FINEST",300),Lc=[new Cc("OFF",Infinity),Dc,Ec,Fc,Gc,Hc,Ic,Jc,Kc,new Cc("ALL",0)],Mc=null;Bc.prototype.getName=function(){return this.e};
function Nc(a){if(a.b)return a.b;if(a.c)return Nc(a.c);Ka("Root logger has no level set.");return null}Bc.prototype.log=function(a,b,c){if(a.value>=Nc(this).value)for(fa(b)&&(b=b()),a=this.f(a,b,c,Bc.prototype.log),b="log:"+a.d,t.console&&(t.console.timeStamp?t.console.timeStamp(b):t.console.markTimeline&&t.console.markTimeline(b)),t.msWriteProfilerMark&&t.msWriteProfilerMark(b),b=this;b;){c=b;var d=a;if(c.a)for(var e=0,f=void 0;f=c.a[e];e++)f(d);b=b.c}};
Bc.prototype.f=function(a,b,c,d){var e=new zc(a,String(b),this.e);if(c){var f;f=d||arguments.callee.caller;e.b=c;var g;try{var h;var k=ba("window.location.href");if(x(c))h={message:c,name:"Unknown error",lineNumber:"Not available",fileName:k,stack:"Not available"};else{var m,n,p=!1;try{m=c.lineNumber||c.Tc||"Not available"}catch(q){m="Not available",p=!0}try{n=c.fileName||c.filename||c.sourceURL||t.$googDebugFname||k}catch(r){n="Not available",p=!0}h=!p&&c.lineNumber&&c.fileName&&c.stack&&c.message&&
c.name?c:{message:c.message||"Not available",name:c.name||"UnknownError",lineNumber:m,fileName:n,stack:c.stack||"Not available"}}g="Message: "+va(h.message)+'\nUrl: <a href="view-source:'+h.fileName+'" target="_new">'+h.fileName+"</a>\nLine: "+h.lineNumber+"\n\nBrowser stack:\n"+va(h.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+va(vc(f)+"-> ")}catch(z){g="Exception trying to expose exception! You win, we lose. "+z}e.a=g}return e};function Oc(a,b){a.log(Ec,b,void 0)}
Bc.prototype.config=function(a,b){this.log(Hc,a,b)};var Pc={},Qc=null;function Rc(){Qc||(Qc=new Bc(""),Pc[""]=Qc,Qc.b=Hc)}function Sc(){Rc();return Qc}function I(a){Rc();var b;if(!(b=Pc[a])){b=new Bc(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=I(a.substr(0,c));c.d||(c.d={});c.d[d]=b;b.c=c;Pc[a]=b}return b};function Tc(a,b,c){a&&a.log(b,c,void 0)}function K(a,b){a&&a.log(Fc,b,void 0)}function L(a,b){a&&a.log(Ic,b,void 0)};function M(a,b){a&&a.log(Kc,b,void 0)}function N(a,b){a&&a.log(Jc,b,void 0)};function Uc(a,b){E.call(this,0,b);this.e=[]}B(Uc,E);Uc.prototype.pa=function(a,b){this.e.push([a,b]);return this};function Vc(a,b){for(var c=0;c<a.e.length;c++)a.e[c][0].call(a.e[c][1],b)}Uc.prototype.j=function(a){this.e.length=0;Uc.l.j.call(this,a)};Uc.prototype.h=function(a){this.e.length=0;Uc.l.h.call(this,a)};Uc.prototype.ra=function(){return this};var Wc={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"},Xc=Wc.READ_ONLY,O=Wc.READ_WRITE,Yc=Wc.VERSION_CHANGE,Zc=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.moz_indexedDB||t.msIndexedDB;E.prototype.done=E.prototype.R;E.prototype.fail=E.prototype.yb;E.prototype.always=E.prototype.Q;Uc.prototype.then=Uc.prototype.then;function $c(a,b){var c,d;2==arguments.length&&x(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=w(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],u(a));c++);return a}function ad(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)A(a[e])||(a[e]={}),a=a[e];a[d]=c}}var bd={};
function cd(a){var b=[a];a=new dd;for(var c=0,d,e;void 0!==(e=b.pop());){0===c%4&&12<c+4&&(a.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=4,0<e.length){b.push(bd);for(d=e.length;d--;)b.push(e[d]);continue}else a.write(c);else if("number"===d)c+=1,a.write(c),ed(a,e);else if(e instanceof Date)c+=2,a.write(c),ed(a,e.valueOf());else if("string"===d){c+=3;a.write(c);c=a;for(d=0;d<e.length;d++){var f=e.charCodeAt(d);126>=f?c.write(f+1):16510>=f?(f-=127,c.write(128|f>>8,f&255)):c.write(192|f>>10,
f>>2|255,(f|3)<<6)}c.write(0)}else if(e===bd)a.write(0);else return"";c=0}for(b=a.a.length;"00"===a.a[--b];);a.a.length=++b;return a.toString()}function fd(a){for(var b=[],c=b,d=[],e,f,g=new gd(a);null!=hd(g);)if(0===g.a)c=d.pop();else{if(null===g.a)break;do{e=g.a/4|0;a=g.a%4;for(var h=0;h<e;h++)f=[],c.push(f),d.push(c),c=f;if(0===a&&12<g.a+4)hd(g);else break}while(1);1===a?c.push(id(g)):2===a?c.push(new Date(id(g))):3===a?c.push(jd(g)):0===a&&(c=d.pop())}return b[0]}
function ed(a,b){var c,d,e;c=b;var f=e=d=0;if(0!==c)if(isFinite(c)){0>c&&(d=1,c=-c);f=0;if(2.2250738585072014E-308<=c){for(e=c;1>e;)f--,e*=2;for(;2<=e;)f++,e/=2;e=f+1023}f=e?Math.floor(4503599627370496*(c/Math.pow(2,f)-1)):Math.floor(c/4.9E-324)}else e=2047,isNaN(c)?f=0x8000000000000:-Infinity===c&&(d=1);c=d;d=e;e=f;c&&(e=0xfffffffffffff-e,d=2047-d);a.write((c?0:128)|d>>4);a.write((d&15)<<4|0|e/281474976710656);e%=281474976710656;c=0|e/4294967296;a.write(c>>8,c&255);e%=4294967296;c=0|e/65536;a.write(c>>
8,c&255);c=e%65536;a.write(c>>8,c&255)}function id(a){var b=hd(a)|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=hd(a)|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(hd(a)|0):hd(a)|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d}
function jd(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=hd(a);if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")}function gd(a){this.a=null;this.b=a;this.c=this.b.length-1;this.index=-1}function hd(a){return a.a=a.index<a.c?parseInt(a.b.charAt(++a.index)+a.b.charAt(++a.index),16):null}
function dd(){this.a=[];this.b=void 0}dd.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.b=arguments[b].toString(16),this.a.push(2===this.b.length?this.b:this.b="0"+this.b)};dd.prototype.toString=function(){return this.a.length?this.a.join(""):""};function kd(a,b){var c=cd(a),d=cd(b);return c>d?1:c==d?0:-1};function ld(a,b,c){Uc.call(this,0,c);this.p=a;this.e=[];this.n=[];this.ea=[];this.a=null;this.Aa="";this.K=0}B(ld,Uc);l=ld.prototype;l.Aa="";l.logger=I("ydn.db.Request");function md(a,b,c){a.a=b;a.Aa=c;N(a.logger,a+" BEGIN");if(b){for(c=0;c<a.n.length;c++)a.n[c][0].call(a.n[c][1],b);a.n.length=0}}function nd(a){var b=new ld(a.p);a.K++;md(b,a.a,a.Aa+"C"+a.K);return b}function od(a){N(a.logger,a+" END");a.a=null}l.Gb=function(){return this.p};l.mc=function(){return!!this.a};
l.abort=function(){N(this.logger,this+" aborting "+this.a);if(this.a)if(fa(this.a.abort))this.a.abort();else if(fa(this.a.executeSql))this.a.executeSql("ABORT",[],function(){},function(){return!0});else throw new Tb;else throw new pd(this+" No active transaction");};function P(a,b,c){var d=a.ea.shift();c=!!c;d?d[0].call(d[1],b,c,function(b,c){P(a,b,c)}):c?a.h(b):a.j(b)}function qd(a,b,c){a.ea.push([b,c])}function Q(a,b,c){a.a?b.call(c,a.a):a.n.push([b,c])}
l.j=function(a){N(this.logger,this+" SUCCESS");ld.l.j.call(this,a)};l.h=function(a){N(this.logger,this+" ERROR");ld.l.h.call(this,a)};l.state=function(){return this.c?this.b?"rejected":"resolved":"pending"};function R(a){var b="";a.Aa&&(b=a.a?"*":"",b="["+a.Aa+b+"]");return a.p+b}function rd(a,b){var c=new ld(a);P(c,b);return c}l.toString=function(){return"Request:"+R(this)};
l.Db=function(){this.f&&this.c&&Ob(this)&&(Pb(this.f),this.f=0);this.g&&(this.g.G--,delete this.g);for(var a=this.d,b=!1;this.k.length&&!this.m;){var c=this.k.shift(),d=c[0],e=c[1],c=c[2];if(d=this.b?e:d)d=d.call(c||this.H,a),u(d)&&(this.b=this.b&&(d==a||d instanceof Error),this.d=a=d),pa(a)&&(this.m=b=!0)}this.d=a;b&&(b=ka(this.Ta,this,!0),d=ka(this.Ta,this,!1),a instanceof E?(G(a,b,d),a.v=!0):a.then(b,d))};
l.toJSON=function(){var a=(this.Aa||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.p?this.p.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};var sd=Zc&&Zc.cmp?ka(Zc.cmp,Zc):kd,td=[];function ud(){0!=vd&&(wd[this[ga]||(this[ga]=++ha)]=this);this.e=this.e;this.v=this.v}var vd=0,wd={};ud.prototype.e=!1;ud.prototype.ga=function(){if(!this.e&&(this.e=!0,this.D(),0!=vd)){var a=this[ga]||(this[ga]=++ha);delete wd[a]}};ud.prototype.D=function(){if(this.v)for(;this.v.length;)this.v.shift()()};function xd(a,b){this.type=a;this.a=this.target=b;this.fc=!0}xd.prototype.ga=function(){};xd.prototype.preventDefault=function(){this.fc=!1};function yd(a,b){xd.call(this,a,b)}B(yd,xd);yd.prototype.c=function(){return this.b};function zd(a,b,c,d,e){xd.call(this,a,b);this.version=c;this.jc=d;this.ac=e}B(zd,yd);l=zd.prototype;l.name="ReadyEvent";l.version=NaN;l.jc=NaN;l.ac=null;l.Ic=function(){return this.version};l.qc=function(){return this.jc};l.pc=function(){return this.ac};function Ad(a,b,c){xd.call(this,c||"error",a);this.error=b}B(Ad,yd);Ad.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};
Ad.prototype.name="ErrorEvent";Ad.prototype.error=null;Ad.prototype.d=function(){return this.error};function Bd(a,b){Ad.call(this,a,b,"fail")}B(Bd,Ad);Bd.prototype.name="FailEvent";function Cd(a,b,c,d,e){xd.call(this,a,b);this.b=c;this.key=d;this.value=e}B(Cd,yd);Cd.prototype.name="RecordEvent";Cd.prototype.d=function(){return this.key};Cd.prototype.e=function(){return this.value};function Dd(a,b,c,d,e){xd.call(this,a,b);this.b=c;this.keys=d;this.N=e}B(Dd,yd);Dd.prototype.name="StoreEvent";
Dd.prototype.C=function(){return this.keys};Dd.prototype.u=function(){return this.N};function T(a,b,c){var d;if(A(a))d=a.store,b=a.id,null!=a.parent&&(c=new T(a.parent));else if(u(b))d=a;else if(d=a.lastIndexOf("^|"),b=a,0<d&&(b=a.substr(d),c=new T(a.substring(0,d))),b=b.split("^:"),d=b[0],b=b[1],!u(b))throw Error("Invalid key value: "+a);this.a=d;this.id=b;this.parent=c||null}l=T.prototype;l.toJSON=function(){var a={store:this.a,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};l.valueOf=function(){return(this.parent?this.parent.valueOf()+"^|":"")+this.a+"^:"+this.id};
l.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};l.Gc=function(){return this.a};l.Ec=function(){return this.id};function Ed(a){return v(a.id)?a.id.join("^|"):a.id instanceof Date?+a.id:a.id}l.Fc=function(){return this.parent};function Fd(a){if(w(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};function U(a,b,c,d){a>b&&(b=a=void 0);null===a&&(a=void 0);null===b&&(b=void 0);this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d}U.prototype.lower=void 0;U.prototype.upper=void 0;U.prototype.toJSON=function(){var a;a=this||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}};function Gd(a){return Hd(a)}U.only=function(a){return new U(a,a,!1,!1)};U.bound=function(a,b,c,d){return new U(a,b,c,d)};U.upperBound=function(a,b){return new U(void 0,a,void 0,!!b)};
U.lowerBound=function(a,b){return new U(a,void 0,!!b,void 0)};function Hd(a){return null!=a?null!=a.upper&&null!=a.lower?Id.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):null!=a.upper?Id.upperBound(a.upper,a.upperOpen):null!=a.lower?Id.lowerBound(a.lower,a.lowerOpen):null:null}
function Jd(a){if(a instanceof U)return"";if(null!=a){if(A(a)){for(var b in a)if(a.hasOwnProperty(b)&&!Ta(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""}
function Kd(a,b,c,d,e){if(c)if(c.lowerOpen||c.upperOpen||null==c.lower||null==c.upper||0!==sd(c.lower,c.upper)){if(null!=c.lower){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(Ld(c.lower,b))}null!=c.upper&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(Ld(c.upper,b)))}else d.push(a+" = ?"),e.push(Ld(c.lower,b))}var Id=t.IDBKeyRange||t.webkitIDBKeyRange||U;function Md(a,b,c,d,e,f){u(e)||(e=v(a)?a.join(", "):a);if(null!=a&&!x(a)&&!w(a))throw new H("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);v(a)&&Object.freeze&&Object.freeze(a);!u(a)&&u(e)&&(a=e);this.keyPath=a;this.f=w(this.keyPath);this.a=e;this.type=Nd(b);if(u(b)){if(!u(this.type))throw new H("type invalid in index: "+this.a);if(v(this.keyPath))throw new H('composite key for store "'+this.a+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.g=x(this.type)?
this.type:Od;this.e=x(e)?e:v(a)?this.keyPath.join(","):a;this.c=Ha(this.e);this.b=this.f?null:this.keyPath.split(".");this.d=f||null}function Pd(a,b){if(null!=b){if(w(a.keyPath)){for(var c=[],d=0,e=a.keyPath.length;d<e;d++){var f=$c(b,a.keyPath[d]);c[d]=f}return c}return $c(b,a.keyPath)}}function Qd(a,b,c){for(var d=0;d<a.b.length;d++)d==a.b.length-1?b[a.b[d]]=c:A(b[a.b[d]])||(b[a.b[d]]={})}var Od="TEXT";function Ld(a,b){if("DATE"==b){if(a instanceof Date)return+a}else return null!=b?a:cd(a)}
function Rd(a,b){return"DATE"==b?new Date(a):u(b)?a:fd(a)}var Sd=["BLOB","DATE","INTEGER","NUMERIC",Od];function Nd(a){if(x(a))return a=Ma(Sd,a),Sd[a]}l=Md.prototype;l.getName=function(){return this.a};l.toJSON=function(){return{name:this.a,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};l.clone=function(){var a=v(this.keyPath)?Xa(this.keyPath):this.keyPath;return new Md(a,this.type,this.unique,this.multiEntry,this.a,this.d)};
function Td(a,b){return null!=a||null!=b?null!=a?null!=b?w(a)&&w(b)?Ya(a,b)?null:"expect: "+a+", but: "+b:Ud(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null}l.hint=function(a){if(!a)return this;var b=v(this.keyPath)?Xa(this.keyPath):this.keyPath,c=this.type;u(a.type)||"TEXT"!=c||(c=void 0);return new Md(b,c,this.unique,this.multiEntry,a.a)};function Vd(a,b){a.d=b}
l.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.b&&1<this.b.length&&(a+="Compound");return a+"Index:"+this.a};function Wd(a,b,c,d,e,f,g,h){if(!x(a))throw new H("store name must be a string");this.d=a;this.keyPath=u(b)?b:null;this.m=w(this.keyPath);if(null!==this.keyPath&&!x(this.keyPath)&&!this.m)throw new H("keyPath must be a string or array");if(null!=c&&!ea(c))throw new H('invalid autoIncrement value in store "'+a+'"');this.c=!!c;var k;if(null!=d){k=Nd(d);if(!u(k))throw new H('type "'+d+'" for primary key in store "'+this.d+'" is invalid.');if(this.m)throw new H('composite key for store "'+this.d+'" must not specified type');
}this.type=null!=k?k:this.c?"INTEGER":void 0;this.f=x(this.keyPath)?this.keyPath.split("."):[];this.a=e||[];this.fa=!!f;this.sa=!!g;this.p=x(this.type)?this.type:Od;this.g=v(this.keyPath)?this.keyPath.join(","):x(this.keyPath)?this.keyPath:"_ROWID_";this.e=Ha(this.g);if(this.n=!!h){if(this.keyPath)throw new H('encrypted store "'+this.d+'" must not use inline key');if(this.c)throw new H('encrypted store "'+this.d+'" must not use key generator');}this.k=[]}l=Wd.prototype;l.fa=!1;l.sa=!1;
l.toJSON=function(){for(var a=[],b=0;b<this.a.length;b++)a.push(this.a[b].toJSON());return{name:this.d,keyPath:this.keyPath,autoIncrement:this.c,type:this.type,indexes:a}};
function Xd(a){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==Ma(b,c))throw new H('Unknown attribute "'+c+'"');b=[];c=a.indexes||[];if(v(c))for(var d=0;d<c.length;d++){var e;e=c[d];var f="name unique type keyPath multiEntry generator".split(" "),g=void 0;for(g in e)if(e.hasOwnProperty(g)&&-1==Ma(f,g))throw new H("Unknown field: "+g+" in "+V(e));e=new Md(e.keyPath,e.type,e.unique,e.multiEntry,e.name,e.generator);
u(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new Wd(a.name,a.keyPath,a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)}function Yd(a,b,c,d,e,f,g){a=Zd(a,b,c,d,e,f,g);b="";0!=c&&(b+="SELECT "+a.select);b+=" FROM "+a.Ia;a.w&&(b+=" WHERE "+a.w);a.group&&(b+=" GROUP BY "+a.group);a.na&&(b+=" ORDER BY "+a.na);return b}
function Zd(a,b,c,d,e,f,g){var h={select:"",Ia:"",w:"",group:"",na:""},k=a.g,m=a.e,n=null;d!==k&&x(d)&&(n=$d(a,d));var p=!!n,q=d||k,r=Ha(q),z=p?n.type:a.type,C=p&&n.multiEntry;h.Ia=ae(a);6===c?h.select="COUNT("+m+")":3===c||1===c||2===c?(h.select=m,null!=d&&d!=k&&(h.select+=", "+r)):h.select="*";d=g?"DISTINCT ":"";k=[];C?(C=Ha("ydn.db.me:"+a.getName()+":"+n.getName()),h.select=6===c?"COUNT("+d+C+"."+r+")":3===c||1===c||2===c?"DISTINCT "+ae(a)+"."+m+", "+C+"."+r+" AS "+q:"DISTINCT "+ae(a)+".*, "+C+
"."+r+" AS "+q,h.Ia=C+" INNER JOIN "+ae(a)+" USING ("+m+")",null!=e&&(Kd(C+"."+r,z,e,k,b),0<k.length&&(h.w=h.w?h.w+(" AND "+k.join(" AND ")):k.join(" AND ")))):null!=e&&(Kd(r,z,e,k,b),0<k.length&&(h.w=h.w?h.w+(" AND "+k.join(" AND ")):k.join(" AND ")));p&&!n.unique&&g&&(h.group=r);a=f?"DESC":"ASC";h.na=r+" "+a;p&&(h.na+=", "+m+" "+a);return h}
function be(a,b,c,d,e,f,g,h){var k,m,n,p;null!=e?(k=e.lower,m=e.upper,n=e.lowerOpen,p=e.upperOpen,f?null!=m?(e=sd(h,m),-1==e?(m=h,p=!0):0==e&&(p=!0)):(m=h,p=!0):null!=k?(e=sd(h,k),1==e?(k=h,n=!0):0==e&&(n=!0)):(k=h,n=!0)):f?(m=h,p=!0):(k=h,n=!0);e=new U(k,m,!!n,!!p);d=d?$d(a,d):null;b=Zd(a,c,b,d?d.e:a.g,e,f,g);b="SELECT "+b.select+" FROM "+b.Ia+(b.w?" WHERE "+b.w:"")+(b.group?" GROUP BY "+b.group:"")+" ORDER BY "+b.na;d&&(b+=", "+a.e+(f?"DESC":"ASC"));return b}
function ce(a,b,c,d,e,f,g,h,k){var m=$d(a,d),n=m.e;d=m.c;var p=a.e,q;q=(h?" <":" >")+" ";m=Ld(f,m.type);g=Ld(g,a.type);var r="";e?(a=Zd(a,c,b,n,e,h,k),a.w+=" AND ",r=d+q+"?",c.push(m)):(e=h?U.upperBound(f,!0):U.lowerBound(f,!0),a=Zd(a,c,b,n,e,h,k),r=a.w,a.w="");a.w+="("+r+" OR ("+d+" = ? AND "+p+q+"?))";c.push(m);c.push(g);return"SELECT "+a.select+" FROM "+a.Ia+" WHERE "+a.w+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.na}l.clone=function(){return Xd(this.toJSON())};
l.index=function(a){return this.a[a]||null};function $d(a,b){return Ra(a.a,function(a){return a.getName()==b})}function de(a){for(var b=0;b<a.a.length;b++)if(!Td(a.a[b].keyPath,"updated.$t"))return a.a[b];return null}function ee(a,b){return b===a.keyPath?!0:Pa(a.a,function(a){return a.getName()==b})}function ae(a){return Ha(a.d)}
function ge(a,b){if(!b)return a;var c=a.c,d=v(a.keyPath)?Xa(a.keyPath):a.keyPath,e=a.type,f=Oa(a.a,function(a){return a.clone()});u(b.type)||"TEXT"!=e||(e=void 0);v(b.keyPath)&&x(d)&&d==b.keyPath.join(",")&&(d=Xa(b.keyPath));for(var g=0,h=b.a.length;g<h;g++)if(b.a[g].f)for(var k=b.a[g].getName(),m=f.length-1;0<=m;m--)if(0<=k.indexOf(f[m].getName())){f[m]=b.a[g].clone();break}for(g=0;g<f.length;g++)(h=$d(b,f[g].getName()))&&(f[g]=f[g].hint(h));return new Wd(b.d,d,c,e,f)}l.getName=function(){return this.d};
function he(a){return!!a.keyPath}function ie(a,b,c){if(b){if(!a.keyPath&&null!=c)return c;if(a.m){c=[];for(var d=0;d<a.keyPath.length;d++)c.push($c(b,a.keyPath[d]));return c}if(a.keyPath)return gb(b,a.f)}}function je(a,b,c){for(var d=0;d<a.f.length;d++){var e=a.f[d];if(d==a.f.length-1){b[e]=c;break}u(b[e])||(b[e]={});b=b[e]}}
function ke(a,b,c){var d=[],e=[];c=u(c)?c:ie(a,b);u(c)&&(e.push(a.e),d.push(Ld(c,a.type)));for(var f=0;f<a.a.length;f++){var g=a.a[f];if(!g.multiEntry&&g.getName()!==a.keyPath&&"_default_"!=g.getName()){var h=Pd(g,b);null!=h&&(d.push(Ld(h,g.type)),e.push(g.c))}}a.sa?a.sa&&!a.keyPath&&0==a.a.length&&(x(b)&&-1==b.indexOf(";base64,")?d.push(b):d.push(V(b)),e.push("_default_")):(d.push(V(b)),e.push("_default_"));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{oc:e,zc:a,N:d,key:c}}
function le(a,b){if(!b)return"missing store: "+a.d;if(a.d!=b.d)return"store name, expect: "+a.d+", but: "+b.d;var c=Td(a.keyPath,b.keyPath);if(c)return"keyPath, "+c;if(u(a.c)&&u(b.c)&&a.c!=b.c)return"autoIncrement, expect:  "+a.c+", but: "+b.c;if(a.a.length!=b.a.length)return"indexes length, expect:  "+a.a.length+", but: "+b.a.length;if(u(a.type)&&u(b.type)&&(w(a.type)?!Ya(a.type,b.type):a.type!=b.type))return"data type, expect:  "+a.type+", but: "+b.type;for(c=0;c<a.a.length;c++){var d=$d(b,a.a[c].getName()),
e;e=a.a[c];if(d)if(e.a!=d.a)e="name, expect: "+e.a+", but: "+d.a;else{var f=Td(e.keyPath,d.keyPath);e=f?"keyPath, "+f:null!=e.unique&&null!=d.unique&&e.unique!=d.unique?"unique, expect: "+e.unique+", but: "+d.unique:null!=e.multiEntry&&null!=d.multiEntry&&e.multiEntry!=d.multiEntry?"multiEntry, expect: "+e.multiEntry+", but: "+d.multiEntry:u(e.type)&&u(d.type)&&(w(e.type)?!Ya(e.type,d.type):e.type!=d.type)?"data type, expect: "+e.type+", but: "+d.type:""}else e="no index for "+e.a;if(0<e.length)return'index "'+
a.a[c].getName()+'" '+e}return""}function me(a,b){if(b)for(var c=0;c<a.a.length;c++){var d=a.a[c],e=b;if(d.d){var f=d.d(e),g=typeof f;if("string"==g||"number"==g||f instanceof Date||v(f)){for(g=0;g<d.b.length-1;g++)A(e[d.b[g]])||(e[d.b[g]]={});e[d.b[d.b.length-1]]=f}}}}function ne(a,b){a.k.push(b)}function oe(a,b,c,d,e){for(var f=0;f<a.k.length;f++)d!==f&&a.k[f].call(e,b,c)}l.toString=function(){return"Store:"+this.d+"["+this.a.length+"index]"};I("ydn");function pe(a){return!x(a)||ta(a)?{}:JSON.parse(a)}function qe(a){var b;try{b=V(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""}function V(a){return JSON.stringify(a,void 0,void 0)};function re(a,b){if(!a||ta(a))throw new H("store_name must be provided for primary full text index");if(!b||ta(b))throw new H("index_name must be provided for primary full text index");this.a=a};function se(a,b,c){this.name=a;this.a=b;this.b=c||"";if(-1==["","en","fr"].indexOf(this.b))throw new H('Unsupported lang "'+c+" for full text search index "+a);}se.prototype.getName=function(){return this.name};se.prototype.count=function(){return this.a.length};se.prototype.index=function(a){return this.a[a]};
function te(a){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==Ma(b,c))throw new H("Unknown field: "+c+" in "+V(a));if(!v(a.sources))throw new H("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==Ma(b,c))throw new H("Unknown field: "+c+" in "+qe(a));return new re(a.storeName,a.keyPath)});return new se(a.name,
b,a.lang)};function ue(a,b){var c,d,e=b;if(A(a)){d=a;c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==Ma(c,f))throw new H("Unknown field: "+f+" in schema.");c=d.version;var e=[],g=d.stores||[];if(!v(g))throw new H("stores must be array");for(f=0;f<g.length;f++){var h=Xd(g[f]);if(-1!=Sa(e,function(a){return a.name==h.getName()}))throw new H('duplicate store name "'+h.getName()+'".');e.push(h)}}else x(a)?c=0==a.length?void 0:parseFloat(a):y(a)&&(c=a);if(u(c)){if(!y(c)||0>c)throw new H("Invalid version: "+
c+" ("+a+")");isNaN(c)&&(c=void 0)}if(u(b)&&(!v(b)||0<b.length&&!(b[0]instanceof Wd)))throw new H("stores");this.version=c;this.c=!u(this.version);this.a=e||[];c=[];if(d&&d.fullTextCatalogs)for(f=0;f<d.fullTextCatalogs.length;f++)e=te(d.fullTextCatalogs[f]),c[f]=e,W(this,e.getName())||(g=[new Md("k",Od),new Md("v",Od)],e=new Wd(e.getName(),"id",!1,void 0,g,!1,!1,!1),this.a.push(e));this.d=c}
ue.prototype.toJSON=function(){var a=Oa(this.a,function(a){return a.toJSON()}),b={};b.stores=a;u(this.version)&&(b.version=this.version);return b};ue.prototype.c=!1;ue.prototype.b=function(){return!1};function ve(a){return Oa(a.a,function(a){return a.getName()})}ue.prototype.count=function(){return this.a.length};function W(a,b){return Ra(a.a,function(a){return a.getName()==b})}function we(a,b){return Pa(a.a,function(a){return a.getName()==b})}
function xe(a,b,c,d){if(!b||a.a.length!=b.a.length)return"Number of store: "+a.a.length+" vs "+b.a.length;for(var e=0;e<a.a.length;e++){var f=W(b,a.a[e].getName());if(f){c&&(f=ge(f,a.a[e]));if(d)for(var g=f,h=a.a[e],k=0;k<h.a.length;k++){var m=h.a[k];ee(g,m.getName())||"BLOB"!=m.type||(m=new Md(m.keyPath,m.type,m.unique,m.multiEntry,m.getName()),g.a.push(m))}f=le(a.a[e],f);if(0<f.length)return'store: "'+a.a[e].getName()+'" '+f}else return'missing object store "'+a.a[e].getName()+'"'}return""};function ye(a,b){ue.call(this,a,b)}B(ye,ue);ye.prototype.b=function(){return!0};function ze(a,b){a.a.push(b)};function Ae(a){Error.captureStackTrace?Error.captureStackTrace(this,Ae):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"}B(Ae,Error);B(Ae,Error);function Be(a){Error.captureStackTrace?Error.captureStackTrace(this,Be):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"}B(Be,Error);Be.prototype.name="ydn.InternalError";
function Ce(a){Error.captureStackTrace?Error.captureStackTrace(this,Ce):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"}B(Ce,Error);Ce.prototype.name="ydn.error.ConstraintError";B(Ae,Error);function Ud(a,b){var c;c=c||{};if(null!=a&&null!=b){if(w(a)&&w(b)){if(a.length!=b.length)return!1;for(var d=0;d<a.length;d++)if(-1==Ra(b,function(b){return Ud(b,a[d])}))return!1;return!0}if(w(a))return 1==a.length&&Ud(a[0],b);if(w(b))return 1==b.length&&Ud(b[0],a);if(A(a)&&A(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=Ud(a[e],b[e]);if(!f)return!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=Ud(a[e],b[e]),!f))return!1;return!0}return a===b}return!1};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function X(a,b,c){c=c||{};var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==Ma(d,e))throw new H('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!v(c.mechanisms))throw new H("mechanisms attribute must be an array but "+da(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!Ta(De,c.mechanisms[e]))throw new H('Invalid mechanism "'+c.mechanisms[e]+'"');}this.n=c.mechanisms||De;this.k=c.size;this.p=
u(c.connectionTimeout)?c.connectionTimeout:3E3;this.b=null;this.d=[];this.cb=!1;var f;if(b instanceof ue)f=b;else if(A(b))for(c.autoSchema||!u(b.stores)?f=new ye(b):f=new ue(b),c=b.stores?b.stores.length:0,e=0;e<c;e++)d=W(f,b.stores[e].name),b.stores[e].Sync&&this.Vb(d,b.stores[e].Sync);else f=new ye;this.c=f;for(e=0;e<this.c.count();e++)if((this.c.a[e]||null).n)throw Error("encryption option must be defined");u(a)&&this.m(a);this.f=null;this.e=new E}X.prototype.logger=I("ydn.db.con.Storage");
X.prototype.v=function(a){if(u(a)){var b=function(b){a(b.toJSON());a=void 0};if(this.b)this.b.P(b);else{var c=this;this.transaction(function(a){c.b.P(b,a)},null,Xc)}}return this.c?this.c.toJSON():null};X.prototype.m=function(a){if(this.b)throw new Vb("Already connected with "+this.g);this.g=a;Ee(this)};X.prototype.getName=function(){return this.g};var De="indexeddb sqlite websql localstorage sessionstorage userdata memory".split(" ");l=X.prototype;l.Cb=function(){return null};
function Ee(a){function b(b,e){b?(M(a.logger,a+": ready."),a.$b=NaN,d.Ka=function(b){a.J(new Ad(a,b))},d.ib=function(b){a.J(new Bd(a,b));a.b=null},d.kb=function(b){a.J(b)},setTimeout(function(){Fe(a,e);Ge(a)},10),c.j(e)):(K(a.logger,a+": database connection fail "+e.name),setTimeout(function(){Fe(a,new Bd(a,e));if(a.d){var b=a.logger;for(b&&b.log(Gc,"Purging "+a.d.length+" transactions request.",void 0);b=a.d.shift();)b.L&&b.L("error",e)}},10),c.h(e))}for(var c=new E,d=null,e=a.n,f=0;f<e.length;f++){var g=
e[f].toLowerCase();if(d=a.Cb(g)){d=a.Cb(g);break}}null===d?(e=new Ce("No storage mechanism found."),b(!1,new Bd(a,e))):G(d.Ba(a.g,a.c),function(a){this.b=d;b(!0,new zd("ready",this,parseFloat(d.sb()),parseFloat(a),null))},function(a){K(this.logger,this+": opening fail");b(!1,a)},a)}l.ub=function(){if(this.b)return this.b.Ca()};l.jb=function(a,b){this.e.Q(a,b)};function Fe(a,b){setTimeout(function(){a.c.c&&a.e.c||(b instanceof Ad?a.e.h(b.error):a.e.j(),a.J(b))},4)}
function He(a){return!!a.b&&a.b.tb()}l.close=function(){this.b&&(this.b.close(),this.b=null,M(this.logger,this+" closed"))};l.Hc=function(){return this.b?this.b.Tb():null};l.$b=NaN;function Ge(a){var b=a.d.shift();b&&(M(a.logger,"pop tx queue["+(a.d.length+1)+"]"),a.transaction(b.Wa,b.yc,b.mode,b.L));a.$b=la()}
function Ie(a,b,c,d,e){M(a.logger,"push tx queue["+a.d.length+"]");a.d.push({Wa:b,yc:c,mode:d,L:e});100<a.d.length&&0==a.d.length%100&&K(a.logger,"Transaction queue stack size is "+a.d.length+". It is too large, possibility due to incorrect usage.")}l.cb=!1;
l.transaction=function(a,b,c,d){var e=b;if(x(b))e=[b];else if(null!=b)if(w(b)){if(0==b.length)throw new H("number of store names must more than 0");for(var f=0;f<b.length;f++)if(!x(b[f]))throw new H("store name at "+f+" must be string but found "+typeof b[f]);}else throw new H("store names must be an array");else e=null;if(this.b&&this.b.tb()&&!this.cb){var g=this,h=u(c)?c:Xc;h==Yc&&(this.cb=!0);this.b.Va(function(b){a(b);a=null},e,h,function(a,b){fa(d)&&(d(a,b),d=void 0);h==Yc&&(g.cb=!1);Ge(g)})}else Ie(this,
a,e,c,d)};l.Vb=function(a){K(this.logger,"Synchronization option for "+a.getName()+" ignored.")};l.J=function(){};l.toString=function(){return"Storage:"+this.b};X.prototype.close=X.prototype.close;X.prototype.getType=X.prototype.ub;X.prototype.getName=X.prototype.getName;X.prototype.getSchema=X.prototype.v;X.prototype.onReady=X.prototype.jb;X.prototype.setName=X.prototype.m;X.prototype.transaction=X.prototype.transaction;X.prototype.db=X.prototype.Hc;ma("ydn.db.version","1.1.2");ma("ydn.db.cmp",sd);ma("ydn.db.deleteDatabase",function(a,b){for(var c,d=0;d<td.length;d++){var e=td[d](a,b);e&&(c=e)}return c||rd("IDBVersionChangeEvent ",null)});
zd.prototype.name=zd.prototype.name;zd.prototype.getVersion=zd.prototype.Ic;zd.prototype.getOldVersion=zd.prototype.qc;zd.prototype.getOldSchema=zd.prototype.pc;Ad.prototype.getError=Ad.prototype.d;ld.prototype.abort=ld.prototype.abort;ld.prototype.canAbort=ld.prototype.mc;Uc.prototype.progress=Uc.prototype.pa;Uc.prototype.promise=Uc.prototype.ra;function Je(a){Error.captureStackTrace?Error.captureStackTrace(this,Je):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"}B(Je,Error);Je.prototype.name="ConstraintError";Je.prototype.toString=function(){return this.name+": "+this.message};function Ke(a){Error.captureStackTrace?Error.captureStackTrace(this,Ke):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"}B(Ke,Error);
Ke.prototype.toString=function(){return this.name+": "+this.message};function Le(a){Error.captureStackTrace?Error.captureStackTrace(this,Le):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"}B(Le,Error);Le.prototype.name="ydn.db.VersionError";Le.prototype.toString=function(){return this.name+": "+this.message};
function pd(a){Error.captureStackTrace?Error.captureStackTrace(this,pd):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"}B(pd,Error);function Me(a){Error.captureStackTrace?Error.captureStackTrace(this,Me):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"}B(Me,Error);Me.prototype.name="NotFoundError";Me.prototype.toString=function(){return this.name+": "+this.message};
function Ne(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Ne):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"}B(Ne,Error);Ne.prototype.toString=function(){return this.name+": "+this.message};function Oe(a,b){Error.captureStackTrace?Error.captureStackTrace(this,Oe):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"}B(Oe,Error);
Oe.prototype.toString=function(){return this.name+": "+this.message};function Pe(a){Error.captureStackTrace?Error.captureStackTrace(this,Pe):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"}B(Pe,Error);function Qe(a,b){this.a=b}Qe.prototype.logger=I("ydn.db.crud.req.RequestExecuto");Qe.prototype.toString=function(){return"RequestExecutor"};function Re(a){this.c=a;this.a=null;this.b=0}Re.prototype.logger=I("ydn.db.tr.Mutex");Re.prototype.O=null;function Se(a){return!!a.a&&!a.d}Re.prototype.L=null;Re.prototype.toString=function(){return"Mutex:"+("B"+this.c+"T"+this.b)+(this.a?"*":"")};function Te(a,b,c,d,e,f){this.G=a;this.K=b;this.a=this.d=0;this.v=d;this.p=e;this.e=c||Ue;this.k=f||0}Te.prototype.logger=I("ydn.db.tr.Thread");Te.prototype.type=function(){return this.G.ub()};Te.prototype.i=function(){return this.G};Te.prototype.I=function(){return"B"+this.K+"T"+this.d};var Ue="single";function Ve(a){if(a)if(fa(a.abort))a.abort();else if(fa(a.executeSql))a.executeSql("ABORT",[],null,function(){return!0});else throw new Tb;else throw new pd("No active transaction");};function We(a,b,c,d,e,f){Te.call(this,a,b,c,d,e,f);this.c=[];this.f=[];this.g=null;this.b=new Re(b);this.m=f||0;this.n=!1}B(We,Te);l=We.prototype;l.logger=I("ydn.db.tr.Serial");
function Xe(a,b,c){if("multi"==a.e)a:if(a=a.b,!a.O||!a.mode||c!=a.mode&&(a.mode!=O||c!=Xc)||b.length>a.O.length)b=!1;else{for(c=0;c<b.length;c++)if(-1==a.O.indexOf(b[c])){b=!1;break a}b=!0}else if("repeat"==a.e)a:if(a=a.b,a.O&&a.mode&&c==a.mode&&a.O.length==b.length){for(c=0;c<b.length;c++)if(-1==a.O.indexOf(b[c])){b=!1;break a}b=!0}else b=!1;else b="all"==a.e?!0:!1;return b}function Ye(a){var b=0<a.c.length?a.c[0].O:null,c=0<a.c.length?a.c[0].mode:null;return null!=b&&null!=c?Xe(a,b,c):!1}
function Ze(a,b,c,d,e){M(a.logger,"push tx queue["+a.c.length+"]");a.c.push({Wa:b,O:c,mode:d,L:e})}l.abort=function(){N(this.logger,this+": aborting");Ve(this.g)};
l.oa=function(a,b,c,d){var e=x(b)?[b]:b;if(w(e)){if(0==e.length)throw new H("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!x(e[f]))throw new H("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.H&&!Ta(this.H,e[f]))throw new H('store name "'+f+e[f]+'" in scope of '+this);}}else throw new H("store names must be an array");var g=u(c)?c:Xc,h=this;if(this.b.a||!He(this.i())&&this.n)Ze(this,a,b,g,d);else{var k=this.I();d&&this.f.push(d);if(this.m&&
this.d>=this.m)throw new Vb("Exceed maximum number of transactions of "+this.m);this.n=!0;this.i().transaction(function(c){var d=h.b;d.a=c;d.d=!1;d.O=b;d.mode=g;d.b++;d.L=null;k=h.I();L(h.logger,k+" BEGIN "+V(b)+" "+g);a(h);for(a=null;Ye(h);)c=h.c.shift(),c.L&&h.f.push(c.L),M(h.logger,"pop tx queue"+(h.c.length+1)+" reusing T"+h.d),c.Wa()},e,g,function(a,b){L(h.logger,k+" "+a);var c=h.b;c.a?(c.a=null,c.O=null,c.mode=null,fa(c.L)&&c.L(a,b),c.L=null):K(c.logger,c+" has no TX to be unlocked for "+a);
for(c=0;c<h.f.length;c++)(0,h.f[c])(a,b);h.f.length=0;(c=h.c.shift())&&h.oa(c.Wa,c.O,c.mode,c.L);h.a=0})}};l.I=function(){var a=this.b;return"B"+a.c+"T"+a.b};l.request=function(a,b,c,d){function e(a,b){od(f);d&&d(a,b)}var f=new ld(a);a=c||Xc;var g=this;Se(this.b)&&Xe(this,b,a)?(b=this.b.a,this.a++,md(f,b,this.I()+"R"+this.a),this.f.push(e)):g.oa(function(){var a=g.b.a;g.a++;md(f,a,g.I()+"R"+g.a)},b,a,e);return f};
l.Da=function(a,b,c,d,e){d=d||Xc;var f=this,g;if(Se(f.b)&&Xe(this,c,d)){var h=f.b.a;f.a++;g=f.I()+"R"+f.a;N(f.logger,g+" BEGIN");b(h,g,function(b,c){f.g=h;c?(N(f.logger,g+" ERROR"),a.h(b)):(N(f.logger,g+" SUCCESS"),a.j(b));f.g=null});N(f.logger,g+" END");b=null}else f.oa(function(){var c=f.b.a;f.a++;g=f.I()+"R"+f.a;N(f.logger,g+" BEGIN");b(c,g,function(b,d){f.g=c;d?(N(f.logger,g+" ERROR"),a.h(b)):(N(f.logger,g+" SUCCESS"),a.j(b));f.g=null});N(f.logger,g+" END");b=null},c,d,e)};l.getName=function(){return this.i().getName()};
l.toString=function(){return"Serial:"+this.I()+(this.g?"*":"")};function $e(a,b){We.call(this,a,b)}B($e,We);$e.prototype.logger=I("ydn.db.tr.AtomicSerial");$e.prototype.request=function(a,b,c){var d,e,f,g=$e.l.request.call(this,a,b,c,function(a,b){od(g);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new Pe;P(g,c,!0)}});qd(g,function(a,b,c){f=b;e=a;d=c});return g};
$e.prototype.Da=function(a,b,c,d,e){var f,g,h=new E;G(h,function(a){g=!1;f=a},function(a){g=!0;f=a});$e.l.Da.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.h(c);else if(!0===g)a.h(f);else if(!1===g)a.j(f);else{var d=new Pe;a.h(d)}e&&(e(b,c),e=void 0)})};$e.prototype.toString=function(){return"Atomic"+$e.l.toString.call(this)};function af(a,b,c,d){this.d=a;this.a=b;this.b=c;this.M=d;this.c=null}l=af.prototype;l.logger=I("ydn.db.tr.DbOperator");l.Jc=function(){return this.b.d};l.abort=function(){this.b.abort()};function Y(a){if(!a.c){var b;b=a.d;var c=b.ub();if("indexeddb"==c)b=new bf(0,b.c);else if("websql"==c||"sqlite"==c)b=new cf(0,b.c);else if("memory"==c||"localstorage"==c||"sessionstorage"==c)b=new df(0,b.c);else throw new Wb("No executor for "+c);a.c=b}return a.c}l.i=function(){return this.d};
function ef(a,b){var c=a.i(),d=b instanceof Wd?b:Xd(b),e=b.name,f=W(c.c,e);if(0==le(d,f).length)Sb(!1);else if(f=f?"update":"add",c.c instanceof ye)ze(c.c,d),c.b?(c.b.close(),c.b=null,Ee(c)):Sb(!1);else throw new Ce("Cannot "+f+" store: "+e+". Not auto schema generation mode.");}l.toString=function(){return"TxStorage:"+this.i().getName()};function ff(a,b,c,d){af.call(this,a,b,c,d)}B(ff,af);l=ff.prototype;l.logger=I("ydn.db.crud.DbOperator");
l.count=function(a,b,c,d){var e,f,g,h;if(null!=a)if(v(a)){if(u(c)||u(b))throw new H("too many arguments.");f=a;for(var k=0;k<f.length;k++)if(!we(this.a,f[k]))throw new H('store name "'+f[k]+'" at '+k+" not found.");N(this.logger,"countStores: "+V(f));e=this.b.request("count",f);Q(e,function(){Y(this).Ua(e,f)},this)}else if(x(a)){k=W(this.a,a);if(!k)throw new H('store name "'+a+'" not found.');if(u(d)&&!ea(d))throw new H('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(x(b))if(g=
b,A(c)){var m=Jd(c);if(m)throw new H("invalid key range: "+qe(c)+" "+m);h=Hd(c)}else{if(null!=c)throw new H("invalid key range: "+qe(c)+" of type "+typeof c);h=null}else if(A(b)||null==b)if(A(b)){if(m=Jd(b))throw new H("invalid key range: "+qe(b)+" "+m);h=Hd(b)}else{if(null!=b)throw new H("key range must be  an object but found "+qe(b)+" of type "+typeof b);h=null}else throw new H('invalid second argument for count "'+qe(c)+'" of type '+typeof b);N(this.logger,"countKeyRange: "+a+" "+(g?g:"")+V(h));
e=this.b.request("count",f);oe(k,e,arguments);Q(e,function(){Y(this).Bb(e,f[0],h,g,!!d)},this)}else throw new H("Invalid store name or store names.");else K(this.logger,"count method requires store name(s)"),k=ve(this.a),e=this.b.request("count",k),qd(e,function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),Q(e,function(){Y(this).Ua(e,f)},this);return e};
l.get=function(a,b){var c=this,d;if(a instanceof T){var e=a,f=e.a,g=W(this.a,f);if(!g){if(this.a.b()){if(He(this.i()))return rd("get",void 0);d=new ld("get");this.i().jb(function(){G(c.get(a,b),function(a){d.j(a)},function(a){d.h(a)})});return d}throw new H("Store: "+f+" not found.");}var h=e.id;N(this.logger,"getByKey: "+f+":"+h);d=this.b.request("get:key",[f]);oe(g,d,arguments,void 0,this);Q(d,function(){Y(this).Ya(d,f,h)},this)}else if(x(a)&&u(b)){var k=a,g=W(this.a,k);if(!g){if(this.a.b()){if(He(this.i()))return rd("get",
void 0);d=new ld("get");this.i().jb(function(){G(c.get(a,b),function(a){d.j(a)},function(a){d.h(a)})});return d}throw new H('Store name "'+k+'" not found.');}var m=b;N(this.logger,"getById: "+k+":"+m);d=this.b.request("get",[k]);oe(g,d,arguments,void 0,this);Q(d,function(){Y(this).Ya(d,k,m)},this)}else throw new H("get require valid input arguments.");return d};
l.vc=function(a,b,c,d,e){var f=W(this.a,a),g,h,k,m=null;if(A(b)){var n=Jd(b);if(n)throw new H("invalid key range: "+b+" "+n);m=Hd(b)}else if(null!=b)throw new H('expect key range object, but found "'+qe(b)+'" of type '+typeof b);if(u(c))if(y(c))g=c;else throw new H("limit must be a number, but "+c+" is "+typeof c);else g=100;if(u(d))if(y(d))h=d;else throw new H("offset must be a number, but "+d+" is "+typeof d);else h=0;if(u(e))if(ea(e))k=e;else throw new H("reverse must be a boolean, but "+e+" is "+
typeof e);N(this.logger,"keysByKeyRange: "+a);var p=this.b.request("keys",[a]);oe(f,p,arguments);Q(p,function(){Y(this).list(p,2,a,null,m,g,h,k,!1)},this);return p};
l.uc=function(a,b,c,d,e,f,g){var h,k,m,n,p,q=Jd(c);if(q)throw new H("invalid key range: "+c+" "+q);q=W(this.a,a);h=Hd(c);if(y(d))k=d;else{if(u(d))throw new H("limit must be a number");k=100}if(y(e))m=e;else{if(u(e))throw new H("offset must be a number");m=0}if(u(f))if(ea(f))n=f;else throw new H("reverse must be a boolean");if(u(g))if(ea(g))p=g;else throw new H("unique must be a boolean");N(this.logger,"keysByIndexKeyRange: "+a);var r=this.b.request("keys:iter:index",[a]);oe(q,r,arguments);Q(r,function(){Y(this).list(r,
2,a,b,h,k,m,n,p)},this);return r};l.keys=function(a,b,c,d,e,f,g){var h=W(this.a,a);if(!x(a))throw new H("store name must be a string, but "+a+" of type "+typeof a+" is not.");if(!this.a.b()){if(!h)throw new H('store name "'+a+'" not found.');if(x(b)&&!$d(h,b))throw new H('index "'+b+'" not found in store "'+a+'".');}return this.a.b()&&!h?rd("keys",[]):x(b)?this.uc(a,b,c,d,e,f,g):this.vc(a,b,c,d,e)};
l.N=function(a,b,c,d,e,f,g){var h=this,k;if(x(a)){var m=a,n=W(this.a,m);if(!n){if(this.a.b()){if(He(this.i()))return rd("values",[]);k=new ld("values");this.i().jb(function(){G(h.N(a,b,c,d,e,f),function(a){k.j(a)},function(a){k.h(a)})});return k}throw new Me(m);}if(v(b)){if(u(c)||u(d))throw new H("too many input arguments");var p=b;N(this.logger,"listByIds: "+m+" "+p.length+" ids");k=this.b.request("values:array",[m]);oe(n,k,arguments,void 0,this);Q(k,function(){Y(this).Mb(k,m,p)},this)}else k=x(b)?
this.Cc(m,b,c,d,e,f,g):this.Dc(m,b,c,d,e)}else if(v(a))if(a[0]instanceof T){for(var n=[],q=a,r=0;r<q.length;r++){var z=q[r].a;if(!we(this.a,z)){if(this.a.b())return n=[],n[q.length-1]=void 0,rd("get",n);throw new H("Store: "+z+" not found.");}Ta(n,z)||n.push(z)}N(this.logger,"listByKeys: "+V(n)+" "+q.length+" keys");k=this.b.request("values:keys",n);Q(k,function(){Y(this).fb(k,q)},this)}else throw new H("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");else throw new H("first argument "+
a+" is invalid.");return k};
l.Dc=function(a,b,c,d,e){var f=W(this.a,a),g,h,k,m=null;if(A(b)){var n=Jd(b);if(n)throw new H("invalid key range: "+b+" "+n);m=Hd(b)}else if(null!=b)throw new H('expect key range object, but found "'+qe(b)+'" of type '+typeof b);if(u(c))if(y(c))g=c;else throw new H("limit must be a number, but "+c+" is "+typeof c);else g=100;if(u(d))if(y(d))h=d;else throw new H("offset must be a number, but "+d+" is "+typeof d);else h=0;if(u(e))if(ea(e))k=e;else throw new H("reverse must be a boolean, but "+e+" is "+
typeof e);N(this.logger,(m?"listByKeyRange: ":"listByStore: ")+a);var p=this.b.request("values",[a]);oe(f,p,arguments);Q(p,function(){Y(this).list(p,4,a,null,m,g,h,k,!1)},this);return p};
l.Cc=function(a,b,c,d,e,f,g){var h=W(this.a,a),k,m,n,p;if(!ee(h,b))throw new H('index "'+b+'" not found in store "'+a+'"');var q=Jd(c);if(q)throw new H("invalid key range: "+c+" "+q);var r=Hd(c);if(u(d))if(y(d))k=d;else throw new H("limit must be a number.");else k=100;if(u(e))if(y(e))m=e;else throw new H("offset must be a number.");else m=0;if(ea(f))n=f;else if(u(f))throw new H("reverse must be a boolean, but "+f);if(u(g))if(ea(g))p=g;else throw new H("unique must be a boolean");N(this.logger,"listByIndexKeyRange: "+
a+":"+b);var z=this.b.request("values:iter:index",[a]);oe(h,z,arguments);Q(z,function(){Y(this).list(z,4,a,b,r,k,m,n,p)},this);return z};
l.list=function(a,b,c,d,e,f,g,h,k){var m=W(this.a,b);if(!m){if(this.a.b())return rd("get",[]);throw new Me(b);}var n;if(c&&!ee(m,c))throw new H('index "'+c+'" not found in store "'+b+'"');if(m=Jd(d))throw new H("invalid key range: "+d+" "+m);var p=Hd(d),q=100;if(y(e))q=e;else if(null!=e)throw new H('limit must be a number but "'+e+'" of type '+typeof e+" found.");var r=0;if(y(f))r=f;else if(null!=f)throw new H('offset must be a number but "'+f+'" of type '+typeof f+" found.");var z=!1;if(ea(g))z=
g;else if(null!=g)throw new H('reverse must be a boolean but "'+g+'" of type '+typeof g+" found.");var C=!1;if(ea(h))C=h;else if(null!=h)throw new H('unique must be a boolean but "'+h+'" of type '+typeof h+" found.");if(r&&k&&u(k[0]))throw new H("offset must not given when initial cursor position is defined");N(this.logger,a+": "+b+":"+c);n=this.b.request("values:iter:index",[b]);Q(n,function(){Y(this).list(n,a,b,c||null,p,q,r,z,C,k)},this);return n};
l.add=function(a,b,c){var d=x(a)?a:A(a)?a.name:void 0;if(!x(d))throw new H("store name "+d+" must be a string, but "+typeof d);var e=W(this.a,d);if(!e){if(!this.a.b())throw new H('store name "'+d+'" not found.');e=Xd(A(a)?a:{name:d});N(this.logger,"Adding object store: "+d);ef(this,e)}else if(this.a.b()&&A(a)&&(a=Xd(a),a=le(e,a)))throw new Tb(a);var f;if(!e)throw new H('store name "'+d+'" not found.');if(x(e.keyPath)&&u(c))throw new H("key must not be provided while the store uses in-line key.");
if(!e.keyPath&&!e.c&&!u(c))throw new H("out-of-line key must be provided.");if(v(b)){N(this.logger,"addObjects: "+d+" "+b.length+" objects");for(a=0;a<b.length;a++)me(e,b[a]);f=this.b.request("add:array",[d],O);Q(f,function(){Y(this).U(f,!1,!1,d,b,c)},this);e.fa&&f.R(function(a){a=new Dd("created",this.i(),e.getName(),a,b);this.i().J(a)},this)}else if(A(b))a="store: "+d+" key: "+ie(e,b,c),N(this.logger,"addObject: "+a),me(e,b),f=this.b.request("add",[d],O),Q(f,function(){Y(this).U(f,!1,!0,d,[b],[c])},
this),e.fa&&f.R(function(a){a=new Cd("created",this.i(),e.getName(),a,b);this.i().J(a)},this);else throw new H("record must be an object or array list of objects, but "+b+" of type "+typeof b+" found.");return f};
function gf(a,b){var c=x(b)?b:A(b)?b.name:void 0;if(!x(c))throw new H("store name must be a string");var d=W(a.a,c);if(!d){if(!a.a.b())throw new Me(c);d=Xd(A(b)?b:{name:c});N(a.logger,"Adding object store: "+c);ef(a,d)}else if(a.a.b()&&A(b)){var e=Xd(b);if(e=le(d,e))throw new Tb(e);}if(!d)throw new Me(c);return d}l.load=function(a,b,c){var d=c||",",e=gf(this,a).getName();a=this.b.request("load",[e]);var f=this;this.b.Da(a,function(a,c,k){Y(f).Qb(a,c,k,e,b,d)},[e],O);return a};
l.put=function(a,b,c){var d,e=this;if(a instanceof T){var f=a,g=f.a,h=W(this.a,g);if(!h)throw new H('store "'+g+'" not found.');if(h.keyPath){var k=ie(h,b);if(null!=k){if(0!=sd(k,f.id))throw new H("Inline key must be "+f+" but "+k+" found.");}else je(h,b,f.id);return this.put(g,b)}return this.put(g,b,f.id)}if(v(a)){if(u(c))throw new H("too many arguments");var m=a;if(!u(b))throw new H("record values required");for(var n=b,f=[],g=0,h=m.length;g<h;g++){k=m[g].a;-1==Ma(f,k)&&f.push(k);var p=W(this.a,
k);if(!p)throw new H('store "'+k+'" not found.');p.keyPath&&je(p,n[g],m[g].id)}N(this.logger,"putByKeys: to "+V(f)+" "+n.length+" objects");for(g=0;g<n.length;g++)me(p,n[g]);d=this.b.request("put:keys",f,O);oe(p,d,arguments);Q(d,function(){Y(e).mb(d,n,m)},this)}else if(x(a)||A(a)){var p=gf(this,a),q=p.getName();if(p.keyPath&&u(c))throw new H("key must not be provided while the store uses in-line key.");if(!p.keyPath&&!p.c&&!u(c))throw new H("out-of-line key must be provided.");if(v(b)){var r=b,z=
c;N(this.logger,"putObjects: "+q+" "+r.length+" objects");for(g=0;g<r.length;g++)me(p,r[g]);d=this.b.request("put:array",[q],O);oe(p,d,arguments);Q(d,function(){Y(this).U(d,!0,!1,q,r,z)},this);p.fa&&d.R(function(a){a=new Dd("updated",this.i(),q,a,r);this.i().J(a)},this)}else if(A(b)){var C=b,D=c;N(this.logger,"putObject: "+q+" "+(u(D)?D:"(without-key)"));if(u(t.Blob)&&C instanceof Blob&&p.sa&&!p.keyPath&&0==p.a.length&&nc)d=new ld("put"),f=new FileReader,f.onload=function(a){var b=a.target.result,
c=e.b.request("put",[q],O);oe(p,c,[q,C,D]);Q(c,function(){Y(e).U(c,!0,!0,q,[b],[D])},this);G(c,function(a){d.j(a)},function(a){d.h(a)})},f.onerror=function(a){d.h(a)},f.onabort=function(a){d.h(a)},f.readAsDataURL(C);else{me(p,C);d=this.b.request("put",[q],O);var F=[q,C,D];oe(p,d,F);Q(d,function(){var a=u(D)?[F[2]]:void 0;Y(e).U(d,!0,!0,q,[F[1]],a)},this)}p.fa&&d.R(function(a){a=new Cd("updated",this.i(),q,a,C);this.i().J(a)},this)}else throw new H("put record value must be Object or array of Objects");
}else throw new H("the first argument of put must be store name, store schema or array of keys.");return d};
function hf(a,b,c,d){var e=a.M,f,g;if(x(b)){var h=W(a.a,b);if(h){if(!h.keyPath&&!h.c&&null==d)throw new H('key required for store "'+b+'"');}else throw new Me(b);for(var k=0;k<c.length;k++)me(h,c[k]);f=[b]}else{g=b;f=[];for(var k=0,m=g.length;k<m;k++){var n=g[k].a,h=W(a.a,n);-1==Ma(f,n)&&f.push(n);if(!h)throw new Me(n);me(h,c[k])}}var p;x(b)?(h=W(a.a,b),p=e.request("put:array",f,O),Q(p,function(){Y(this).U(p,!0,!1,b,c,d)},a)):(p=e.request("put:keys",f,O),Q(p,function(){Y(this).mb(p,c,g)},a));return p}
function jf(a,b){for(var c=[],d=0,e=b.length;d<e;d++){var f=b[d].a;-1==Ma(c,f)&&c.push(f);if(!we(a.a,f))throw new Me(f);}var g=a.M.request("rm:keys",c,O);Q(g,function(){Y(this).pb(g,b)},a);return g}
function kf(a,b,c,d,e,f,g){f=f||100;var h,k=g||0;if(g=W(a.a,b)){if(c&&!ee(g,c))throw new Me('index "'+c+'" in store "'+b+'"');}else throw new Me(b);var m=Hd(d);x(c)?(h=a.M.request("values:iter:index",[b]),Q(h,function(){Y(this).list(h,4,b,c,m,f,k,e,!1)},a)):(h=a.M.request("values",[b]),Q(h,function(){Y(this).list(h,4,b,null,m,f,k,e,!1)},a));return h}
function lf(a,b){var c=[],d=b.length;if(0==d)return rd("keys",[]);for(var e=0;e<d;e++){var f=b[e].a;-1==Ma(c,f)&&c.push(f);if(!we(a.a,f))throw new Me(f);}var g=a.M.request("keys",c);Q(g,function(){Y(a).fb(g,b)},a);return g}
function mf(a,b,c,d,e,f,g,h){var k;e=e||100;var m=W(a.a,b);if(m){if(c&&!ee(m,c))throw new Me('index "'+c+'" in store "'+b+'"');}else throw new Me(b);x(c)?(k=a.M.request("keys:iter:index",[b]),Q(k,function(){Y(this).list(k,2,b,c,d,e,f,g,h)},a)):(k=a.M.request("keys",[b]),Q(k,function(){Y(this).list(k,2,b,null,d,e,f,g,h)},a));return k}
l.clear=function(a,b,c){if(u(c))throw new H("too many input arguments");var d;if(x(a)){c=W(this.a,a);if(!c)throw new H('store name "'+a+'" not found.');if(A(b)){var e=Hd(b);if(null===e)throw new H("clear method requires a valid non-null KeyRange object.");N(this.logger,"clearByKeyRange: "+a+":"+V(e));d=this.b.request("clear",[a],O);oe(c,d,[a,e]);Q(d,function(){Y(this).zb(d,a,e)},this)}else{if(u(b))throw new H("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+
typeof b);N(this.logger,"clearByStore: "+a);d=this.b.request("clear",[a],O);Q(d,function(){Y(this).Sa(d,[a])},this)}}else if(!u(a)||v(a)&&x(a[0])){var f=a||ve(this.a);N(this.logger,"clearByStores: "+V(f));d=this.b.request("clear",f,O);Q(d,function(){Y(this).Sa(d,f)},this)}else throw new H('first argument "'+a+'" is invalid.');return d};
l.vb=function(a,b,c){var d;if(x(a)){var e=W(this.a,a);if(!e)throw new H('store name "'+a+'" not found.');if(u(c))if(x(b)){var f=$d(e,b);if(!f)throw new H("index: "+b+" not found in "+a);if(A(c)||null===c){var g=Hd(c);N(this.logger,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.b.request("rm:iter:index",[a],O);Q(d,function(){Y(this).Rb(d,a,f.getName(),g)},this)}else throw new H("key range "+c+' is invalid type "'+typeof c+'".');}else throw new H('index name "'+b+'" must be a string, but '+
typeof b+" found.");else if(x(b)||y(b)||w(b)||b instanceof Date){N(this.logger,"removeById: "+a+":"+b);d=this.b.request("rm",[a],O);var h=[a,b];oe(e,d,h);Q(d,function(){Y(this).nb(d,a,h[1])},this);e.fa&&d.R(function(c){c=1==c?b:void 0;c=new Cd("deleted",this.i(),a,c,void 0);this.i().J(c)},this)}else if(A(b))g=Hd(b),N(this.logger,"removeByKeyRange: "+a+":"+V(g)),d=this.b.request("rm:iter",[a],O),oe(e,d,[a,g]),Q(d,function(){Y(this).ob(d,a,g)},this),e.fa&&d.R(function(b){var c=[];c.length=b;b=new Dd("deleted",
this.i(),a,c,void 0);this.i().J(b)},this);else throw new H('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof T){var k=a.a,e=W(this.a,k);d=this.b.request("rm",[k],O);var m=[k,a.id];oe(e,d,m);Q(d,function(){Y(this).nb(d,k,m[1])},this)}else if(v(a)){c=[];for(var e=0,n=a.length;e<n;e++){if(!(a[e]instanceof T))throw new H("key list element at "+e+" of "+n+' must be yn.db.Key, but "'+qe(a[e])+'" ('+da(a[e])+") is not ydn.db.Key.");var p=a[e].a;-1==Ma(c,p)&&c.push(p)}if(1>c.length)throw new H('at least one valid key required in key list "'+
qe(a)+'"');d=this.b.request("rm:keys",c,O);Q(d,function(){Y(this).pb(d,a)},this)}else throw new H('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+qe(a)+'" ('+da(a)+") found.");return d};l.toString=function(){return"DbOperator:"+this.i().getName()};function nf(a,b,c,d){this.d=a;this.e=b;this.a=Xa(c);this.b=d;this.c=[]}nf.prototype.d=null;function of(a,b,c){if(a.d)c&&a.c.push(c),b(a.d);else throw new Wb("tx committed on ParallelTxExecutor");}nf.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.e+" mode:"+this.b+" scopes:"+V(this.a)};function pf(a,b,c,d,e,f){Te.call(this,a,b,c,d,e,f);this.c=this.b=null}B(pf,Te);l=pf.prototype;l.logger=I("ydn.db.tr.Parallel");l.abort=function(){N(this.logger,this+": aborting");Ve(this.c)};
l.kc=function(a,b){var c;if("multi"==this.e)a:if(c=this.b,!c.a||!c.b||b!=c.b&&(c.b!=O||b!=Xc)||a.length>c.a.length)c=!1;else{for(var d=0;d<a.length;d++)if(-1==c.a.indexOf(a[d])){c=!1;break a}c=!0}else if("repeat"==this.e)a:if(c=this.b,c.a&&c.b&&b==c.b&&c.a.length==a.length){for(d=0;d<a.length;d++)if(-1==c.a.indexOf(a[d])){c=!1;break a}c=!0}else c=!1;else c="all"==this.e?!0:!1;return c};
l.oa=function(a,b,c,d){function e(c){k.d++;m=new nf(c,k.d,b,h);g=k.I();L(k.logger,g+" BEGIN "+V(b)+" "+h);k.b=m;of(k.b,a,d)}function f(a,b){L(k.logger,g+" "+a);if(m){for(var c=m,d=0;d<c.c.length;d++)c.c[d](a,b);c.c.length=0;c.d=null;c.a=null;c.c=null}k.a=0}var g;this.v&&(b=this.v);this.p&&(c=this.p);var h=u(c)?c:Xc,k=this,m;if(this.b&&this.b.d&&this.kc(b,h))of(this.b,a,d);else{if(this.k&&this.d>=this.k)throw new Vb("Exceed maximum number of transactions of "+this.k);this.i().transaction(e,b,h,f)}};
l.request=function(a,b,c,d){var e=new ld(a),f=this;this.oa(function(a){f.a++;md(e,a,f.I()+"R"+f.a)},b,c||Xc,function(a,b){od(e);d&&d(a,b)});return e};l.Da=function(a,b,c,d,e){var f=this,g;this.oa(function(c){f.a++;g=f.I()+"R"+f.a;N(f.logger,g+" BEGIN");b(c,g,function(b,d){f.c=c;g=f.I()+"R"+f.a;d?(N(f.logger,g+" ERROR"),a.h(b)):(N(f.logger,g+" SUCCESS"),a.j(b));f.c=null});b=null;N(f.logger,g+" END")},c,d,e)};l.toString=function(){return"Parallel:"+this.e+":"+this.I()+(this.c?"*":"")};function qf(a,b){pf.call(this,a,b,Ue)}B(qf,pf);l=qf.prototype;l.logger=I("ydn.db.tr.AtomicParallel");l.kc=function(){return!1};l.request=function(a,b,c){var d,e,f,g=this,h=qf.l.request.call(this,a,b,c,function(a,b){od(h);N(g.logger,"transaction "+a);if(d)"complete"!=a&&(f=!0,e=b),d(e,f);else{var c=new Pe;P(h,c,!0)}});qd(h,function(a,b,c){f=b;e=a;d=c});return h};
l.Da=function(a,b,c,d,e){var f,g,h=new E;G(h,function(a){g=!1;f=a},function(a){g=!0;f=a});qf.l.Da.call(this,h,b,c,d,function(b,c){if("complete"!=b)a.h(c);else if(!0===g)a.h(f);else if(!1===g)a.j(f);else{var d=new Pe;a.h(d)}e&&(e(b,c),e=void 0)})};l.toString=function(){return"Atomic"+qf.l.toString.call(this)};function rf(a,b,c){X.call(this,a,b,c);this.wa=0;a=!0;b=Ue;c&&(u(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=sf(this,b,a);this.M=sf(this,"atomic",!1);this.a=this.hb(c,this.M)}B(rf,X);l=rf.prototype;l.wa=0;l.lc=function(a,b,c,d,e,f){a=a||Ue;var g;"readonly"==d?g=Xc:"readwrite"==d&&(g=O);a=sf(this,a,b,c,g,e);return this.hb(a,f?null:this.M)};l.hb=function(a,b){return new af(this,this.c,a,b)};
function sf(a,b,c,d,e,f){if(c){if("multi"==b||"repeat"==b||"all"==b||b==Ue)return new We(a,a.wa++,b,d,e,f);if("atomic"==b)return new $e(a,a.wa++);throw new H('Invalid requestType "'+b+'"');}if("multi"==b||"repeat"==b||"all"==b||b==Ue)return new pf(a,a.wa++,b,d,e,f);if("atomic"==b)return new qf(a,a.wa++);throw new H('Invalid requestType "'+b+'"');}
l.xc=function(a,b,c){if(3<arguments.length)throw new H("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.wa++;var d=b||ve(this.c),e=Xc;if(c)if("readwrite"==c)e=O;else if("readonly"!=c)throw new H('Invalid transaction mode "'+c+'"');var f=sf(this,"all",!1,d,e,1),g=this.hb(f,this.M),h=new ld("run"),k=this;f.oa(function(b){M(k.logger,"executing run in transaction on "+f);md(h,b,f.I()+"R0");a(g)},d,e,function(a){od(h);P(h,f.d,"complete"!==a)});
return h};l.Kc=function(){return this.a?this.a.b.d:NaN};function Z(a,b,c){rf.call(this,a,b,c);a=this.c;for(b=0;b<a.d.length;b++){c=a.d[b];var d=W(a,c.getName());if(d){if(!ee(d,"k"))throw new H('full text index store "'+d.getName()+'" must have "keyword" index');if(!ee(d,"v"))throw new H('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.keyPath)throw new H('full text index store "'+d.getName()+'" must use "id" as key path.');}else throw new H('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=
c.index(d),f=W(a,e.a);if(f)K(this.logger,"Full text indexer option for "+f.getName()+" ignored.");else throw new H('full text source store "'+e.a+'" does not exist for full text index "'+c.getName()+'"');}}}B(Z,rf);l=Z.prototype;l.hb=function(a,b){return new ff(this,this.c,a,b)};l.add=function(a,b,c){return this.a.add(a,b,c)};l.count=function(a,b,c,d){return this.a.count(a,b,c,d)};l.get=function(a,b){return this.a.get(a,b)};l.keys=function(a,b,c,d,e,f,g){return this.a.keys(a,b,c,d,e,f,g)};
l.N=function(a,b,c,d,e,f){return this.a.N(a,b,c,d,e,f)};l.list=function(a,b,c,d,e,f,g,h,k){return this.a.list(a,b,c,d,e,f,g,h,k)};l.load=function(a,b,c){return this.a.load(a,b,c)};l.put=function(a,b,c){return this.a.put(a,b,c)};l.clear=function(a,b,c){return this.a.clear(a,b,c)};l.vb=function(a,b,c){return this.a.vb(a,b,c)};l.toString=function(){var a="Storage:"+this.getName();He(this)&&(a+=" ["+this.ub()+"]");return a};function bf(a,b){this.a=b}B(bf,Qe);l=bf.prototype;l.logger=I("ydn.db.crud.req.IndexedDb");l.Ua=function(a,b){function c(e){var f=a.a.objectStore(b[e]).count();f.onsuccess=function(f){d[e]=f.target.result;e++;e==b.length?P(a,d):c(e)};f.onerror=function(b){b.preventDefault();P(a,f.error,!0)}}var d=[];0==b.length?P(a,[]):c(0)};
l.U=function(a,b,c,d,e,f){function g(r){if(null==e[r])if(M(n.logger,"empty object at "+r+" of "+e.length),k++,k==e.length)P(a,h,m);else{var C=r+10;C<e.length&&g(C)}var D,C=e[r];D=f&&null!=f[r]?b?q.put(C,f[r]):q.add(C,f[r]):b?q.put(C):q.add(C);D.onsuccess=function(b){k++;h[r]=b.target.result;k==e.length?P(a,c?h[0]:h,m):(b=r+10,b<e.length&&g(b))};D.onerror=function(b){k++;var f=D.error;M(n.logger,R(a)+p+' request to "'+d+'" cause '+f.name+' for object "'+qe(e[r])+'" at index '+r+" of "+e.length+" objects.");
h[r]=f;m=!0;b.preventDefault();k==e.length?P(a,c?h[0]:h,m):(b=r+10,b<e.length&&g(b))}}var h=[],k=0,m=!1,n=this,p=b?"put":"add",q=a.a.objectStore(d);M(this.logger,R(a)+" "+p+" "+e.length+' objects to store "'+d+'"');if(0<e.length)for(var r=0;10>r&&r<e.length;r++)g(r);else P(a,[])};
l.mb=function(a,b,c){function d(k){var n=c[k],p=n.a,q=a.a.objectStore(p),r;r=null===q.keyPath?q.put(b[k],n.id):q.put(b[k]);r.onsuccess=function(c){f++;e[k]=c.target.result;f==b.length?P(a,e,g):(c=k+10,c<b.length&&d(c))};r.onerror=function(c){f++;K(h.logger,"request result "+c.name+' error when put keys to "'+p+'" for object "'+qe(b[k])+'" at index '+k+" of "+b.length+" objects.");e[k]=r.error;g=!0;c.preventDefault();f==b.length?P(a,e,g):(c=k+10,c<b.length&&d(c))}}var e=[],f=0,g=!1,h=this;M(this.logger,
R(a)+" putByKeys: of "+b.length+" objects");if(0<b.length)for(var k=0;10>k&&k<b.length;k++)d(k);else P(a,e,g)};
l.Qb=function(a,b,c,d,e,f){function g(){var a={},b=e.indexOf("\n",n),d=!1,r;-1==b?(d=!0,r=e.substring(n)):(r=e.substring(n,b),n=b+1);for(var b=r.split(f),J=0;J<p.length;J++){var S=b[J];q[J]&&(q[J]==Od?S=Ea(S):"INTEGER"==q[J]?S=parseInt(S,10):"NUMERIC"==q[J]&&(S=parseFloat(S)));a[p[J]]=S}var Ba=k.put(a);Ba.onsuccess=function(a){m.push(a.target.result);d?c(m):g()};Ba.onerror=function(a){"DataError"==a.name&&(a=new Ke(h+": "+r.substring(0,70)));a.preventDefault();c(Ba.error,!0)}}var h=W(this.a,d),k=
a.objectStore(d),m=[],n=e.indexOf("\n"),p=e.substr(0,n).split(f),q=[];for(a=0;a<p.length;a++){var r=$d(h,p[a]);r?q[a]=r.type:p[a]==h.keyPath&&(q[a]=h.type)}n++;M(this.logger,b+" Loading data  of "+p.length+"-fields record to "+d);g()};
l.nb=function(a,b,c){var d=a.a.objectStore(b);M(this.logger,R(a)+" clearById: "+b+" "+c);var e=d.openCursor(Id.only(c));e.onsuccess=function(b){if(b=b.target.result){var c=b["delete"]();c.onsuccess=function(){P(a,1)};c.onerror=function(){P(a,c.error,!0)}}else P(a,0)};e.onerror=function(b){b.preventDefault();P(a,e.error,!0)}};
l.pb=function(a,b){function c(h){h++;if(h>=b.length)0<g.length?P(a,g,!0):P(a,d);else{b[h].a!=e&&(e=b[h].a,f=a.a.objectStore(e));var k=f["delete"](b[h].id);k.onsuccess=function(){d++;c(h)};k.onerror=function(a){a.preventDefault();g[h]=k.error;c(h)}}}var d=0,e,f;M(this.logger,R(a)+" removeByKeys: "+b.length+" keys");var g=[];c(-1)};
l.ob=function(a,b,c){var d=a.a.objectStore(b),e=d.count(c);M(this.logger,R(a)+" clearByKeyRange: "+b+" "+c);e.onsuccess=function(b){var e=b.target.result,h=d["delete"](c);h.onsuccess=function(){P(a,e)};h.onerror=function(){P(a,h.error,!0)}};e.onerror=function(b){b.preventDefault();P(a,e.error,!0)}};l.zb=function(a,b,c){var d=a.a.objectStore(b);M(this.logger,R(a)+" "+b+" "+c);var e=d["delete"](c);e.onsuccess=function(){P(a,void 0)};e.onerror=function(b){b.preventDefault();P(a,e.error,!0)}};
l.Rb=function(a,b,c,d){var e=a.a.objectStore(b).index(c);M(this.logger,R(a)+" clearByIndexKeyRange: "+b+":"+c+" "+d);var f=[],g=e.openCursor(d),h=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){h++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?P(a,f,!0):P(a,h)};g.onerror=function(b){b.preventDefault();P(a,g.error,!0)}};
l.Sa=function(a,b){var c=b.length,d=0;M(this.logger,R(a)+" clearByStores: "+b);for(var e=0;e<c;e++){var f=a.a.objectStore(b[e]).clear();f.onsuccess=function(){d++;d==c&&P(a,d)};f.onerror=function(b){d++;b.preventDefault();d==c&&P(a,f.error,!0)}}};
l.Ya=function(a,b,c){var d=this;M(this.logger,R(a)+b+":"+c);var e=a.a.objectStore(b),f=e.get(c);f.onsuccess=function(b){M(d.logger,R(a)+" record "+c+(null!=b.target.result?" ":" not ")+" exists.");var f=b.target.result;if(!e.keyPath&&0==e.indexNames.length&&nc&&x(f)&&0<=f.indexOf(";base64,")){'"'==f.charAt(0)&&'"'==f.charAt(f.length-1)&&(f=f.substr(1,f.length-2));f=f.split(";base64,");b=f[0].split(":")[1];for(var f=window.atob(f[1]),k=f.length,m=new Uint8Array(k),n=0;n<k;++n)m[n]=f.charCodeAt(n);
P(a,new Blob([m.buffer],{type:b}))}else P(a,b.target.result)};f.onerror=function(b){b.preventDefault();P(a,f.error,!0)}};
l.Mb=function(a,b,c){function d(b){if(null==c[b])if(f++,e[b]=void 0,f==h)P(a,e);else{var m=b+10;m<h&&d(m)}var n;n=g.get(c[b]);n.onsuccess=function(c){f++;e[b]=c.target.result;f==h?P(a,e):(c=b+10,c<h&&d(c))};n.onerror=function(b){f++;b.preventDefault();P(a,n.error,!0)}}var e=[];e.length=c.length;var f=0,g=a.a.objectStore(b),h=c.length;M(this.logger,R(a)+" "+b+":"+h+" ids");if(0<h)for(b=0;10>b&&b<h;b++)d(b);else P(a,[])};
l.fb=function(a,b){function c(f){var h=b[f],k=a.a.objectStore(h.a).get(h.id);k.onsuccess=function(h){e++;d[f]=h.target.result;e==b.length?P(a,d):(h=f+10,h<b.length&&c(h))};k.onerror=function(b){e++;b.preventDefault();P(a,k.error,!0)}}var d=[];d.length=b.length;var e=0;M(this.logger,R(a)+" "+b.length+" ids");if(0<b.length)for(var f=0;10>f&&f<b.length;f++)c(f);else P(a,[])};
l.Bb=function(a,b,c,d,e){if(d&&e)throw new Vb("unique count not available in IndexedDB");e=a.a.objectStore(b);b=R(a)+" "+b+(d?":"+d:"")+(c?":"+V(c):"");M(this.logger,b);var f;null!=d?(d=e.index(d),f=null!=c?d.count(c):d.count()):f=null!=c?e.count(c):e.count();f.onsuccess=function(b){P(a,b.target.result)};f.onerror=function(b){b.preventDefault();P(a,f.error,!0)}};
l.list=function(a,b,c,d,e,f,g,h,k,m){var n=[],p=a.a.objectStore(c),q=h?k?"prevunique":"prev":k?"nextunique":"next";c=R(a)+" "+b+" "+c+(d?":"+d:"")+(e?V(e):"");h&&(c+=" reverse");k&&(c+=" unique");if(m&&u(m[0])){k=d?!u(m[1]):!0;var r=m[0],z=e?e.lower:void 0,C=e?e.upper:void 0,D=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=Gd(h?new U(z,r,D,k):new U(r,C,k,e));c+=" starting from "+V(m[0]);u(m[1])&&(c+=", "+V(m[1]))}M(this.logger,c);var F;F=1==b||2==b||3==b?d?p.index(d).openKeyCursor(e,q):p.openCursor(e,
q):d?p.index(d).openCursor(e,q):p.openCursor(e,q);var J=!1;F.onsuccess=function(c){if(c=c.target.result){if(!J){if(0<g){J=!0;c.advance(g);return}if(m&&d&&u(m[0]))if(u(m[1])){var e=Zc.cmp(c.key,m[0]),k=h?-1:1;if(0==e){e=Zc.cmp(c.primaryKey,m[1]);if(0==e){J=!0;c["continue"]();return}if(e==k)J=!0;else{c["continue"]();return}}else J=!0}else J=!0;else J=!0}1==b?n.push(c.key):2==b?n.push(c.primaryKey):3==b?(k={},d&&(k[d]=c.key),p.keyPath?k[p.keyPath]=c.primaryKey:k._ROWID_=c.primaryKey,n.push(k)):4==b?
n.push(c.value):n.push([c.key,c.primaryKey,c.value]);if(n.length<f)c["continue"]();else m&&(m[0]=Fd(c.key),m[1]=Fd(c.primaryKey)),P(a,n)}else m&&(m[0]=void 0,m[1]=void 0),P(a,n)};F.onerror=function(b){b.preventDefault();P(a,F.error,!0)}};function tf(a,b,c){a=["ydn.db",a];u(b)&&(a.push(b),u(c)&&(a.push(c),u(void 0)&&a.push(cd(void 0))));return a.join("^|")};function uf(a,b){this.key=a;this.a=b}uf.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(null!=this.a?", "+this.a+")":")")};function vf(a,b){var c=sd(a.key,b.key);return 0===c?null!=a.a?null!=b.a?sd(a.a,b.a):1:null!=b.a?-1:0:c};function wf(a){this.S=a||xf}function xf(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0}l=wf.prototype;l.A=null;l.S=null;l.ba=null;l.$=null;
l.add=function(a){if(null==this.A)return this.$=this.ba=this.A=new yf(a),!0;var b=null;zf(this,function(c){var d=null,e=this.S(c.value,a);0<e?(d=c.left,null==c.left&&(b=new yf(a,c),c.left=b,c==this.ba&&(this.ba=b))):0>e&&(d=c.right,null==c.right&&(b=new yf(a,c),c.right=b,c==this.$&&(this.$=b)));return d});b&&(zf(this,function(a){a.count++;return a.parent},b.parent),Bf(this,b.parent));return!!b};
l.ka=function(a){var b=null;zf(this,function(c){var d=null,e=this.S(c.value,a);0<e?d=c.left:0>e?d=c.right:(b=c.value,Cf(this,c));return d});return b};l.clear=function(){this.$=this.ba=this.A=null};l.contains=function(a){var b=!1;zf(this,function(c){var d=null,e=this.S(c.value,a);0<e?d=c.left:0>e?d=c.right:b=!0;return d});return b};
l.indexOf=function(a){var b=-1,c=0;zf(this,function(d){var e=this.S(d.value,a);if(0<e)return d.left;d.left&&(c+=d.left.count);if(0>e)return c++,d.right;b=c;return null});return b};l.r=function(){return this.A?this.A.count:0};l.u=function(){var a=[];Df(this,function(b){a.push(b)});return a};
function Df(a,b){if(a.A){var c,d=c=Ef(a);for(c=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=c&&d.right!=c)d=d.left;else{if(d.right!=c&&b(d.value))break;var e=d,d=null!=d.right&&d.right!=c?d.right:d.parent;c=e}}}function zf(a,b,c){for(c=c?c:a.A;c&&null!=c;)c=b.call(a,c)}
function Bf(a,b){zf(a,function(a){var b=a.left?a.left.height:0,e=a.right?a.right.height:0;1<b-e?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&Ff(this,a.left),Gf(this,a)):1<e-b&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&Gf(this,a.right),Ff(this,a));b=a.left?a.left.height:0;e=a.right?a.right.height:0;a.height=Math.max(b,e)+1;return a.parent},b)}
function Ff(a,b){Hf(b)?(b.parent.left=b.right,b.right.parent=b.parent):If(b)?(b.parent.right=b.right,b.right.parent=b.parent):(a.A=b.right,a.A.parent=null);var c=b.right;b.right=b.right.left;null!=b.right&&(b.right.parent=b);c.left=b;b.parent=c;c.count=b.count;b.count-=(c.right?c.right.count:0)+1}
function Gf(a,b){Hf(b)?(b.parent.left=b.left,b.left.parent=b.parent):If(b)?(b.parent.right=b.left,b.left.parent=b.parent):(a.A=b.left,a.A.parent=null);var c=b.left;b.left=b.left.right;null!=b.left&&(b.left.parent=b);c.right=b;b.parent=c;c.count=b.count;b.count-=(c.left?c.left.count:0)+1}
function Cf(a,b){if(null!=b.left||null!=b.right){var c=null,d;if(null!=b.left){d=Jf(a,b.left);zf(a,function(a){a.count--;return a.parent},d);if(d!=b.left){if(d.parent.right=d.left)d.left.parent=d.parent;d.left=b.left;d.left.parent=d;c=d.parent}d.parent=b.parent;d.right=b.right;d.right&&(d.right.parent=d);b==a.$&&(a.$=d)}else{d=Ef(a,b.right);zf(a,function(a){a.count--;return a.parent},d);if(d!=b.right){if(d.parent.left=d.right)d.right.parent=d.parent;d.right=b.right;d.right.parent=d;c=d.parent}d.parent=
b.parent;d.left=b.left;d.left&&(d.left.parent=d);b==a.ba&&(a.ba=d)}d.count=b.count;Hf(b)?b.parent.left=d:If(b)?b.parent.right=d:a.A=d;Bf(a,c?c:d)}else zf(a,function(a){a.count--;return a.parent},b.parent),Hf(b)?(b.parent.left=null,b==a.ba&&(a.ba=b.parent),Bf(a,b.parent)):If(b)?(b.parent.right=null,b==a.$&&(a.$=b.parent),Bf(a,b.parent)):a.clear()}function Ef(a,b){if(!b)return a.ba;var c=b;zf(a,function(a){var b=null;a.left&&(b=c=a.left);return b},b);return c}
function Jf(a,b){if(!b)return a.$;var c=b;zf(a,function(a){var b=null;a.right&&(b=c=a.right);return b},b);return c}function yf(a,b){this.value=a;this.parent=b?b:null;this.count=1}yf.prototype.left=null;yf.prototype.right=null;yf.prototype.height=1;function If(a){return!!a.parent&&a.parent.right==a}function Hf(a){return!!a.parent&&a.parent.left==a};function Kf(a){this.S=a||xf}B(Kf,wf);function Lf(a,b,c){if(a.A){var d;if(c instanceof yf)d=c;else if(c){if(zf(a,function(a){var b=null;0<this.S(a.value,c)?(b=a.left,d=a):0>this.S(a.value,c)?b=a.right:d=a;return b}),!d)return}else d=Ef(a);a=d;for(var e=d.left?d.left:d;null!=a;)if(null!=a.left&&a.left!=e&&a.right!=e)a=a.left;else{if(a.right!=e&&b(a))return;var f=a;a=null!=a.right&&a.right!=e?a.right:a.parent;e=f}b(null)}}
function Mf(a,b,c){if(a.A){var d;if(c instanceof yf)d=c;else if(c){if(zf(a,ka(function(a){var b=null;0<this.S(a.value,c)?b=a.left:(0>this.S(a.value,c)&&(b=a.right),d=a);return b},a)),!d)return}else d=Jf(a);a=d;for(var e=d.right?d.right:d;null!=a;)if(null!=a.right&&a.right!=e&&a.left!=e)a=a.right;else{if(a.left!=e&&b(a))return;var f=a;a=null!=a.left&&a.left!=e?a.left:a.parent;e=f}b(null)}};function Nf(a,b,c){this.e=a;this.storage=b;this.b=c;this.a={};a=this.b.keyPath;this.c=v(a)?a.join(","):a||"_ROWID_";this.a[this.c]=null;this.d=tf(this.e,this.b.getName(),this.c)+"^|"}
function Of(a,b){var c=b||a.c;if(!a.a[c]){a.a[c]=new Kf(vf);for(var d=a.storage.length,e=0;e<d;e++){var f=a.storage.key(e);if(null!==f&&0==f.lastIndexOf(a.d,0)){var g=fd(f.substr(a.d.length));if(c==a.c)a.a[c].add(new uf(g));else{var h=a.storage.getItem(f);if(null!==h)if(f=$d(a.b,c),h=pe(h),h=Pd(f,h),f.multiEntry){if(v(h))for(f=0;f<h.length;f++)a.a[c].add(new uf(h[f],g))}else a.a[c].add(new uf(h,g))}}}}return a.a[c]}
function Pf(a,b,c){for(var d in a.a){var e=a.a[d];if(e)if(d==a.c)e.ka(new uf(b));else{var f=$d(a.b,d),f=$c(c,f.keyPath);e.ka(new uf(b,f))}}}function Qf(a){for(var b in a.a){var c=a.a[b];c&&c.clear()}a.a={}}
function Rf(a,b,c,d){if(null==b&&(a.b.keyPath&&(b=ie(a.b,c)),a.b.c&&null==b)){b=a.d+cd(void 0);var e=pe(a.storage.getItem(b));e.key_count||(e.key_count=0);e.key_count++;a.storage.setItem(b,V(e));b=e.key_count}d&&(d=null!==a.storage.getItem(a.d+cd(b)));if(d)return null;a.storage.setItem(a.d+cd(b),V(c));d=b;for(var f in a.a)if(e=a.a[f])if(f==a.c)e.add(new uf(d));else{var g=$d(a.b,f),g=$c(c,g.keyPath);null!=g&&e.add(new uf(d,g))}return b}
function Sf(a,b){var c=a.d+cd(b),d=a.storage.getItem(c);if(null===d)return 0;a.storage.removeItem(c);c=pe(d);Pf(a,b,c);return 1}Nf.prototype.clear=function(){Qf(this);Tf(this)};function Uf(a,b){var c=a.storage.getItem(a.d+cd(b)),d=void 0;if(null!==c)for(var d=pe(c),c=0,e=a.b.a.length;c<e;c++){var f=a.b.index(c);if("DATE"==f.type){var g=Pd(f,d);g&&Qd(f,d,new Date(g))}}return d}Nf.prototype.getName=function(){return this.b.getName()};
function Vf(a,b,c){b=b||a.c;a=Of(a,b);var d=null,e=null,f=0,g=!1,h=!1;null!=c&&(null!=c.lower&&(d=new uf(c.lower)),null!=c.upper&&(e=new uf(c.upper)),g=c.lowerOpen,h=c.upperOpen);Lf(a,function(a){if(null!=a&&(a=a.value,!g||null==d||0!=sd(a.key,d.key))){if(null!=e&&(a=sd(a.key,e.key),1===a||0===a&&h))return!0;f++}},d);return f}
function Tf(a,b){var c=Of(a,a.c),d=null,e=null,f=0,g=[],h=[],k=!1,m=!1;null!=b&&(null!=b.lower&&(d=new uf(b.lower)),null!=b.upper&&(e=new uf(b.upper)),k=b.lowerOpen,m=b.upperOpen);Lf(c,function(b){if(null!=b&&(b=b.value,!k||null==d||0!=vf(b,d))){if(null!=e){var c=vf(b,e);if(1===c||0===c&&m)return!0}var c=a.d+cd(b.key),q=a.storage.getItem(c);null!==q&&(a.storage.removeItem(c),f++,10>g.length&&(g.push(b.key),h.push(pe(q))))}},d);if(10>g.length)for(c=0;c<g.length;c++)Pf(a,g[c],h[c]);else Qf(a);return f}
function Wf(a,b,c,d,e,f,g,h,k){function m(c){if(c&&(D++,!(D<g))){var d=c.value;if(e){if(J&&null!=C&&(c=q?vf(d,C):sd(d.key,C.key),0==c))return;if(null!=z&&(c=q?vf(d,z):sd(d.key,z.key),-1==c||0==c&&F))return k&&(k[0]=void 0,k[1]=void 0),!0}else{if(F&&null!=z&&(c=q?vf(d,z):sd(d.key,z.key),0==c))return;if(null!=C&&(c=q?vf(d,C):sd(d.key,C.key),1==c||0==c&&J))return k&&(k[0]=void 0,k[1]=void 0),!0}c=d.key;if(!h||!r||null==p||0!=sd(p,c)){d=r?d.a:c;if(2==b)n.push(d);else if(1==b)n.push(c);else if(3==b)n.push([c,
d]);else if(4==b){var m=Uf(a,d);n.push(m)}else n.push([c,d,Uf(a,d)]);k&&(k[0]=c,k[1]=d)}p=c;if(u(f)&&n.length>=f)return!0}}var n=[],p,q=!!k&&null!=k[0];c=c||a.c;var r=c!=a.c;c=Of(a,c);var z=null,C=null;u(g)||(g=0);var D=-1,F=!1,J=!1;null!=d&&(null!=d.lower&&(z=r&&e?new uf(d.lower,"\uffff"):new uf(d.lower)),null!=d.upper&&(C=r&&!e?new uf(d.upper,"\uffff"):new uf(d.upper)),F=!!d.lowerOpen,J=!!d.upperOpen);if(q){e?J=!0:F=!0;d=k[0];var S=u(k[1])?k[1]:"\uffff";e?C=r?new uf(d,S):new uf(d):z=r?new uf(d,
S):new uf(d)}e?Mf(c,m,C):Lf(c,m,z);return n}Nf.prototype.C=function(a,b,c,d,e){return Wf(this,2,a,b,c,d,e)};Nf.prototype.toString=function(){return"ydn.db.con.simple.Store:"+this.e+":"+this.b.getName()};function Xf(){this.clear()}l=Xf.prototype;l.Ab=function(){return this};l.setItem=function(a,b){u(this.a[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.a[a]=b};l.getItem=function(a){return u(this.a[a])?this.a[a]:null};l.removeItem=function(a){delete this.a[a];Va(this.keys,a.toString());this.length=this.keys.length};l.length=0;l.key=function(a){a=this.keys[a];return u(a)?this.a[a]:null};l.clear=function(){this.a={};this.keys=[];this.length=0};function Yf(a){this.f=a||new Xf;this.e={}}function Zf(a,b){var c=W(a.a,b);if(c)a.e[b]||(a.e[b]=new Nf(a.d,a.c,c));else throw new Wb('store name "'+b+'" not found.');return a.e[b]}Yf.prototype.P=function(a){var b=this;setTimeout(function(){var c=tf(b.d),c=b.c.getItem(c),c=new ue(c);a(c)},10)};function $f(a,b){this.b=a;this.a=b}$f.prototype.i=function(a,b){var c=this.b;setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.a("complete",null);d.a=null;d.b=null}};function df(a,b){this.a=b}B(df,Qe);l=df.prototype;l.logger=I("ydn.db.crud.req.SimpleStore");l.mb=function(a,b,c){this.U(a,!0,!1,null,b,c)};
l.U=function(a,b,c,d,e,f){M(this.logger,R(a)+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects"));var g=a.a.i(function(h){var k;if(c)k=Zf(h,d),h=f?f[0]:void 0,h=Rf(k,h,e[0],!b),null!=h?P(a,h):(k=qe(h),k=new Je(k),P(a,k,!0));else{for(var m=d,n=[],p=!1,q=f||{},r=0;r<e.length;r++){var z;d?z=q[r]:(m=f[r],z=m.id,m=m.a);k&&k.getName()==m||(k=Zf(h,m));z=Rf(k,z,e[r],!b);null!=z?n.push(z):(p=!0,n.push(new Je))}P(a,n,p)}g();g=null},this)};l.Qb=function(){throw new Ub("putData");};
l.Ya=function(a,b,c){var d=a.a.i(function(e){e=Uf(Zf(e,b),c);P(a,e);d();d=null},this)};function ag(a,b,c,d){var e=b.a.i(function(a){for(var g=[],h=c,k,m=0;m<d.length;m++){var n=d[m];n instanceof T&&(h=n,n=h.id,h=h.a);k&&k.getName()==h||(k=Zf(a,h));n=Uf(k,n);g[m]=n}P(b,g,!1);e();e=null},a)}l.Mb=function(a,b,c){ag(this,a,b,c)};l.fb=function(a,b){ag(this,a,null,b)};
l.nb=function(a,b,c){var d=R(a)+" removeById "+b+" "+c;M(this.logger,d);var e=this,f=a.a.i(function(g){g=Sf(Zf(g,b),c);N(e.logger,"success "+d+(0==g?" [not found]":""));P(a,g);f();f=null},this)};l.pb=function(a,b){M(this.logger,R(a)+" removeByKeys "+b.length+" keys");var c,d=0,e=a.a.i(function(f){for(var g=0;g<b.length;g++){var h=b[g].a,k=b[g].id;c&&c.getName()==h||(c=Zf(f,h));d+=Sf(c,k)}P(a,d);e();e=null},this)};l.zb=function(a,b,c){this.ob(a,b,c)};
l.ob=function(a,b,c){var d=R(a)+" removeByKeyRange "+(c?V(c):"");M(this.logger,d);var e=this,f=a.a.i(function(g){g=Tf(Zf(g,b),c);N(e.logger,d+" deleted "+g+" records.");P(a,g);f();f=null},this)};l.Rb=function(a,b,c,d){var e=R(a)+" removeByIndexKeyRange "+(d?V(d):"");M(this.logger,e);var f=a.a.i(function(e){e=Zf(e,b);for(var h=e.C(c,d),k=h.length,m=0;m<k;m++)Sf(e,h[m]);P(a,k);f();f=null},this)};
l.Sa=function(a,b){var c=R(a)+" clearByStores";M(this.logger,c);var d=a.a.i(function(e){for(var f=0;f<b.length;f++)Zf(e,b[f]).clear();N(this.logger,"success "+c);P(a,b.length);d();d=null},this)};l.Ua=function(a,b){var c=a.a.i(function(d){for(var e=[],f=0;f<b.length;f++){var g=Zf(d,b[f]);e.push(Vf(g))}P(a,e);c();c=null},this)};
l.Bb=function(a,b,c,d){var e=R(a)+" count"+(null!=d?"Index":"")+(null!=c?"KeyRange":"Store");M(this.logger,e);var f=a.a.i(function(g){g=Vf(Zf(g,b),d,c);N(this.logger,"success "+e);P(a,g);f();f=null},this)};l.list=function(a,b,c,d,e,f,g,h,k,m){var n=R(a)+" "+c+" "+(e?qe(e):"");M(this.logger,n);var p=a.a.i(function(q){q=Wf(Zf(q,c),b,d,e,h,f,g,k,m);N(this.logger,n+" "+q.length+" records found.");P(a,q);p();p=null},this)};function cf(a,b){this.a=b}B(cf,Qe);l=cf.prototype;l.logger=I("ydn.db.crud.req.WebSql");
function bg(a,b){if(b.sa&&!b.keyPath&&0==b.a.length&&a._default_){var c=a._default_;if(-1==c.indexOf(";base64,"))return pe(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a._default_?pe(a._default_):{};null!=b.keyPath&&(d=Rd(a[b.keyPath],b.type),null!=d&&je(b,c,d));for(d=0;d<b.a.length;d++)e=b.index(d),
f=e.e,"_default_"==f||e.f||e.multiEntry||"DATE"!=e.type&&!b.sa||(f=Rd(a[f],e.type),u(f)&&Qd(e,c,f));return c}l.Qb=function(){throw new Ub("putData");};
l.U=function(a,b,c,d,e,f){function g(b,d){if(null==e[b])if(M(m.logger,"empty object at "+b+" of "+e.length),p++,p==e.length)N(m.logger,q+" success "+q),P(a,n,r);else{var D=b+2;D<e.length&&g(D,d)}var F;F=u(f)?ke(h,e[b],f[b]):ke(h,e[b]);D=k+ae(h)+" ("+F.oc.join(", ")+") VALUES ("+F.zc.join(", ")+");";M(m.logger,R(a)+" SQL: "+D+" PARAMS: "+F.N+" REQ: "+b+" of "+e.length);d.executeSql(D,F.N,function(f,q){function D(b,c){var e="ydn.db.me:"+h.getName()+":"+b.getName(),e=k+Ha(e)+" ("+h.e+", "+b.c+") VALUES (?, ?)",
f=[Ld(oa,h.type),Ld(c,b.type)];M(m.logger,R(a)+" multiEntry "+e+" "+f);d.executeSql(e,f,function(){},function(a,b){K(m.logger,"multiEntry index insert error: "+b.message);return!1})}p++;var oa=u(F.key)?F.key:q.insertId;1>q.rowsAffected&&(r=!0,oa=new Je(oa+" no-op"));for(var kb=0,fe=h.a.length;kb<fe;kb++){var Bb=h.index(kb);if(Bb.multiEntry)for(var dc=$c(e[b],Bb.keyPath),Oj=(dc?dc.length:0)||0,Af=0;Af<Oj;Af++)D(Bb,dc[Af])}c?P(a,oa):(n[b]=oa,p==e.length?P(a,n,r):(kb=b+2,kb<e.length&&g(kb,f)))},function(d,
f){p++;r=!0;6==f.code?f.name="ConstraintError":K(m.logger,"error: "+f.message+" "+q);if(c)P(a,f,!0);else if(n[b]=f,p==e.length)M(m.logger,"success "+q),P(a,n,r);else{var h=b+2;h<e.length&&g(h,d)}return!1})}b=!b;var h=W(this.a,d),k=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.a;var m=this,n=[],p=0,q=R(a)+" inserting "+e.length+" objects.",r=!1;if(0<e.length)for(b=0;2>b&&b<e.length;b++)g(b,d);else N(this.logger,"success"),P(a,[])};
l.mb=function(a,b,c){if(0==c.length)P(a,[]);else{for(var d=[],e=0,f=0,g=this,h=function(h,k){var m=[];M(g.logger,"put "+k.length+" objects to "+h);for(var n=he(W(g.a,h)),p=n?void 0:[],q=0;q<k.length;q++)m.push(b[k[q]]),n||p.push(c[k[q]].id);n=nd(a);G(n,function(b){for(var c=0;c<k.length;c++)d[k[c]]=b[c];e++;e==f&&P(a,d)},function(){e++;e==f&&P(a,d,!0)});g.U(n,!1,!1,h,m,p)},k="",m=[],n=[],p=0;p<c.length;p++){var q=c[p].a,r=c[p].id;q!=k?(f++,0<m.length&&h(k,m),m=[p],n=[r],k=q):(m.push(p),n.push(r))}0<
m.length&&h(k,m)}};l.Ya=function(a,b,c){var d=a.a,e=W(this.a,b),f=this;b=e.e;c=[Ld(c,e.type)];b="SELECT * FROM "+ae(e)+" WHERE "+b+" = ?";var g=R(a)+" SQL: "+b+" PARAMS: "+c;M(this.logger,g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);null!=d?(d=bg(d,e),P(a,d)):(N(f.logger,"success no result: "+g),P(a,void 0))}else N(f.logger,"success no result: "+g),P(a,void 0)},function(b,c){K(f.logger,"error: "+g+" "+c.message);P(a,c,!0);return!1})};
l.Mb=function(a,b,c){function d(b,e){var p=k.e,q=[Ld(c[b],k.type)],r="SELECT * FROM "+ae(k)+" WHERE "+p+" = ?";M(f.logger,"SQL: "+r+" PARAMS: "+q);e.executeSql(r,q,function(e,f){h++;if(0<f.rows.length){var n=f.rows.item(0);null!=n&&(g[b]=bg(n,k))}else g[b]=void 0;h==c.length?P(a,g):(n=b+10,n<c.length&&d(n,e))},function(e,k){h++;K(f.logger,"error: "+r+" "+k.message);if(h==c.length)P(a,g);else{var n=b+10;n<c.length&&d(n,e)}return!1})}var e=a.a,f=this,g=[],h=0,k=W(this.a,b);if(0<c.length)for(b=0;10>
b&&b<c.length;b++)d(b,e);else N(f.logger,"success"),P(a,[])};
l.fb=function(a,b){function c(d,h){var n=b[d],p=W(e.a,n.a),q=Ed(n),n=p.e,q=[Ld(q,p.type)],r="SELECT * FROM "+ae(p)+" WHERE "+n+" = ?";M(e.logger,"SQL: "+r+" PARAMS: "+q);h.executeSql(r,q,function(h,m){g++;if(0<m.rows.length){var n=m.rows.item(0);null!=n&&(f[d]=bg(n,p))}else f[d]=void 0;g==b.length?(M(e.logger,"success "+r),P(a,f)):(n=d+10,n<b.length&&c(n,h))},function(b,c){P(a,c,!0);return!1})}var d=a.a,e=this,f=[],g=0;if(0<b.length)for(var h=0;10>h&&h<b.length;h++)c(h,d);else M(this.logger,"success"),
P(a,[])};
l.Sa=function(a,b){function c(d,g){function h(a){a="ydn.db.me:"+k.getName()+":"+a.getName();a="DELETE FROM  "+Ha(a);M(e.logger,"SQL: "+a);g.executeSql(a,[])}var k=W(e.a,b[d]),m="DELETE FROM  "+ae(k);M(e.logger,"SQL: "+m+" PARAMS: []");g.executeSql(m,[],function(g){d==b.length-1?(M(e.logger,"success "+m),P(a,b.length)):c(d+1,g)},function(b,c){P(a,c,!0);return!1});for(var n=0,p=k.a.length;n<p;n++){var q=k.index(n);q.multiEntry&&h(q)}}var d=a.a,e=this;0<b.length?c(0,d):(M(this.logger,"success"),P(a,
0))};
l.pb=function(a,b){function c(h){if(h>=b.length)P(a,f,g);else{var k=W(e.a,b[h].a),m=Ld(b[h].id,k.type),n=" WHERE "+k.e+" = ?",p="DELETE FROM "+ae(k)+n,q=R(a)+" SQL: "+p+" PARAMS: "+[m];d.executeSql(p,[m],function(){f++;c(h)},function(a,b){K(e.logger,"error: "+q+b.message);g=!0;c(h);return!1});h++;for(var p=function(b){b="ydn.db.me:"+k.getName()+":"+b.getName();b="DELETE FROM  "+Ha(b)+n;M(e.logger,R(a)+NaN+b);d.executeSql(b,[m])},r=0,z=k.a.length;r<z;r++){var C=k.index(r);C.multiEntry&&p(C)}}}var d=
a.a,e=this,f=0,g=!1;M(this.logger,R(a)+" removeByKeys: "+b.length+" keys");c(0)};
l.nb=function(a,b,c){function d(b){b="ydn.db.me:"+f.getName()+":"+b.getName();b="DELETE FROM  "+Ha(b)+k;M(h.logger,R(a)+NaN+b);e.executeSql(b,[g])}var e=a.a,f=W(this.a,b),g=Ld(c,f.type),h=this,k=" WHERE "+f.e+" = ?";b="DELETE FROM "+ae(f)+k;M(this.logger,R(a)+" SQL: "+b+" PARAMS: "+[g]);e.executeSql(b,[g],function(b,c){P(a,c.rowsAffected)},function(b,c){P(a,c,!0);return!1});b=0;for(c=f.a.length;b<c;b++){var m=f.index(b);m.multiEntry&&d(m)}};l.zb=function(a,b,c){cg(this,a,b,void 0,c)};
l.ob=function(a,b,c){cg(this,a,b,void 0,c)};l.Rb=function(a,b,c,d){cg(this,a,b,c,d)};
function cg(a,b,c,d,e){function f(c){c="ydn.db.me:"+h.getName()+":"+c.getName();c="DELETE FROM  "+Ha(c)+n;M(a.logger,R(b)+NaN+c);g.executeSql(c,m)}var g=b.a,h=W(a.a,c);c="DELETE FROM "+ae(h);var k=[],m=[],n="";null!=e&&(u(d)?(d=$d(h,d),Kd(d.c,d.type,e,m,k)):Kd(h.e,h.type,e,m,k),n=" WHERE "+m.join(" AND "));c+=n;var p=R(b)+" SQL: "+c+" PARAMS: "+k;M(a.logger,p);g.executeSql(c,k,function(c,d){M(a.logger,"success "+p);P(b,d.rowsAffected)},function(c,d){K(a.logger,"error: "+p+d.message);P(b,d,!0);return!1});
e=0;for(d=h.a.length;e<d;e++)c=h.index(e),c.multiEntry&&f(c)}l.Ua=function(a,b){function c(g){var h="SELECT COUNT(*) FROM "+Ha(b[g]);M(e.logger,"SQL: "+h+" PARAMS: []");d.executeSql(h,[],function(d,e){var h=e.rows.item(0);f[g]=parseInt(h["COUNT(*)"],10);g++;g==b.length?P(a,f):c(g)},function(b,c){P(a,c,!0);return!1})}var d=a.a,e=this,f=[];0==b.length?(M(this.logger,"success"),P(a,0)):c(0)};
l.Bb=function(a,b,c,d,e){var f=[];b=Yd(W(this.a,b),f,6,d,c,!1,e);M(this.logger,R(a)+" SQL: "+b+" PARAMS: "+f);a.a.executeSql(b,f,function(b,c){var d;a:{if(d=c.rows.item(0))for(var e in d)if(d.hasOwnProperty(e)){d=d[e];break a}d=void 0}P(a,d)},function(b,c){P(a,c,!0);return!1})};
l.list=function(a,b,c,d,e,f,g,h,k,m){var n=this,p=[],q=W(this.a,c),r=q.g,z=q.type,C=z,D=null!=d&&d!==r?$d(q,d):null,F=d||r;D&&(C=D.type);c=[];if(m&&u(m[0])){var J=m[0];D&&u(m[1])?(d=m[1],e=ce(q,b,c,D.getName(),e,J,d,h,k)):e=be(q,b,c,d,e,h,k,J)}else e=Yd(q,c,b,F,e,h,k);y(f)&&(e+=" LIMIT "+f);y(g)&&(e+=" OFFSET "+g);var S=a+" SQL: "+e+" ;params= "+V(c);M(this.logger,S);a.a.executeSql(e,c,function(c,d){for(var e=d.rows.length,f,g=0;g<e;g++)f=d.rows.item(g),2==b?p[g]=Rd(f[r],z):1==b?p[g]=Rd(f[F],C):3==
b?p[g]=[Rd(f[F],C),Rd(f[r],z)]:null!=f&&(p[g]=bg(f,q));N(n.logger,"success "+a);m&&f&&(m[0]=Rd(f[F],C),m[1]=Rd(f[r],z));P(a,p)},function(b,c){K(n.logger,"error: "+S+c.message);P(a,c,!0);return!1})};var dg;dg=!1;var eg=$a;eg&&(-1!=eg.indexOf("Firefox")||-1!=eg.indexOf("Camino")||-1!=eg.indexOf("iPad")||-1!=eg.indexOf("iPhone")||-1!=eg.indexOf("iPod")||-1!=eg.indexOf("Chrome")||-1!=eg.indexOf("Android")||-1!=eg.indexOf("Safari")&&(dg=!0));var fg=dg;function gg(a,b){u(a)&&5242880<a&&Tc(this.logger,Fc,"storage size request ignored, use Quota Management API instead");this.o=null;this.La=b||NaN}l=gg.prototype;
l.Ba=function(a,b){function c(a,c,d){N(e.logger,(d?"changing":"upgrading")+" version to "+a.version+" from "+g);for(d=0;d<b.a.length;d++)hg(e,a,c,b.a[d]);c=a.objectStoreNames;var f=c.length;for(d=0;d<f;d++)we(b,c[d])||(a.deleteObjectStore(c[d]),N(e.logger,"store: "+c[d]+" deleted."))}function d(a,b){f.c?K(e.logger,"database already set."):u(b)?(K(e.logger,b?b.message:"Error received."),e.o=null,f.h(b)):(e.o=a,e.o.onabort=function(a){M(e.logger,e+": abort");e.Ka(a.target.error)},e.o.onerror=function(a){M(e.logger,
e+": error");e.Ka(a.target.error)},e.o.onversionchange=function(a){M(e.logger,e+" closing connection for onversionchange to: "+a.version);if(e.o&&(e.o.onabort=null,e.o.onblocked=null,e.o.onerror=null,e.o.onversionchange=null,e.kb(a),!a.defaultPrevented)){e.o.close();e.o=null;var b=Error();b.name=a.type;e.ib(b)}},f.j(parseFloat(g)))}var e=this,f=new E,g=void 0,h=b.version;Tc(this.logger,Jc,"Opening database: "+a+" ver: "+(b.c?"auto":h));var k;k=u(h)?Zc.open(a,h):Zc.open(a);k.onsuccess=function(f){var h=
f.target.result;u(g)||(g=h.version);Tc(e.logger,Jc,"Database: "+h.name+", ver: "+h.version+" opened.");if(b.c)e.P(function(f){if(b instanceof ye)for(var g=0;g<f.a.length;g++)we(b,f.a[g].getName())||ze(b,f.a[g].clone());f=xe(b,f,!1,!0);if(0<f.length){Tc(e.logger,Jc,"Schema change require for difference in "+f);var k=y(h.version)?h.version+1:1;if("IDBOpenDBRequest"in t){h.close();var m=Zc.open(a,k);m.onupgradeneeded=function(a){a=a.target.result;Tc(e.logger,Jc,"re-open for version "+a.version);c(a,
m.transaction,!1)};m.onsuccess=function(a){d(a.target.result)};m.onerror=function(){Tc(e.logger,Jc,e+": fail.");d(null)}}else{var p=h.setVersion(k+"");p.a=function(a){K(e.logger,"migrating from "+h.version+" to "+k+" failed.");d(null,a)};p.onsuccess=function(){p.transaction.oncomplete=F;c(h,p.transaction,!0)};var F=function(){var b=Zc.open(a);b.onsuccess=function(a){a=a.target.result;Tc(e.logger,Jc,e+": OK.");d(a)};b.onerror=function(){Tc(e.logger,Jc,e+": fail.");d(null)}};null!=p.transaction&&(p.transaction.oncomplete=
F)}}else d(h)},void 0,h);else if(b.version>h.version){var k=h.setVersion(b.version);k.a=function(a){K(e.logger,"migrating from "+h.version+" to "+b.version+" failed.");d(null,a)};k.onsuccess=function(){c(h,k.transaction,!0)}}else b.version==h.version?Tc(e.logger,Jc,"database version "+h.version+" ready to go"):K(e.logger,"connected database version "+h.version+" is higher than requested version."),e.P(function(a){a=xe(b,a,!1,!0);0<a.length?(Tc(e.logger,Jc,a),d(null,new Ce("different schema: "+a))):
d(h)},void 0,h)};k.onupgradeneeded=function(a){a=a.target.result;g=NaN;Tc(this.logger,Jc,"upgrade needed for version "+a.version);c(a,k.transaction,!1)};k.onerror=function(c){var f=e.logger;f&&Oc(f,'open request to database "'+a+'" '+(u(b.version)?" with version "+b.version:"")+" cause error of "+k.error.name);d(null,c)};k.onblocked=function(c){var f=e.logger;f&&Oc(f,"database "+a+" "+b.version+" block, close other connections.");d(null,c)};y(this.La)&&!isNaN(this.La)&&setTimeout(function(){if("done"!=
k.readyState){var a=e.logger;a&&Oc(a,e+": database state is still "+k.readyState);d(null,new Pe("connection timeout after "+e.La))}},this.La);return f};l.La=18E4;l.ib=function(){};l.Ka=function(){};l.kb=function(){};l.Ca=function(){return"indexeddb"};l.Tb=function(){return this.o||null};l.tb=function(){return!!this.o};l.logger=I("ydn.db.con.IndexedDb");l.o=null;l.sb=function(){return this.o?parseFloat(this.o.version):void 0};
l.P=function(a,b,c){c=c||this.o;if(u(b)){if(null===b){if(0==c.objectStoreNames.length){a(new ue(c.version));return}throw new Be;}c=b.db}else{b=[];for(var d=c.objectStoreNames.length-1;0<=d;d--)b[d]=c.objectStoreNames[d];if(0==b.length){a(new ue(c.version));return}b=c.transaction(b,Xc)}for(var e=c.objectStoreNames,f=[],g=e.length,d=0;d<g;d++){for(var h=b.objectStore(e[d]),k=[],m=0,n=h.indexNames.length;m<n;m++){var p=h.index(h.indexNames[m]);k[m]=new Md(p.keyPath,void 0,p.unique,p.multiEntry,p.name)}f[d]=
new Wd(h.name,h.keyPath,h.autoIncrement,void 0,k)}b=new ue(c.version,f);a(b)};
function hg(a,b,c,d){function e(){var a={autoIncrement:!!d.c};null!=d.keyPath&&(a.keyPath=d.keyPath);return b.createObjectStore(d.getName(),a)}Tc(a.logger,Kc,"Creating Object Store for "+d.getName()+" keyPath: "+d.keyPath);if(b.objectStoreNames.contains(d.getName())){c=c.objectStore(d.getName());Td(d.keyPath||"",c.keyPath||"")?(b.deleteObjectStore(d.getName()),Tc(a.logger,Fc,"store: "+d.getName()+" deleted due to keyPath change."),c=e()):ea(c.autoIncrement)&&ea(d.c)&&c.autoIncrement!=d.c&&(b.deleteObjectStore(d.getName()),
Tc(a.logger,Fc,"store: "+d.getName()+" deleted due to autoIncrement change."),c=e());for(var f=c.indexNames,g=0;g<d.a.length;g++){var h=d.index(g);!f.contains(h.getName())&&h.d&&(c.clear(),Tc(a.logger,Fc,"store: "+d.getName()+" cleared since generator index need re-indexing."))}for(var k=0,m=0,n=0,g=0;g<d.a.length;g++){var h=d.index(g),p=!1;if(f.contains(h.getName())){var q=c.index(h.getName()),r=null!=q.unique&&null!=h.unique&&q.unique!=h.unique,z=null!=q.multiEntry&&null!=h.multiEntry&&q.multiEntry!=
h.multiEntry,q=null!=q.keyPath&&null!=h.keyPath&&!!Td(q.keyPath,h.keyPath);if(r||z||q)c.deleteIndex(h.getName()),p=!0,k--,n++}else"BLOB"!=h.type&&(p=!0);p&&(h.unique||h.multiEntry?(p={unique:h.unique,multiEntry:h.multiEntry},c.createIndex(h.getName(),h.keyPath,p)):c.createIndex(h.getName(),h.keyPath),k++)}for(g=0;g<f.length;g++)ee(d,f[g])||(c.deleteIndex(f[g]),m++);Tc(a.logger,Kc,"Updated store: "+c.name+", "+k+" index created, "+m+" index deleted, "+n+" modified.")}else{c=e();for(g=0;g<d.a.length;g++)h=
d.index(g),"BLOB"==h.type?Tc(a.logger,Gc,"Index "+h+" of blob data type ignored."):(Tc(a.logger,Kc,"Creating index: "+h),h.unique||h.multiEntry?(p={unique:h.unique,multiEntry:h.multiEntry},c.createIndex(h.getName(),h.keyPath,p)):c.createIndex(h.getName(),h.keyPath));Tc(a.logger,Kc,"Created store: "+c)}}
l.Va=function(a,b,c,d){var e=this.o;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d("complete",a)},b.onabort=function(a){d("abort",a)},a(b),a=null)};l.close=function(){Tc(this.logger,Kc,this+" closing connection");this.o.close()};l.toString=function(){return"IndexedDB:"+(this.o?this.o.name+":"+this.o.version:"")};
td.push(function(a,b){if(!Zc||b&&"indexeddb"!=b)return null;var c=Zc.deleteDatabase(a),d=new ld("IDBVersionChangeEvent ");c.onblocked=function(a){Vc(d,a)};c.onerror=function(a){d.h(a)};c.onsuccess=function(a){d.j(a)};return d});function ig(a){Yf.call(this,a);this.b=NaN}B(ig,Yf);l=ig.prototype;l.logger=I("ydn.db.con.SimpleStorage");l.sb=function(){return this.b};
l.Ba=function(a,b){function c(a,b){setTimeout(function(){b?(N(d.logger,d+" opening fail"),e.h(b)):(N(d.logger,d+" version "+d.sb()+" open"),e.j(a))},10)}var d=this,e=new E;this.c=this.f.Ab(a);this.d=a;this.a=b;var f=tf(this.d);this.b=NaN;var g=pe(this.c.getItem(f));u(g.version)&&!y(g.version)&&(g.version=NaN);if(g)if(g=new ue(g),xe(this.a,g,!1,!1))if(!this.a.c&&!isNaN(g.version)&&this.a.version>g.version)c(NaN,new Le("existing version "+g.version+" is larger than "+this.a.version));else{var h=this.a.version;
this.b=u(h)?h:g.version+1;for(h=0;h<this.a.count();h++)var k=this.a.a[h]||null;if(this.a instanceof ye)for(h=0;h<g.count();h++)k=g.a[h]||null,ze(this.a,k);h=this.a.toJSON();h.version=this.b||NaN;this.c.setItem(f,V(h));c(g.version||NaN)}else{for(h=0;h<this.a.count();h++)k=this.a.a[h]||null;this.b=g.version||NaN;c(this.b)}else g=b.toJSON(),this.b=1,g.version=this.b,this.c.setItem(f,V(g)),c(NaN);return e};l.tb=function(){return!!this.d};l.Tb=function(){return this.c||null};l.ib=function(){};l.Ka=function(){};
l.kb=function(){};l.Ca=function(){return"memory"};l.close=function(){};l.Va=function(a,b,c,d){a(new $f(this,function(a,b){d(a,b)}))};l.toString=function(){return"SimpleStorage:"+this.Ca()+":"+(this.d+":"+this.b)};function jg(){ig.call(this,this)}B(jg,ig);jg.prototype.Ab=function(){return window.localStorage};jg.prototype.Ca=function(){return"localstorage"};td.push(function(a,b){if(!b||"localstorage"==b){var c=new jg,d=new ye;c.Ba(a,d);c.P(function(a){for(var b=0;b<a.a.length;b++)Zf(c,a.a[b].getName()).clear()})}});function kg(){ig.call(this,this)}B(kg,ig);kg.prototype.Ab=function(){return window.sessionStorage};kg.prototype.Ca=function(){return"sessionstorage"};
td.push(function(a,b){if(!b||"sessionstorage"==b){var c=new kg,d=new ye;c.Ba(a,d);c.P(function(a){for(var b=0;b<a.a.length;b++)Zf(c,a.a[b].getName()).clear()})}});function lg(a,b){this.a=u(a)?a:4194304;this.b=b||"websql"}l=lg.prototype;
l.Ba=function(a,b){function c(b,c){var f=b.version?parseInt(b.version,10):0,g=c.c?isNaN(f)?1:f+1:c.version;L(e.logger,a+": changing version from "+b.version+" to "+g);var h=!1,k=0;b.changeVersion(b.version,g+"",function(a){e.P(function(b){h=!0;for(var d=0;d<c.count();d++){var f=W(b,(c.a[d]||null).getName()),f=f?ge(f,c.a[d]||null):null;mg(e,a,c.a[d]||null,function(a){a&&k++},f)}for(d=0;d<b.count();d++)f=b.a[d]||null,we(c,f.getName())||(c instanceof ye?ze(c,f):(f="DROP TABLE "+ae(f),N(e.logger,f),a.executeSql(f,
[],function(){},function(a,b){throw b;})))},a,b)},function(c){var d=e.logger;d&&Oc(d,"SQLError "+c+" "+c.code+"("+c.message+") while changing version from "+b.version+" to "+g+" on "+a);throw c;},function(){if(h){var f=".";k!=c.a.length&&(f=" but unexpected stores exists.");M(e.logger,a+":"+b.version+" ready"+f);d(b)}else K(e.logger,a+": changing version voided.")})}function d(a,b){u(b)?(e.B=null,g.h(b)):(e.B=a,g.j(parseFloat(f)))}var e=this,f=NaN,g=new E,h=null;try{"sqlite"==this.b?t.sqlitePlugin?
(h=t.sqlitePlugin.openDatabase(a,"",a,this.a),h.readTransaction||(h.readTransaction=h.transaction),h.changeVersion=function(a,b,c,d,e){h.transaction(c,d,e)}):(K(this.logger,"sqlitePlugin not found."),h=null,this.eb=Error("sqlitePlugin not found.")):h=t.openDatabase(a,"",a,this.a)}catch(k){if("SECURITY_ERR"==k.name)K(this.logger,"SECURITY_ERR for opening "+a),h=null,this.eb=new Oe(k);else throw k;}if(h){var f=h.version||"",m="database "+a+(0==f.length?"":" version "+h.version);null!=b.version&&b.version==
h.version?(L(e.logger,"Existing "+m+" opened as requested."),d(h)):this.P(function(a){(a=xe(b,a,!0,!1))?(0==f?L(e.logger,"New "+m+" created."):b.c?L(e.logger,"Existing "+m+" opened and schema change for "+a):L(e.logger,"Existing "+m+" opened and  schema change to version "+b.version+" for "+a),c(h,b)):(L(e.logger,"Existing "+m+" with same schema opened."),d(h))},null,h)}else d(null,this.eb);return g};l.Ca=function(){return this.b};l.eb=null;l.B=null;l.Tb=function(){return this.B||null};l.logger=I("ydn.db.con.WebSql");
l.ib=function(){};l.Ka=function(){};
function ng(a){var b=a.p,c="CREATE TABLE IF NOT EXISTS "+ae(a)+" (",d=a.e,c=c+(d+" "+b+" PRIMARY KEY ");a.c&&(c+=" AUTOINCREMENT ");if(!a.sa||!a.keyPath&&0==a.a.length)c+=" ,_default_ BLOB";for(var e=[],f=[d],g=0,h=a.a.length;g<h;g++){var k=a.index(g),m="";if(k.multiEntry){var m="ydn.db.me:"+a.getName()+":"+k.getName(),n=k.unique?" UNIQUE ":"",k="CREATE TABLE IF NOT EXISTS "+Ha(m)+" ("+d+" "+b+", "+k.c+" "+k.g+n+")";e.push(k)}else k.unique&&(m=" UNIQUE "),n=k.c,-1==f.indexOf(n)&&(c+=", "+n+" "+k.g+
m,f.push(n))}e.unshift(c+")");return e}l.sb=function(){return this.B?parseFloat(this.B.version):void 0};
l.P=function(a,b,c){function d(a,b){throw b;}function e(b,c){if(c&&c.rows){for(var d=0;d<c.rows.length;d++){var e=c.rows.item(d);if("__WebKitDatabaseInfoTable__"!=e.name&&"sqlite_sequence"!=e.name&&"table"==e.type){var q="sql"in e?e.sql:void 0;M(f.logger,"Parsing table schema from SQL: "+q);for(var r=q.substr(q.indexOf("("),q.lastIndexOf(")")).match(/(?:"[^"]*"|[^,])+/g),z=void 0,C,q=[],D=!1,F=!1,J=0;J<r.length;J++){var S=r[J].match(/\w+|"[^"]+"/g),Ba=Oa(S,function(a){return a.toUpperCase()}),oa=
Ea(S[0]),S=Nd(Ba[1]);if(-1!=Ba.indexOf("PRIMARY")&&-1!=Ba.indexOf("KEY")){C=S;if(x(oa)&&!ta(oa)&&"_ROWID_"!=oa){var kb=oa.split(","),z=oa;1<kb.length&&(z=kb,C=void 0)}-1!=Ba.indexOf("AUTOINCREMENT")&&(D=!0)}else if("_ROWID_"!=oa)if("_default_"==oa)F=!0;else{var fe="UNIQUE"==Ba[2];0==oa.lastIndexOf(e.tbl_name+"-",0)&&(oa=oa.substr(e.tbl_name.length+1));Ba=new Md(oa,S,fe);q.push(Ba)}}if(0==e.name.lastIndexOf("ydn.db.me:",0)){var Bb=e.name.split(":");if(3<=Bb.length){var dc=Bb[1],z=new Md(Bb[2],S,fe,
!0),r=Sa(q,function(a){return a.getName()==Bb[2]});0<=r?q[r]=z:q.push(z);r=Sa(h,function(a){return a.getName()===dc});0<=r?(J=h[r],h[r]=new Wd(J.getName(),J.keyPath,D,C,q,void 0,!F)):h.push(new Wd(dc,void 0,!1,void 0,[z]));M(f.logger,'multi entry index "'+z.getName()+'" found in '+dc+(-1==r?"*":""))}else K(f.logger,'Invalid multiEntry store name "'+e.name+'"')}else J=Sa(h,function(a){return a.getName()===e.name}),0<=J?(r=h[J].index(0),q.push(r),h[J]=new Wd(e.name,z,D,C,q,void 0,!F)):(q=new Wd(e.name,
z,D,C,q,void 0,!F),h.push(q))}}d=new ue(g,h);a(d)}}var f=this,g=(c=c||this.B)&&c.version?parseFloat(c.version):void 0,g=isNaN(g)?void 0:g,h=[];b?b.executeSql("SELECT * FROM sqlite_master",[],e,d):c.readTransaction(function(b){f.P(a,b,c)},function(a){var b=f.logger;b&&Oc(b,"opening tx: "+a.message);throw a;},e)};
function mg(a,b,c,d,e){function f(a){b.executeSql(a,[],function(){g++;g==h.length&&(d(!0),d=null)},function(b,e){g++;g==h.length&&(d(!1),d=null);var f="SQLError creating table: "+c.getName()+" "+e.message+' for executing "'+a;throw new Ne(e,f);})}var g=0,h=ng(c),k="Create";if(e){e=le(c,e);if(0==e.length){M(a.logger,"same table "+c.getName()+" exists.");d(!0);d=null;return}k="Modify";K(a.logger,"table: "+c.getName()+" has changed by "+e+" ALTER TABLE cannot run in WebSql, dropping old table.");h.unshift("DROP TABLE IF EXISTS "+
Ha(c.getName()))}M(a.logger,k+" table: "+c.getName()+": "+h.join(";"));for(a=0;a<h.length;a++)f(h[a])}l.tb=function(){return!!this.B};l.close=function(){this.B=null};
l.Va=function(a,b,c,d){function e(a){M(h.logger,h+": Tx "+c+" request cause error.");d("abort",a)}function f(){d("complete",{type:"complete"})}function g(b){a(b)}var h=this;null===this.B&&(a(null),d("abort",this.eb));c==Xc?this.B.readTransaction(g,e,f):c==Yc?this.B.changeVersion(this.B.version,this.B.version+1+"",g,e,f):this.B.transaction(g,e,f)};
td.push(function(a,b){if(fa(t.openDatabase)&&(!b||"websql"==b)){var c=new lg,d=new ye;N(c.logger,"deleting websql database: "+a);var d=c.Ba(a,d),e=function(){var b=c.logger;b&&b.log(Gc,"all tables in "+a+" deleted.",void 0)};d.R(function(){c.Va(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var k=e.rows.length,m=0,n=0;n<k;n++){var p=e.rows.item(n);"__WebKitDatabaseInfoTable__"!=p.name&&"sqlite_sequence"!=p.name&&(m++,M(c.logger,"deleting table: "+
p.name),b.executeSql("DROP TABLE "+p.name))}N(c.logger,m+' tables deleted from "'+a+'"')}},function(a,b){throw b;})},[],O,e)});d.yb(function(){K(c.logger,"Connecting "+a+" failed.")})}});lg.prototype.kb=function(){};lg.prototype.toString=function(){return"WebSql:"+(this.B?":"+this.B.version:"")};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
rf.prototype.Cb=function(a){return"indexeddb"==a&&(!Zc||fg?0:Zc)?new gg(this.k,this.p):"websql"==a&&fa(t.openDatabase)?new lg(this.k):"sqlite"==a&&t.sqlitePlugin?new lg(this.k,"sqlite"):"localstorage"==a&&window.localStorage?new jg:"sessionstorage"==a&&window.sessionStorage?new kg:"memory"==a?new ig:null};/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
rf.prototype.branch=rf.prototype.lc;rf.prototype.getTxNo=rf.prototype.Kc;af.prototype.getTxNo=af.prototype.Jc;rf.prototype.run=rf.prototype.xc;Z.prototype.branch=Z.prototype.lc;Z.prototype.add=Z.prototype.add;Z.prototype.get=Z.prototype.get;Z.prototype.keys=Z.prototype.keys;Z.prototype.values=Z.prototype.N;Z.prototype.put=Z.prototype.put;Z.prototype.clear=Z.prototype.clear;Z.prototype.remove=Z.prototype.vb;Z.prototype.count=Z.prototype.count;ff.prototype.add=ff.prototype.add;ff.prototype.get=ff.prototype.get;ff.prototype.keys=ff.prototype.keys;ff.prototype.values=ff.prototype.N;ff.prototype.put=ff.prototype.put;ff.prototype.clear=ff.prototype.clear;
ff.prototype.remove=ff.prototype.vb;ff.prototype.count=ff.prototype.count;ma("ydn.db.Key",T);T.prototype.id=T.prototype.Ec;T.prototype.parent=T.prototype.Fc;T.prototype.storeName=T.prototype.Gc;ma("ydn.db.KeyRange",U);U.upperBound=U.upperBound;U.lowerBound=U.lowerBound;U.bound=U.bound;U.only=U.only;U.starts=function(a){var b;if(v(a))b=Xa(a),b.push("\uffff");else if(x(a))b=a+"\uffff";else if(y(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return U.only(a);return U.bound(a,b,!1,!0)};
yd.prototype.store_name=yd.prototype.b;yd.prototype.getStoreName=yd.prototype.c;Cd.prototype.name=Cd.prototype.name;Cd.prototype.getKey=Cd.prototype.d;Cd.prototype.getValue=Cd.prototype.e;Dd.prototype.name=Dd.prototype.name;Dd.prototype.getKeys=Dd.prototype.C;Dd.prototype.getValues=Dd.prototype.u;var og=!lc||lc&&9<=uc,pg=lc&&!sc("9");!nc||sc("528");mc&&sc("1.9b")||lc&&sc("8")||kc&&sc("9.5")||nc&&sc("528");mc&&!sc("8")||lc&&sc("9");function qg(a){qg[" "](a);return a}qg[" "]=ca;function rg(a,b){xd.call(this,a?a.type:"");this.a=this.target=null;this.clientY=this.clientX=0;this.b=this.state=null;if(a){this.type=a.type;this.target=a.target||a.srcElement;this.a=b;var c=a.relatedTarget;if(c&&mc)try{qg(c.nodeName)}catch(d){}this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.state=a.state;this.b=a;a.defaultPrevented&&this.preventDefault()}}B(rg,xd);
rg.prototype.preventDefault=function(){rg.l.preventDefault.call(this);var a=this.b;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,pg)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};var sg="closure_listenable_"+(1E6*Math.random()|0);function tg(a){return!(!a||!a[sg])}var ug=0;function vg(a,b,c,d,e){this.la=a;this.a=null;this.src=b;this.type=c;this.Ra=!!d;this.bb=e;this.key=++ug;this.ya=this.Qa=!1}function wg(a){a.ya=!0;a.la=null;a.a=null;a.src=null;a.bb=null};function xg(a){this.src=a;this.a={};this.b=0}xg.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var g=yg(a,b,d,e);-1<g?(b=a[g],c||(b.Qa=!1)):(b=new vg(b,this.src,f,!!d,e),b.Qa=c,a.push(b));return b};function zg(a,b){var c=b.type;if(!(c in a.a))return!1;var d=Va(a.a[c],b);d&&(wg(b),0==a.a[c].length&&(delete a.a[c],a.b--));return d}function Ag(a,b,c,d,e){a=a.a[b.toString()];b=-1;a&&(b=yg(a,c,d,e));return-1<b?a[b]:null}
function yg(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.ya&&f.la==b&&f.Ra==!!c&&f.bb==d)return e}return-1};var Bg="closure_lm_"+(1E6*Math.random()|0),Cg={},Dg=0;function Eg(a,b,c,d,e){if(v(b)){for(var f=0;f<b.length;f++)Eg(a,b[f],c,d,e);return null}c=Fg(c);return tg(a)?a.Ob(b,c,d,e):Gg(a,b,c,!1,d,e)}function Gg(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e,h=Hg(a);h||(a[Bg]=h=new xg(a));c=h.add(b,c,d,e,f);if(c.a)return c;d=Ig();c.a=d;d.src=a;d.la=c;a.addEventListener?a.addEventListener(b.toString(),d,g):a.attachEvent(Jg(b.toString()),d);Dg++;return c}
function Ig(){var a=Kg,b=og?function(c){return a.call(b.src,b.la,c)}:function(c){c=a.call(b.src,b.la,c);if(!c)return c};return b}function Lg(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)Lg(a,b[f],c,d,e);else c=Fg(c),tg(a)?a.V.add(String(b),c,!0,d,e):Gg(a,b,c,!0,d,e)}function Mg(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)Mg(a,b[f],c,d,e);else c=Fg(c),tg(a)?a.Ma(b,c,d,e):a&&(a=Hg(a))&&(b=Ag(a,b,c,!!d,e))&&Ng(b)}
function Ng(a){if(y(a)||!a||a.ya)return!1;var b=a.src;if(tg(b))return zg(b.V,a);var c=a.type,d=a.a;b.removeEventListener?b.removeEventListener(c,d,a.Ra):b.detachEvent&&b.detachEvent(Jg(c),d);Dg--;(c=Hg(b))?(zg(c,a),0==c.b&&(c.src=null,b[Bg]=null)):wg(a);return!0}function Jg(a){return a in Cg?Cg[a]:Cg[a]="on"+a}function Og(a,b,c,d){var e=1;if(a=Hg(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.Ra==c&&!f.ya&&(e&=!1!==Pg(f,d))}return Boolean(e)}
function Pg(a,b){var c=a.la,d=a.bb||a.src;a.Qa&&Ng(a);return c.call(d,b)}
function Kg(a,b){if(a.ya)return!0;if(!og){var c=b||ba("window.event"),d=new rg(c,this),e=!0;if(!(0>c.keyCode||void 0!=c.returnValue)){a:{var f=!1;if(0==c.keyCode)try{c.keyCode=-1;break a}catch(g){f=!0}if(f||void 0==c.returnValue)c.returnValue=!0}c=[];for(f=d.a;f;f=f.parentNode)c.push(f);for(var f=a.type,h=c.length-1;0<=h;h--)d.a=c[h],e&=Og(c[h],f,!0,d);for(h=0;h<c.length;h++)d.a=c[h],e&=Og(c[h],f,!1,d)}return e}return Pg(a,new rg(b,this))}function Hg(a){a=a[Bg];return a instanceof xg?a:null}
var Qg="__closure_events_fn_"+(1E9*Math.random()>>>0);function Fg(a){if(fa(a))return a;a[Qg]||(a[Qg]=function(b){return a.handleEvent(b)});return a[Qg]};function Rg(){ud.call(this);this.V=new xg(this);this.Ac=this;this.ra=null}B(Rg,ud);Rg.prototype[sg]=!0;l=Rg.prototype;l.addEventListener=function(a,b,c,d){Eg(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){Mg(this,a,b,c,d)};
function Sg(a,b){var c,d=a.ra;if(d)for(c=[];d;d=d.ra)c.push(d);var d=a.Ac,e=b,f=e.type||e;if(x(e))e=new xd(e,d);else if(e instanceof xd)e.target=e.target||d;else{var g=e,e=new xd(f,d);ib(e,g)}var g=!0,h;if(c)for(var k=c.length-1;0<=k;k--)h=e.a=c[k],g=Tg(h,f,!0,e)&&g;h=e.a=d;g=Tg(h,f,!0,e)&&g;g=Tg(h,f,!1,e)&&g;if(c)for(k=0;k<c.length;k++)h=e.a=c[k],g=Tg(h,f,!1,e)&&g}
l.D=function(){Rg.l.D.call(this);if(this.V){var a=this.V,b=0,c;for(c in a.a){for(var d=a.a[c],e=0;e<d.length;e++)++b,wg(d[e]);delete a.a[c];a.b--}}this.ra=null};l.Ob=function(a,b,c,d){return this.V.add(String(a),b,!1,c,d)};l.Ma=function(a,b,c,d){var e;e=this.V;a=String(a).toString();if(a in e.a){var f=e.a[a];b=yg(f,b,c,d);-1<b?(wg(f[b]),La.splice.call(f,b,1),0==f.length&&(delete e.a[a],e.b--),e=!0):e=!1}else e=!1;return e};
function Tg(a,b,c,d){b=a.V.a[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.ya&&g.Ra==c){var h=g.la,k=g.bb||g.src;g.Qa&&zg(a.V,g);e=!1!==h.call(k,d)&&e}}return e&&0!=d.fc};function Ug(a,b,c){if(fa(a))c&&(a=ka(a,c));else if(a&&"function"==typeof a.handleEvent)a=ka(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<b?-1:t.setTimeout(a,b||0)};function Vg(a){ud.call(this);this.b=a;this.a={}}B(Vg,ud);var Wg=[];Vg.prototype.Ob=function(a,b,c,d){v(b)||(b&&(Wg[0]=b.toString()),b=Wg);for(var e=0;e<b.length;e++){var f=Eg(a,b[e],c||this.handleEvent,d||!1,this.b||this);if(!f)break;this.a[f.key]=f}return this};
Vg.prototype.Ma=function(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)this.Ma(a,b[f],c,d,e);else c=c||this.handleEvent,e=e||this.b||this,c=Fg(c),d=!!d,b=tg(a)?Ag(a.V,String(b),c,d,e):a?(a=Hg(a))?Ag(a,b,c,d,e):null:null,b&&(Ng(b),delete this.a[b.key]);return this};Vg.prototype.D=function(){Vg.l.D.call(this);db(this.a,Ng);this.a={}};Vg.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented");};function Xg(){}Xg.prototype.a=null;function Yg(a){var b;(b=a.a)||(b={},Zg(a)&&(b[0]=!0,b[1]=!0),b=a.a=b);return b};var $g;function ah(){}B(ah,Xg);function bh(a){return(a=Zg(a))?new ActiveXObject(a):new XMLHttpRequest}function Zg(a){if(!a.b&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.b=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed");}return a.b}$g=new ah;var ch=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function dh(a){if(eh){eh=!1;var b=t.location;if(b){var c=b.href;if(c&&(c=(c=dh(c)[3]||null)?decodeURI(c):c)&&c!=b.hostname)throw eh=!0,Error();}}return a.match(ch)}var eh=nc;function fh(a){Rg.call(this);this.headers=new cc;this.ca=a||null;this.c=!1;this.H=this.a=null;this.gc=this.p="";this.k=0;this.m="";this.d=this.pa=this.n=this.ea=!1;this.g=0;this.G=null;this.f=gh;this.K=this.rb=!1}B(fh,Rg);var gh="";fh.prototype.b=I("goog.net.XhrIo");var hh=/^https?$/i,ih=["POST","PUT"];l=fh.prototype;l.Zb=function(){return this.f};
l.send=function(a,b,c,d){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.p+"; newUri="+a);b=b?b.toUpperCase():"GET";this.p=a;this.m="";this.k=0;this.gc=b;this.ea=!1;this.c=!0;this.a=this.ca?bh(this.ca):bh($g);this.H=this.ca?Yg(this.ca):Yg($g);this.a.onreadystatechange=ka(this.cc,this);try{L(this.b,jh(this,"Opening Xhr")),this.pa=!0,this.a.open(b,String(a),!0),this.pa=!1}catch(e){L(this.b,jh(this,"Error opening Xhr: "+e.message));kh(this,e);return}a=c||"";var f=
this.headers.clone();d&&Yb(d,function(a,b){ec(f,b,a)});d=Ra(f.C(),lh);c=t.FormData&&a instanceof t.FormData;!Ta(ih,b)||d||c||ec(f,"Content-Type","application/x-www-form-urlencoded;charset=utf-8");f.forEach(function(a,b){this.a.setRequestHeader(b,a)},this);this.f&&(this.a.responseType=this.f);"withCredentials"in this.a&&(this.a.withCredentials=this.rb);try{mh(this),0<this.g&&(this.K=nh(this.a),L(this.b,jh(this,"Will abort after "+this.g+"ms if incomplete, xhr2 "+this.K)),this.K?(this.a.timeout=this.g,
this.a.ontimeout=ka(this.hc,this)):this.G=Ug(this.hc,this.g,this)),L(this.b,jh(this,"Sending request")),this.n=!0,this.a.send(a),this.n=!1}catch(g){L(this.b,jh(this,"Send error: "+g.message)),kh(this,g)}};function nh(a){return lc&&sc(9)&&y(a.timeout)&&u(a.ontimeout)}function lh(a){return"content-type"==a.toLowerCase()}l.hc=function(){"undefined"!=typeof aa&&this.a&&(this.m="Timed out after "+this.g+"ms, aborting",this.k=8,L(this.b,jh(this,this.m)),Sg(this,"timeout"),this.abort(8))};
function kh(a,b){a.c=!1;a.a&&(a.d=!0,a.a.abort(),a.d=!1);a.m=b;a.k=5;oh(a);ph(a)}function oh(a){a.ea||(a.ea=!0,Sg(a,"complete"),Sg(a,"error"))}l.abort=function(a){this.a&&this.c&&(L(this.b,jh(this,"Aborting")),this.c=!1,this.d=!0,this.a.abort(),this.d=!1,this.k=a||7,Sg(this,"complete"),Sg(this,"abort"),ph(this))};l.D=function(){this.a&&(this.c&&(this.c=!1,this.d=!0,this.a.abort(),this.d=!1),ph(this,!0));fh.l.D.call(this)};l.cc=function(){this.e||(this.pa||this.n||this.d?qh(this):this.wc())};
l.wc=function(){qh(this)};function qh(a){if(a.c&&"undefined"!=typeof aa)if(a.H[1]&&4==rh(a)&&2==sh(a))L(a.b,jh(a,"Local request error detected and ignored"));else if(a.n&&4==rh(a))Ug(a.cc,0,a);else if(Sg(a,"readystatechange"),4==rh(a)){L(a.b,jh(a,"Request complete"));a.c=!1;try{th(a)?(Sg(a,"complete"),Sg(a,"success")):(a.k=6,a.m=uh(a)+" ["+sh(a)+"]",oh(a))}finally{ph(a)}}}
function ph(a,b){if(a.a){mh(a);var c=a.a,d=a.H[0]?ca:null;a.a=null;a.H=null;b||Sg(a,"ready");try{c.onreadystatechange=d}catch(e){(c=a.b)&&Oc(c,"Problem encountered resetting onreadystatechange: "+e.message)}}}function mh(a){a.a&&a.K&&(a.a.ontimeout=null);y(a.G)&&(t.clearTimeout(a.G),a.G=null)}
function th(a){var b=sh(a),c;a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:c=!0;break a;default:c=!1}if(!c){if(b=0===b)a=dh(String(a.p))[1]||null,!a&&self.location&&(a=self.location.protocol,a=a.substr(0,a.length-1)),b=!hh.test(a?a.toLowerCase():"");c=b}return c}function rh(a){return a.a?a.a.readyState:0}function sh(a){try{return 2<rh(a)?a.a.status:-1}catch(b){return-1}}
function uh(a){try{return 2<rh(a)?a.a.statusText:""}catch(b){return L(a.b,"Can not get status: "+b.message),""}}function vh(a){try{if(!a.a)return null;if("response"in a.a)return a.a.response;switch(a.f){case gh:case "text":return a.a.responseText;case "arraybuffer":if("mozResponseArrayBuffer"in a.a)return a.a.mozResponseArrayBuffer}var b=a.b;b&&Oc(b,"Response type "+a.f+" is not supported on this browser");return null}catch(c){return L(a.b,"Can not get response: "+c.message),null}}
function jh(a,b){return b+" ["+a.gc+" "+a.p+" "+sh(a)+"]"};function wh(){this.b=[];this.a=[]}function xh(a){0==a.b.length&&(a.b=a.a,a.b.reverse(),a.a=[]);return a.b.pop()}l=wh.prototype;l.r=function(){return this.b.length+this.a.length};l.Z=function(){return 0==this.b.length&&0==this.a.length};l.clear=function(){this.b=[];this.a=[]};l.contains=function(a){return Ta(this.b,a)||Ta(this.a,a)};l.u=function(){for(var a=[],b=this.b.length-1;0<=b;--b)a.push(this.b[b]);for(var c=this.a.length,b=0;b<c;++b)a.push(this.a[b]);return a};function yh(a,b){ud.call(this);this.g=a||0;this.c=b||10;if(this.g>this.c)throw Error(zh);this.a=new wh;this.b=new ic;this.f=null;this.Oa()}B(yh,ud);var zh="[goog.structs.Pool] Min can not be greater than max";l=yh.prototype;l.ab=function(){var a=la();if(!(null!=this.f&&0>a-this.f)){for(var b;0<this.a.r()&&(b=xh(this.a),!this.Pb(b));)this.Oa();!b&&this.r()<this.c&&(b=this.Ib());b&&(this.f=a,this.b.add(b));return b}};l.Fa=function(a){this.b.ka(a);this.Pb(a)&&this.r()<this.c?this.a.a.push(a):Ah(a)};
l.Oa=function(){for(var a=this.a;this.r()<this.g;){var b=this.Ib();a.a.push(b)}for(;this.r()>this.c&&0<this.a.r();)Ah(xh(a))};l.Ib=function(){return{}};function Ah(a){if("function"==typeof a.ga)a.ga();else for(var b in a)a[b]=null}l.Pb=function(a){return"function"==typeof a.nc?a.nc():!0};l.contains=function(a){return this.a.contains(a)||this.b.contains(a)};l.r=function(){return this.a.r()+this.b.r()};l.Z=function(){return this.a.Z()&&this.b.Z()};
l.D=function(){yh.l.D.call(this);if(0<this.b.r())throw Error("[goog.structs.Pool] Objects not released");delete this.b;for(var a=this.a;!a.Z();)Ah(xh(a));delete this.a};function Bh(a,b){this.a=a;this.b=b}Bh.prototype.clone=function(){return new Bh(this.a,this.b)};function Ch(a){this.a=[];if(a)a:{var b,c;if(a instanceof Ch){if(b=a.C(),c=a.u(),0>=a.r()){a=this.a;for(var d=0;d<b.length;d++)a.push(new Bh(b[d],c[d]));break a}}else b=fb(a),c=eb(a);for(d=0;d<b.length;d++)Dh(this,b[d],c[d])}}function Dh(a,b,c){var d=a.a;d.push(new Bh(b,c));b=d.length-1;a=a.a;for(c=a[b];0<b;)if(d=b-1>>1,a[d].a>c.a)a[b]=a[d],b=d;else break;a[b]=c}l=Ch.prototype;l.u=function(){for(var a=this.a,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].b);return b};
l.C=function(){for(var a=this.a,b=[],c=a.length,d=0;d<c;d++)b.push(a[d].a);return b};l.clone=function(){return new Ch(this)};l.r=function(){return this.a.length};l.Z=function(){return 0==this.a.length};l.clear=function(){Ua(this.a)};function Eh(){Ch.call(this)}B(Eh,Ch);function Fh(a,b){this.d=new Eh;yh.call(this,a,b)}B(Fh,yh);l=Fh.prototype;l.ab=function(a,b){if(!a)return Fh.l.ab.call(this);Dh(this.d,u(b)?b:100,a);this.Jb()};l.Jb=function(){for(var a=this.d;0<a.r();){var b=this.ab();if(b){var c;var d=a,e=d.a,f=e.length;c=e[0];if(0>=f)c=void 0;else{if(1==f)Ua(e);else{e[0]=e.pop();for(var e=0,d=d.a,f=d.length,g=d[e];e<f>>1;){var h=2*e+1,k=2*e+2,h=k<f&&d[k].a<d[h].a?k:h;if(d[h].a>g.a)break;d[e]=d[h];e=h}d[e]=g}c=c.b}c.apply(this,[b])}else break}};
l.Fa=function(a){Fh.l.Fa.call(this,a);this.Jb()};l.Oa=function(){Fh.l.Oa.call(this);this.Jb()};l.D=function(){Fh.l.D.call(this);t.clearTimeout(void 0);this.d.clear();this.d=null};function Gh(a,b,c){Fh.call(this,b,c);this.k=a}B(Gh,Fh);Gh.prototype.Ib=function(){var a=new fh,b=this.k;b&&b.forEach(function(b,d){ec(a.headers,d,b)});return a};Gh.prototype.Pb=function(a){return!a.e&&!a.a};function Hh(a,b,c,d,e){Rg.call(this);this.d=u(a)?a:1;this.f=u(e)?Math.max(0,e):0;this.b=new Gh(b,c,d);this.a=new cc;this.c=new Vg(this)}B(Hh,Rg);var Ih="ready complete success error abort timeout".split(" ");l=Hh.prototype;l.send=function(a,b,c,d,e,f,g,h,k,m){if(this.a.get(a))throw Error("[goog.net.XhrManager] ID in use");b=new Jh(b,ka(this.sc,this,a),c,d,e,g,u(h)?h:this.d,k,m);ec(this.a,a,b);a=ka(this.rc,this,a);this.b.ab(a,f);return b};
l.abort=function(a,b){var c=this.a.get(a);if(c){var d=c.Na;c.Ub=!0;b&&(d&&(this.c.Ma(d,Ih,c.Sb),Lg(d,"ready",function(){var a=this.b;a.b.ka(d)&&a.Fa(d)},!1,this)),gc(this.a,a));d&&d.abort()}};l.rc=function(a,b){var c=this.a.get(a);c&&!c.Na?(this.c.Ob(b,Ih,c.Sb),b.g=Math.max(0,this.f),b.f=c.Zb(),c.Na=b,c.Na.rb=c.rb,Sg(this,new Kh("ready",this,a,b)),Lh(this,a,b),c.Ub&&b.abort()):(c=this.b,c.b.ka(b)&&c.Fa(b))};
l.sc=function(a,b){var c=b.target;switch(b.type){case "ready":Lh(this,a,c);break;case "complete":a:{var d=this.a.get(a);if(7==c.k||th(c)||d.Pa>d.Hb)if(Sg(this,new Kh("complete",this,a,c)),d&&(d.Yb=!0,d.Xb)){c=d.Xb.call(c,b);break a}c=null}return c;case "success":Sg(this,new Kh("success",this,a,c));break;case "timeout":case "error":d=this.a.get(a);d.Pa>d.Hb&&Sg(this,new Kh("error",this,a,c));break;case "abort":Sg(this,new Kh("abort",this,a,c))}return null};
function Lh(a,b,c){var d=a.a.get(b);!d||d.Yb||d.Pa>d.Hb?(d&&(a.c.Ma(c,Ih,d.Sb),gc(a.a,b)),a=a.b,a.b.ka(c)&&a.Fa(c)):(d.Pa++,c.send(d.Bc,d.Gb(),d.Za(),d.Ja()))}l.D=function(){Hh.l.D.call(this);this.b.ga();this.b=null;this.c.ga();this.c=null;this.a.clear();this.a=null};function Kh(a,b,c,d){xd.call(this,a,b);this.id=c;this.Na=d}B(Kh,xd);
function Jh(a,b,c,d,e,f,g,h,k){this.rb=!!k;this.Bc=a;this.c=c||"GET";this.a=d;this.b=e||null;this.Hb=u(g)?g:1;this.Pa=0;this.Ub=this.Yb=!1;this.Sb=b;this.Xb=f;this.d=h||gh;this.Na=null}Jh.prototype.Gb=function(){return this.c};Jh.prototype.Za=function(){return this.a};Jh.prototype.Ja=function(){return this.b};Jh.prototype.Zb=function(){return this.d};function Mh(){this.a=la()}var Nh=new Mh;Mh.prototype.get=function(){return this.a};var Oh=jb("area base br col command embed hr img input keygen link meta param source track wbr".split(" "));function Ph(){this.a=Qh}Ph.prototype.ua=!0;Ph.prototype.ia=function(){return""};Ph.prototype.toString=function(){return"Const{}"};function Rh(a){if(a instanceof Ph&&a.constructor===Ph&&a.a===Qh)return"";Ka("expected object of type Const, got '"+a+"'");return"type_error:Const"}var Qh={};function Sh(){this.a="";this.b=Th}Sh.prototype.ua=!0;var Th={};Sh.prototype.ia=function(){return this.a};Sh.prototype.toString=function(){return"SafeStyle{"+this.a+"}"};function Uh(a){var b=new Sh;b.a=a;return b}var Vh=Uh(""),Wh=/^[-.%_!# a-zA-Z0-9]+$/;function Xh(){this.a=Yh}l=Xh.prototype;l.ua=!0;l.ia=function(){return""};l.Lb=!0;l.ta=function(){return 1};l.toString=function(){return"SafeUrl{}"};var Yh={};function Zh(){this.a=$h}l=Zh.prototype;l.ua=!0;l.ia=function(){return""};l.Lb=!0;l.ta=function(){return 1};l.toString=function(){return"TrustedResourceUrl{}"};var $h={};function ai(){this.a="";this.c=bi;this.b=null}l=ai.prototype;l.Lb=!0;l.ta=function(){return this.b};l.ua=!0;l.ia=function(){return this.a};l.toString=function(){return"SafeHtml{"+this.a+"}"};function ci(a){if(a instanceof ai&&a.constructor===ai&&a.c===bi)return a.a;Ka("expected object of type SafeHtml, got '"+a+"'");return"type_error:SafeHtml"}function di(a){if(a instanceof ai)return a;var b=null;a.Lb&&(b=a.ta());return ei(va(a.ua?a.ia():String(a)),b)}
function fi(a){if(a instanceof ai)return a;a=di(a);var b;b=ci(a).replace(/  /g," &#160;").replace(/(\r\n|\r|\n)/g,"<br>");return ei(b,a.ta())}var gi=/^[a-zA-Z0-9-]+$/,hi=jb("action","cite","data","formaction","href","manifest","poster","src"),ii=jb("embed","iframe","link","script","style","template");
function ji(a,b,c){if(!gi.test(a))throw Error("Invalid tag name <"+a+">.");if(a.toLowerCase()in ii)throw Error("Tag name <"+a+"> is not allowed for SafeHtml.");var d=null,e="<"+a;if(b)for(var f in b){if(!gi.test(f))throw Error('Invalid attribute name "'+f+'".');var g=b[f];if(null!=g){var h,k=a;h=f;if(g instanceof Ph)g=Rh(g);else if("style"==h.toLowerCase()){if(!A(g))throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof g+" given: "+g);if(!(g instanceof
Sh)){var k="",m=void 0;for(m in g){if(!/^[-_a-zA-Z0-9]+$/.test(m))throw Error("Name allows only [-_a-zA-Z0-9], got: "+m);var n=g[m];null!=n&&(n instanceof Ph?n=Rh(n):Wh.test(n)||(Ka("String value allows only [-.%_!# a-zA-Z0-9], got: "+n),n="zClosurez"),k+=m+":"+n+";")}g=k?Uh(k):Vh}g instanceof Sh&&g.constructor===Sh&&g.b===Th?g=g.a:(Ka("expected object of type SafeStyle, got '"+g+"'"),g="type_error:SafeStyle")}else{if(/^on/i.test(h))throw Error('Attribute "'+h+'" requires goog.string.Const value, "'+
g+'" given.');if(h.toLowerCase()in hi)if(g instanceof Zh)g instanceof Zh&&g.constructor===Zh&&g.a===$h?g="":(Ka("expected object of type TrustedResourceUrl, got '"+g+"'"),g="type_error:TrustedResourceUrl");else if(g instanceof Xh)g instanceof Xh&&g.constructor===Xh&&g.a===Yh?g="":(Ka("expected object of type SafeUrl, got '"+g+"'"),g="type_error:SafeUrl");else throw Error('Attribute "'+h+'" on tag "'+k+'" requires goog.html.SafeUrl or goog.string.Const value, "'+g+'" given.');}g.ua&&(g=g.ia());h=h+
'="'+va(String(g))+'"';e=e+(" "+h)}}u(c)?v(c)||(c=[c]):c=[];!0===Oh[a.toLowerCase()]?e+=">":(d=ki(c),e+=">"+ci(d)+"</"+a+">",d=d.ta());(a=b&&b.dir)&&(/^(ltr|rtl|auto)$/i.test(a)?d=0:d=null);return ei(e,d)}function ki(a){function b(a){v(a)?Na(a,b):(a=di(a),d+=ci(a),a=a.ta(),0==c?c=a:0!=a&&c!=a&&(c=null))}var c=0,d="";Na(arguments,b);return ei(d,c)}var bi={};function ei(a,b){var c=new ai;c.a=a;c.b=b;return c}var li=ei("",0);function mi(a){this.e=a||"";this.f=Nh}mi.prototype.c=!0;mi.prototype.a=!0;mi.prototype.b=!1;function ni(a){a=new Date(a.f);return oi(a.getFullYear()-2E3)+oi(a.getMonth()+1)+oi(a.getDate())+" "+oi(a.getHours())+":"+oi(a.getMinutes())+":"+oi(a.getSeconds())+"."+oi(Math.floor(a.getMilliseconds()/10))}function oi(a){return 10>a?"0"+a:String(a)}function pi(a,b){var c=(a.f-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d}function qi(a){mi.call(this,a)}B(qi,mi);
qi.prototype.b=!0;qi.prototype.d=function(a){return a?ri(this,a).ia():""};
function ri(a,b){var c;switch(b.e.value){case Dc.value:c="dbg-sh";break;case Ec.value:c="dbg-sev";break;case Fc.value:c="dbg-w";break;case Gc.value:c="dbg-i";break;default:c="dbg-f"}var d=[];d.push(a.e," ");a.a&&d.push("[",ni(b),"] ");d.push("[",pi(b,a.f.get()),"s] ");d.push("[",b.c,"] ");var d=fi(d.join("")),e=li;a.b&&b.b&&(e=ki(ji("br"),fi(b.a||"")));var f=fi(b.d);c=ji("span",{"class":c},ki(f,e));return a.c?ki(d,c,ji("br")):ki(d,c)}function si(a){mi.call(this,a)}B(si,mi);
si.prototype.d=function(a){var b=[];b.push(this.e," ");this.a&&b.push("[",ni(a),"] ");b.push("[",pi(a,this.f.get()),"s] ");b.push("[",a.c,"] ");b.push(a.d);this.b&&a.b&&b.push("\n",a.a);this.c&&b.push("\n");return b.join("")};function ti(){this.e=ka(this.f,this);this.a=new si;this.a.a=!1;this.a.b=!1;this.b=this.a.c=!1;this.c="";this.d={}}ti.prototype.f=function(a){if(!this.d[a.c]){var b=this.a.d(a),c=ui;if(c)switch(a.e){case Dc:vi(c,"info",b);break;case Ec:vi(c,"error",b);break;case Fc:vi(c,"warn",b);break;default:vi(c,"debug",b)}else this.c+=b}};var ui=t.console;function vi(a,b,c){if(a[b])a[b](c);else a.log(c)};var wi=!lc||lc&&9<=uc;!mc&&!lc||lc&&lc&&9<=uc||mc&&sc("1.9.1");lc&&sc("9");function xi(a,b){db(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in yi?a.setAttribute(yi[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var yi={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};
function zi(a,b,c){function d(c){c&&b.appendChild(x(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!w(f)||A(f)&&0<f.nodeType?d(f):Na(Ai(f)?Xa(f):f,d)}}function Ai(a){if(a&&"number"==typeof a.length){if(A(a))return"function"==typeof a.item||"string"==typeof a.item;if(fa(a))return"function"==typeof a.item}return!1}function Bi(a){this.a=a||t.document||document}
function Ci(a,b){var c;c=a.a;var d=b&&"*"!=b?b.toUpperCase():"";c.querySelectorAll&&c.querySelector&&d?c=c.querySelectorAll(d+""):c=c.getElementsByTagName(d||"*");return c}
Bi.prototype.b=function(a,b,c){var d=this.a,e=arguments,f=e[0],g=e[1];if(!wi&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',va(g.name),'"');if(g.type){f.push(' type="',va(g.type),'"');var h={};ib(h,g);delete h.type;g=h}f.push(">");f=f.join("")}f=d.createElement(f);g&&(x(g)?f.className=g:v(g)?f.className=g.join(" "):xi(f,g));2<e.length&&zi(d,f,e);return f};
Bi.prototype.contains=function(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};function Di(a){lc&&u(a.cssText)?a.cssText=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}":a.innerHTML=".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}"}
;function Ei(a){this.e=ka(this.f,this);this.b=new qi;this.c=this.b.a=!1;this.a=a;this.d=this.a.ownerDocument||this.a.document;a=(a=this.a)?new Bi(9==a.nodeType?a:a.ownerDocument||a.document):ra||(ra=new Bi);var b=null,c=a.a;lc&&c.createStyleSheet?(b=c.createStyleSheet(),Di(b)):(c=Ci(a,"head")[0],c||(b=Ci(a,"body")[0],c=a.b("head"),b.parentNode.insertBefore(c,b)),b=a.b("style"),Di(b),c.appendChild(b));this.a.className+=" logdiv"}
Ei.prototype.f=function(a){if(a){var b=100>=this.a.scrollHeight-this.a.scrollTop-this.a.clientHeight,c=this.d.createElement("div");c.className="logmsg";a=ri(this.b,a);c.innerHTML=ci(a);this.a.appendChild(c);b&&(this.a.scrollTop=this.a.scrollHeight)}};Ei.prototype.clear=function(){this.a&&(this.a.innerHTML=ci(li))};var Fi=null,Gi=null;I("ydn.debug");function Hi(a,b){var c;a instanceof Hi?(this.ja=u(b)?b:a.ja,Ii(this,a.za),this.qb=a.qb,this.Ha=a.Ha,Ji(this,a.lb),this.va=a.va,Ki(this,a.a.clone()),this.Xa=a.Xa):a&&(c=dh(String(a)))?(this.ja=!!b,Ii(this,c[1]||"",!0),this.qb=Li(c[2]||""),this.Ha=Li(c[3]||"",!0),Ji(this,c[4]),this.va=Li(c[5]||"",!0),Ki(this,c[6]||"",!0),this.Xa=Li(c[7]||"")):(this.ja=!!b,this.a=new Mi(null,0,this.ja))}l=Hi.prototype;l.za="";l.qb="";l.Ha="";l.lb=null;l.va="";l.Xa="";l.ja=!1;
l.toString=function(){var a=[],b=this.za;b&&a.push(Ni(b,Oi,!0),":");if(b=this.Ha){a.push("//");var c=this.qb;c&&a.push(Ni(c,Oi,!0),"@");a.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.lb;null!=b&&a.push(":",String(b))}if(b=this.va)this.Ha&&"/"!=b.charAt(0)&&a.push("/"),a.push(Ni(b,"/"==b.charAt(0)?Pi:Qi,!0));(b=this.a.toString())&&a.push("?",b);(b=this.Xa)&&a.push("#",Ni(b,Ri));return a.join("")};l.clone=function(){return new Hi(this)};
function Ii(a,b,c){a.za=c?Li(b,!0):b;a.za&&(a.za=a.za.replace(/:$/,""))}function Ji(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.lb=b}else a.lb=null}function Ki(a,b,c){b instanceof Mi?(a.a=b,Si(a.a,a.ja)):(c||(b=Ni(b,Ti)),a.a=new Mi(b,0,a.ja))}function Ui(a,b,c){a=a.a;Vi(a);a.a=null;b=Wi(a,b);Xi(a,b)&&(a.F-=a.q.get(b).length);ec(a.q,b,[c]);a.F++}function Li(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}
function Ni(a,b,c){return x(a)?(a=encodeURI(a).replace(b,Yi),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Yi(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var Oi=/[#\/\?@]/g,Qi=/[\#\?:]/g,Pi=/[\#\?]/g,Ti=/[\#\?@]/g,Ri=/#/g;function Mi(a,b,c){this.a=a||null;this.b=!!c}
function Vi(a){if(!a.q&&(a.q=new cc,a.F=0,a.a))for(var b=a.a.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=null,f=null;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c];e=decodeURIComponent(e.replace(/\+/g," "));e=Wi(a,e);a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}l=Mi.prototype;l.q=null;l.F=null;l.r=function(){Vi(this);return this.F};l.add=function(a,b){Vi(this);this.a=null;a=Wi(this,a);var c=this.q.get(a);c||ec(this.q,a,c=[]);c.push(b);this.F++;return this};
function Zi(a,b){Vi(a);b=Wi(a,b);hc(a.q.b,b)&&(a.a=null,a.F-=a.q.get(b).length,gc(a.q,b))}l.clear=function(){this.q=this.a=null;this.F=0};l.Z=function(){Vi(this);return 0==this.F};function Xi(a,b){Vi(a);b=Wi(a,b);return hc(a.q.b,b)}l.C=function(){Vi(this);for(var a=this.q.u(),b=this.q.C(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};
l.u=function(a){Vi(this);var b=[];if(x(a))Xi(this,a)&&(b=Wa(b,this.q.get(Wi(this,a))));else{a=this.q.u();for(var c=0;c<a.length;c++)b=Wa(b,a[c])}return b};l.get=function(a,b){var c=a?this.u(a):[];return 0<c.length?String(c[0]):b};
l.toString=function(){if(this.a)return this.a;if(!this.q)return"";for(var a=[],b=this.q.C(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.u(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}return this.a=a.join("&")};l.clone=function(){var a=new Mi;a.a=this.a;this.q&&(a.q=this.q.clone(),a.F=this.F);return a};function Wi(a,b){var c=String(b);a.b&&(c=c.toLowerCase());return c}
function Si(a,b){b&&!a.b&&(Vi(a),a.a=null,a.q.forEach(function(a,b){var e=b.toLowerCase();b!=e&&(Zi(this,b),Zi(this,e),0<a.length&&(this.a=null,ec(this.q,Wi(this,e),Xa(a)),this.F+=a.length))},a));a.b=b};I("ydn.http");var $i;function aj(){$i||($i=new Hh);return $i}function bj(a,b,c){x(a)?this.xa=a:(this.xa=null,this.status=a,this.body=b,this.headers=c||{})}function cj(a){if(a.xa){var b=pe(a.xa);b.gapiRequest&&(b=b.gapiRequest.data);a.status=b.status;a.headers=b.headers;a.body=b.body;a.xa=null}}function dj(a){cj(a);return a.status}function ej(a){cj(a);return a.body}bj.prototype.Ja=function(){cj(this);return this.headers};
function fj(a){var b;cj(a);cj(a);"application/json"==a.headers["content-type"]?b=!0:(b=a.body,b=x(b)&&!ta(b)?/^[\],:{}\s]*$/.test(b.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")):!1);return b&&x(a.body)?JSON.parse(a.body):a.body}function gj(a){return a instanceof bj?a:x(a)?new bj(a):new bj(a.status,a.body,a.headers)}
function hj(a,b,c,d){this.path=a;this.method=b?b.toUpperCase():"GET";this.params=c||{};this.headers=d||{};this.body=void 0};function ij(a,b){this.b=a;this.data=b;this.a=!1}ij.prototype.data=null;ij.prototype.preventDefault=function(){this.a=!0};function jj(a,b,c,d){xd.call(this,a,b);this.status=c;this.d=d}B(jj,xd);jj.prototype.status=NaN;jj.prototype.e=function(){return this.status};jj.prototype.T=function(){return this.d.T()};function kj(a,b,c){jj.call(this,"conflict",a,b,c.b);this.b=c}B(kj,jj);kj.prototype.c=function(){return this.b.data};function lj(a,b){this.a=a;if(b)throw new Tb("optional key paths");}var mj={Oc:"key",Lc:"date",Pc:"modified",Nc:"expires",Mc:"etag",Qc:"updated",Rc:"uri",NEXT:"next"};function nj(a,b,c){return c&&a.a[b]?$c(c,a.a[b]):void 0}function oj(a,b,c,d){a.a[b]&&ad(c,a.a[b],d)};function pj(a,b,c,d){this.key=a;this.b=(this.b=d?b[d]:b)||{};this.a=c}function qj(a){return null!=a.key?a.key:nj(a.a,"key",a.b)}function rj(a){return nj(a.a,"updated",a.b)}function sj(a){return nj(a.a,"etag",a.b)}function tj(a){var b={},c=sj(a);c&&1<c.length?b["if-none-match"]=c:(a=rj(a))&&(b["if-modified-since"]=a);return b}
pj.prototype.toJSON=function(){var a={};oj(this.a,"key",a,qj(this));var b=nj(this.a,"date",this.b);b&&oj(this.a,"date",a,b);(b=nj(this.a,"expires",this.b))&&oj(this.a,"expires",a,b);(b=rj(this))&&oj(this.a,"updated",a,b);(b=sj(this))&&oj(this.a,"etag",a,b);return a};function uj(a,b,c){b.expires&&oj(c,"expires",b,(new Date(b.expires)).getTime());b["last-updated"]&&oj(c,"updated",b,(new Date(b["last-updated"])).getTime());b.etag&&oj(c,"etag",b,(new Date(b.etag)).getTime());oj(c,"date",b,NaN);pj.call(this,a,b,c)}B(uj,pj);function vj(a,b,c){this.a=a;this.f=c||null;this.c=this.b=null;this.key=b}l=vj.prototype;l.logger=I("ydn.db.sync.entry.Rest");l.T=function(){if(this.c&&this.a.m&&this.d){var a=this.a.n;this.a.K||delete this.c[a]}return this.c||null};l.wb=function(){return this.a.Kb(this.key)};l.Fb=function(a,b){if(a)return a;cj(b);if(200<=b.status&&400>b.status)return fj(b);try{return fj(b)}catch(c){var d=ej(b);return A(d)?d:{body:d}}};
l.save=function(a){var b=this.key;if(a&&!this.a.m)return la(),wj(this.a,[this.d.toJSON()]);var c=this.c;if(a&&!c)return Sb();a=void 0;null!=this.d&&(la(),a=[this.d.toJSON()]);return xj(this.a,[c],a,[b])};
l.qa=function(a,b){if(this.a.v&&A(this.b))a.call(b,304),a=null;else{var c=this;yj(this,function(d){if(d){var e=nj(d.a,"expires",d.b);if(e&&e>la()){M(this.logger,this+" not expired");a.call(b,304);a=null;return}}d=c.ma(c.wb(),"GET",d);this.a.s().request(d).execute(function(d,e){var h;h=new uj(c.key,e.Ja(),c.a.g);c.d=h;c.c=c.Fb(d,e);a.call(b,dj(e));a=null})},this)}};
l.ma=function(a,b,c,d){a=new hj(a,b);if(c){var e;"POST"==a.method||"PUT"==a.method||"DELETE"==a.method?(e={},(b=rj(c))&&(e["if-unmodified-since"]=b),(c=sj(c))&&1<c.length&&(e["if-match"]=c),c=e):c=tj(c);e=c;a.headers?ib(a.headers,e):a.headers=e}a.body=A(d)?JSON.stringify(d):d;M(this.logger,this+" "+a.method+" "+a.path+" "+qe(e));return a};
function zj(a,b,c){yj(a,function(a){a=this.ma(this.wb(),"PUT",a,this.f);this.a.s().request(a).execute(function(a,d){this.d=new uj(this.key,d.Ja(),this.a.g);this.c=a;b&&(b.call(c,dj(d)),b=null)},this)},a)}function yj(a,b,c){a.e?b.call(c,a.e):Aj(a.a,a.key,function(d){a.e=d;b.call(c,d)})}
l.load=function(a,b){this.b&&this.e?a&&(a.call(b,this.b,this.e),a=void 0):this.a.load(this.key,function(c,d){this.b=c;var e=this.a.n;this.b&&e&&this.b[e]&&(this.e=new pj(this.key,this.b,this.a.g,e),this.a.K||delete this.b[e]);this.b=c;this.e=d;a&&(a.call(b,c),a=void 0)},this)};function Bj(a,b){var c=a.wb(),d=a.a.s();yj(a,function(a){a=this.ma(c,"DELETE",a);d.request(a).execute(function(a,d){M(this.logger,"deleted "+c+" "+dj(d));b.call(this,dj(d))},this)},a)}
l.toString=function(){return"sync.entry{"+this.a.a+":"+this.key+"}"};function Cj(a,b,c){this.storage=a;this.d=b;this.a=b.getName();a="format readRequestTimeout writeRequestTimeout transport Options fetchStrategies baseUri immutable keepMeta metaStoreName metaDataName prefetch prefetchRefractoryPeriod".split(" ");for(var d in c)if(-1==Ma(a,d))throw new H('Unknown Sync attribute "'+d+'"  in Sync.');this.v=!!c.immutable;this.c=c.baseUri;this.aa=c.metaStoreName||this.a;this.n=c.metaDataName;this.m=this.aa==this.a;a=c.Options||{};if(!this.aa)throw new H("metadata store name required.");
b=this.Y();for(d in a)if(-1==Ma(b,d))throw new H('Unknown Sync.Options attribute "'+d+'" in Sync.Options');this.pa=a.delimiter||"";this.f=a.prefix||"";this.K=!!c.keepMeta;this.G=c.prefetch||y(c.prefetchRefractoryPeriod)?"full":null;this.ca=y(c.prefetchRefractoryPeriod)?c.prefetchRefractoryPeriod:5E3;this.b=Dj(c.transport);this.g=new lj(this.X(),c.metaData);this.k=null;this.p=NaN}l=Cj.prototype;l.X=function(){var a={},b;for(b in mj)a[b]=b;return a};l.Y=function(){return[]};l.logger=I("ydn.db.sync.Rest");
l.W=function(){return this.c};l.s=function(){this.b||(this.b=new Ej);return this.b};l.toString=function(){return"sync:"+this.a};function wj(a,b){return hf(a.storage.a,a.aa,b).yb(function(a){throw a;})}function Fj(a,b,c){a.d.keyPath&&null==ie(a.d,b)&&null!=c&&ad(b,a.d.keyPath,c)}
function xj(a,b,c,d){d=a.d.keyPath?void 0:d;if(c){if(a.m){for(g=0;g<b.length;g++)null!=c[g]&&ib(b[g],c[g]);return hf(a.storage.a,a.a,b,d)}if(b){for(var e=[],f=b.concat(c),g=0;g<b.length;g++){var h=a.d.keyPath?NaN:d[g];e.push(new T(a.a,h))}for(g=0;g<c.length;g++)e.push(new T(a.aa,NaN));return hf(a.storage.a,e,f)}return hf(a.storage.a,a.aa,c)}for(g=0;g<b.length;g++)h=d?d[g]:void 0,Fj(a,b[g],h);return hf(a.storage.a,a.a,b,d)}
function Gj(a,b){var c=[new T(a.a,b)];a.m||c.push(new T(a.aa,b));return jf(a.storage.a,c)}l.Kb=function(a){return this.W()+a};l.add=function(a,b,c){null!=c?Fj(this,b,c):this.d.keyPath&&(c=ie(this.d,b));var d=this.t(c,b),e=this;zj(d,function(a){201==a||200==a?(M(e.logger,d+" created"),d.save(!0)):K(e.logger,"Unexpected respond "+a+" for add "+d)})};
function Aj(a,b,c){var d=new T(a.aa,b);G(Hj(a,[d]),function(a){c.call(void 0,new pj(b,a[0],this.g,this.n))},function(a){K(this.logger,this+" error loading meta data "+a);c.call(void 0,null)},a)}l.gb=function(a,b){var c=a.map(function(a){return new T(this.aa,a)});G(Hj(this,c),function(c){for(var e=[],f=0;f<a.length;f++)e[f]=new pj(a[f],c[f],this.g,this.n);b(e)},function(a){K(this.logger,this+" error loading meta data "+a);b([])},this)};
l.load=function(a,b,c){var d=this.aa,e=[new T(this.a,a)];this.m||e.push(new T(d,a));G(Hj(this,e),function(d){var e=d[0];b.call(c,e,new pj(a,this.m?e:d[1],this.g,this.n))},function(a){K(this.logger,this+" error loading meta data "+a);b.call(c,null,null)},this)};function Hj(a,b){return lf(a.storage.a,b)}
l.get=function(a,b){this.p||this.ha();qd(a,function(c,d,e){if(d)e(c,d);else{Vc(a,c);var f=u(c);if(f&&this.v)e(c);else{var g=this.t(b,c);g.qa(function(a){if(304==a){if(e(c),!f)throw new Wb(g+" not modified, but not exist in server");}else if(200==a)g.save().Q(function(){e(g.T())});else if(404==a)Gj(g.a,g.key).Q(function(){e(g.T())});else throw e(g.T()),new Vb("Invalid HTTP respond "+a+" for GET "+b);},this)}}},this)};
function Ij(a,b,c,d,e,f){var g=[],h=a.logger;N(a.logger,d.length+", "+e.length+", "+f.length+", "+g.length+" records to fetch, update, delete, save");var k=d.length+e.length+f.length+g.length;if(0==k)b(c);else{for(var m=!1,n=function(){k--;0==k&&(b(c,m),b=null)},g=0;g<d.length;g++){var p=a.t(d[g]);p.index=g;p.qa(function(a){200==a?(h.log(Kc,"A new "+this+" received from server",void 0),G(this.save(),function(){c[this.index]=this.T();n()},function(){m=!0;n()},this)):304==a?G(this.save(!0),function(){h.log(Kc,
this+" expires date updated",void 0);n()},function(){m=!0;n()},this):(h.log(Fc,"Invalid status "+a+" for fetching "+this,void 0),n())},p)}for(g=0;g<e.length;g++)p=a.t(e[g]),p.index=g,p.load(function(){this.qa(function(a){200==a?(h.log(Kc,this+" updated from server",void 0),G(this.save(),function(){c[this.index]=this.T();n()},function(){m=!0;n()},this)):(h.log(Fc,"Invalid status "+a+" for fetching "+this,void 0),n())})});for(g=0;g<f.length;g++)p=a.t(f[g]),p.index=g,G(Gj(p.a,p.key),function(){c[this.index]=
new ij(p,null);n()},function(){m=!0;n()},p)}}function Jj(a,b,c){qd(b,function(a,e,f){if(e)f(a,e);else if(Qa(a,function(a){return u(a)})&&this.v)f(a);else{Vc(b,a);var g=a.length;for(e=0;e<c.length;e++)if(this.v&&u(a[e]))g--,0==g&&f(a);else{var h=this.t(c[e],a[e]);h.index=e;h.qa(function(b){200==b?(a[this.index]=this.T(),this.save()):404==b&&(a[this.index]=void 0);g--;0==g&&f(a)},h)}}},a)}l.t=function(a,b){return new vj(this,a,b)};l.count=function(a){return a};l.Nb=function(){throw new Tb;};
l.N=function(a,b,c){Kj(this)?(M(this.logger,"prefetch queued"),qd(a,function(d,e,f){Vc(a,d);e?f(d,e):Lj(this,function(a){a?G(kf(this.storage.a,this.a,null,null,!1,b,c),function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(){K(this.logger,this+" prefetch fail");f(d)},this)},this)):this.Nb(a,b,c)};
l.keys=function(a,b,c,d,e,f,g){qd(a,function(h,k,m){Vc(a,h);k?m(h,k):Lj(this,function(a){a?G(mf(this.storage.a,this.a,b,c,d,e,f,g),function(a){m(a)},function(a){m(a,!0)},this):m(h)},function(){K(this.logger,this+" prefetch fail");m(h)},this)},this)};l.Eb=function(){};
l.put=function(a,b,c){c=u(c)?c:this.d.keyPath?ie(this.d,b):null;var d=this.t(c,b);Q(a,function(){d.load()},this);qd(a,function(c,f,g){Vc(a,c);zj(d,function(c){409==c?d.qa(function(){var c=new ij(d,b);Vc(a,c);c.a?g(null,f):g(void 0,f)}):200==c||201==c?(d.save(!0),g(b,f)):(K(this.logger,"Unexpected response for PUT: "+c),g(null,f))},this)},this)};
function Mj(a,b,c){var d=a.t(c);d.load(function(){qd(b,function(e,f,g){Bj(d,function(f){if(409==f){f=new ij(d,null);Vc(b,f);var k=new kj(a.storage,409,f);a.storage.J(k)}else 200==f?M(a.logger,"Successfully deleted object "+c):(K(a.logger,"Unexpected response for DELETE: "+f+" "+c),Vc(b,k));g(e)})})})}
l.ha=function(){M(this.logger,this+" starting prefetch");var a=new E;G(kf(this.storage.a,this.a,"updated.$t",null,!0,1),function(b){var c={};if(b=b[0])b=gb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b;var d=this,c=new hj(this.W(),"GET",c);d.s().request(c).execute(function(b,c){if(200==dj(c)){if(!b){var g=ej(c);x(g)&&(b=JSON.parse(g))}g=(g=(b.feed||b).entry)?v(g)?g:[g]:[];0<g.length?xj(d,g).Q(function(){a.j(!0)}):a.j(!1)}else 302==dj(c)?a.j():(g=d+": Invalid response status "+
dj(c)+" on prefetching",K(d.logger,g),a.h(Error(g)))})},function(b){a.h(b)},this);return a};function Kj(a){return a.G?a.p?la()-a.p>a.ca:!0:!1}function Lj(a,b,c,d){Kj(a)?a.k?G(a.k,b,c,d):(a.k=a.ha(),a.p=la(),G(a.k,b,c,d),G(a.k,function(a){M(this.logger,"prefetch "+(a?"updated":"no update"));this.k=null},function(a){this.k=null;throw a;},a)):b.call(d,!1)};function Nj(a,b,c){Cj.call(this,a,b,c)}B(Nj,Cj);Nj.prototype.logger=I("ydn.db.sync.Atom");Nj.prototype.Y=function(){return Nj.l.Y.call(this)};function Pj(a){this.data=a}Pj.prototype.Za=function(){return this.data.content||null};function Qj(a,b,c){vj.call(this,a,b,c)}B(Qj,vj);Qj.prototype.logger=I("ydn.db.sync.entry.S3");Qj.prototype.getName=function(){return this.a.f+this.key};Qj.prototype.ma=function(a,b,c,d){b=Qj.l.ma.call(this,a,b,c,d);if("PUT"==b.method||"POST"==b.method){c=(new Hi(a)).va.substr(1);if(1>c.length)throw new Vb("invalid url "+a);b.headers.Key=c;a=b.headers["Content-Type"]||"application/json";d instanceof File?a=d.type:x(d)&&(a=/<*DOCTYPE html/i.test(d)?"text/html":"text/plain");b.headers.ContentType=a}return b};function Rj(a){this.data=a}B(Rj,Pj);I("ydn.gdata.base");function Sj(a,b){if(b&&!a)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(b||"",a||"",null);if("undefined"!=typeof ActiveXObject){var c=Tj();if(c)return a&&c.appendChild(c.createNode(1,a,b||"")),c}throw Error("Your browser does not support creating new documents");}
function Uj(a){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(a,"application/xml");if("undefined"!=typeof ActiveXObject){var b=Tj();b.loadXML(a);return b}throw Error("Your browser does not support loading xml documents");}function Vj(a){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(a);if(a=a.xml)return a;throw Error("Your browser does not support serializing XML documents");}
function Tj(){var a=new ActiveXObject("MSXML2.DOMDocument");if(a){a.resolveExternals=!1;a.validateOnParse=!1;try{a.setProperty("ProhibitDTD",!0),a.setProperty("MaxXMLSize",2048),a.setProperty("MaxElementDepth",256)}catch(b){}}return a};I("ydn");var Wj={atom:"http://www.w3.org/2005/Atom",ydn:"http://www.yathit.com/2012/ydn",app:"http://www.w3.org/2007/app",openSearch:"http://a9.com/-/spec/opensearch/1.1/",gAcl:"http://schemas.google.com/acl/2007",sites:"http://schemas.google.com/sites/2008",gs:"http://schemas.google.com/spreadsheets/2006",dc:"http://purl.org/dc/terms",batch:"http://schemas.google.com/gdata/batch",gd:"http://schemas.google.com/g/2005",gContact:"http://schemas.google.com/contact/2008",thr:"http://purl.org/syndication/thread/1.0",
xhtml:"http://www.w3.org/1999/xhtml"};I("ydn.xml");function Xj(a,b,c){if(u(b))Yj(this,b),u(c)||(c=a[b]);else for(var d in a)if(a.hasOwnProperty(d)&&A(a[d])&&x(a[d].xmlns)){this.xb=[d].xmlns;Yj(this,d);c=a[d];break}this.data=c;this.parent=a}l=Xj.prototype;l.xb="http://www.w3.org/2005/Atom";function Yj(a,b){var c=b.split(":");1<c.length&&(a.xb=Wj[c[0]]||Wj.xhtml||Xj.prototype.xb,b=c[1]);a.a=b}l.toString=function(){return"JsonElement:"+this.a};l.getName=function(){return this.a};l.setAttribute=function(a,b){a=a.replace(/:/,"$");this.data[a]=b};
l.removeAttribute=function(a){a=a.replace(/:/,"$");delete this.data[a]};l.removeChild=function(a){if(a.parent!=this.data)throw Error("NOT_FOUND_ERR: JSON:DOM Exception 8: "+a+" not in "+this);var b=a.getName();v(this.data[b])?Va(this.data[b],a.data):delete this.data[b]};l.toJSON=function(){return{data:this.data,tagName:this.a}};
function Zj(a){function b(a,g){d(g,a);var h,k;for(k in a)if(a.hasOwnProperty(k)&&!x(a[k]))if(x(a[k].$t)&&"xhtml"==a[k].type){h=c(k);d(h,a[k]);var m=Uj(a[k].$t);e.importNode(m.documentElement,!0);h.appendChild(m.documentElement);g.appendChild(h)}else if(x(a[k].$t))h=c(k),h.textContent=a[k].$t,d(h,a[k]),g.appendChild(h);else if(v(a[k])&&a[k][0]&&x(a[k][0].$t))for(m=0;m<a[k].length;m++)h=c(k),h.textContent=a[k][m].$t,d(h,a[k][m]),g.appendChild(h);else if(v(a[k]))for(m=0;m<a[k].length;m++)h=c(k),g.appendChild(h),
b(a[k][m],h);else A(a[k])&&(h=c(k),g.appendChild(h),b(a[k],h))}function c(a){return e.createElement(a.replace("$",":"))}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&"$t"!=c&&x(b[c])&&a.setAttribute(c.replace("$",":"),b[c])}var e=Sj(a.getName(),a.xb);b(a.data,e.documentElement);return Vj(e.documentElement)}
l.clone=function(a){var b={};if(u(a))for(var c in this.data){var d=c.replace("$",":");x(this.data[c])?b[c]=this.data[c]:1==a[d]&&(b[c]=pe(V(this.data[c])))}else b=pe(V(this.data));return new Xj(null,this.a,b)};function ak(a){var b;if(u(a.id))b=a.id.$t;else if(u(a.batch$id))b=a.batch$id.$t;else if(u(a.a))b=a.a.$t;else throw new Ae("id or batch:id required.");this.id=b;this.data=a}B(ak,Rj);ak.prototype.logger=I("ydn.gdata.Entry");ak.prototype.Za=Pj.prototype.Za;function bk(a,b,c){vj.call(this,a,b,c)}B(bk,vj);bk.prototype.wb=function(){return this.key};
bk.prototype.ma=function(a,b,c,d){a=bk.l.ma.call(this,a,b,c,d);this.a.ic(a.method)&&t.gapi&&t.gapi.auth&&(b=gapi.auth.getToken())&&b.access_token&&(a.headers.Authorization=b.token_type+" "+b.access_token);if("GET"==a.method)a.params.alt="json";else if("PUT"==a.method||"POST"==a.method){var e=new ak(d);b=new Xj(null,"entry",e.data);c=!1;b.xmlns||(b.xmlns="http://www.w3.org/2005/Atom",c=!0);d=["atom"];for(var f in e.data)if(e=f.match(/^(\w+)\$\w+/))e=e[1],e in Wj&&(Ta(d,e)||d.push(e));f=Zj(b);c&&delete b.xmlns;
b=f.indexOf(" ");for(c=0;c<d.length;c++)e=d[c],e=(0==c?"xmlns":"xmlns:"+e)+'="'+Wj[e]+'"',-1==f.indexOf(e)&&(f=f.substring(0,b+1)+e+" "+f.substr(b+1));a.body=f;a.headers["Content-Type"]="application/atom+xml"}return a};bk.prototype.Fb=function(a,b){a=bk.l.Fb.call(this,a,b);a.feed&&(a=a.feed);a.entry&&(a=a.entry);return a};function ck(a,b,c){Cj.call(this,a,b,c);a=c.Options;this.e=a.kind;this.version=a.version;this.H=a.maxResults}B(ck,Nj);l=ck.prototype;l.version=null;l.logger=I("ydn.db.sync.GData");l.t=function(a,b){return new bk(this,a,b)};l.X=function(){var a=ck.l.X.call(this);a.key=["id","$t"];a.etag="gd$etag";a.updated=["updated","$t"];return a};l.Y=function(){var a=ck.l.Y.call(this);return a=a.concat(["version","projection","kind","maxResults"])};l.W=function(){return"https://www.googleapis.com/"+this.e+"/"};
l.ic=function(){return!1};
function dk(a,b,c){var d=c||a.W();c&&M(a.logger,"continuing "+c);b=new hj(d,"GET",b);var e=new E;a.s().request(b).execute(function(b,d){if(200==dj(d)){if(!b){var h=ej(d);x(h)&&(b=JSON.parse(h))}var h=b.feed||b,k=h.entry,k=k?v(k)?k:[k]:[];0<k.length&&xj(a,k);for(var k=null,h=h.link,h=v(h)?h:[h],m=0;m<h.length;m++)"next"==h[m].rel&&(k=h[m].href);k?(h=dk(a,{},k),G(h,e.j,e.h,e)):(M(a.logger,"prefetch "+a.a+" done"),e.j(!!c))}else 302==dj(d)?e.j():(h=a+": Invalid response status "+dj(d)+" on prefetching",
K(a.logger,h),e.h(Error(h)))});return e}l.ha=function(){M(this.logger,"starting prefetch");var a=new E;kf(this.storage.a,this.a,"updated.$t",null,!0,1).R(function(b){var c={alt:"json",kind:this.e};this.H&&(c["max-results"]=this.H);(b=b[0])?(b=gb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),c["updated-min"]=b,M(this.logger,this.a+" fetching entries later then "+b)):M(this.logger,this.a+" fetching entries from beginning");c=dk(this,c);G(c,a.j,a.h,a)},this);return a};
l.count=function(a){var b=de(this.d);if(!b)return a;var c=nd(a);G(a,function(a){Vc(c,a);G(kf(this.storage.a,this.a,b.getName(),null,!1,1),function(b){var f={alt:"json"};if(b=v(b)?b[0]:b)b=gb(b,"updated","$t"),b=(new Date(1+ +new Date(b))).toISOString(),f["updated-min"]=b;var g=this,f=new hj(this.W(),"GET",f);this.s().request(f).execute(function(b,e){if(200==dj(e)){if(!b){var f=ej(e);x(f)&&(b=JSON.parse(f))}f=gb(b.feed,"openSearch$totalResults");c.j(a+parseFloat(f||0))}else K(g.logger,g+":Unexpected respond status "+
dj(e))})},function(a){c.h(a)},this)},function(a){c.h(a)},this);return c};function ek(a,b,c){vj.call(this,a,b,c)}B(ek,bk);function fk(a,b,c){ck.call(this,a,b,c);this.c=this.c.substr(27);this.da=c.Options.prefix}B(fk,ck);fk.prototype.s=function(){this.b||(this.b=new gk(gapi.client));return this.b};fk.prototype.t=function(a,b){return new ek(this,a,b)};fk.prototype.W=function(){return this.c+this.da};
fk.prototype.ha=function(){M(this.logger,"starting prefetch");var a=new E;G(kf(this.storage.a,this.a,"updated",null,!0,1),function(b){var c={alt:"json"};if(b=b[0])b=gb(b,"updated"),b=(new Date(1+ +new Date(b))).toISOString(),c.updatedMin=b;var d=this,c=new hj(this.W(),"GET",c);d.s().request(c).execute(function(b,c){if(b){var g=b.items||[];0<g.length?xj(d,g).Q(function(){a.j(!0)}):a.j(!1)}else 302==dj(c)?a.j():(g=d+": Invalid response status "+dj(c)+" on prefetching",K(d.logger,g),a.h(Error(g)))})},
function(b){a.h(b)},this);return a};function hk(a,b){if(!u(t.AWS))throw new Vb("AWS JS SDK not loaded");this.b=a;this.region=b;this.a=null}hk.prototype.request=function(a){return new ik(this,a)};function jk(a){var b={params:{Bucket:a.b,region:a.region}};if(!a.b)throw new H("bucket name required");a.a||(a.a=new AWS.S3(b));return a.a}function ik(a,b){this.parent=a;this.a=b}
function kk(a,b,c,d,e){var f=NaN,g={};a=jk(a.parent)[b](c);a.on("complete",function(a){a.httpResponse&&(f=a.httpResponse.statusCode,x(f)&&(f=parseInt(f,10)),g=a.httpResponse.headers);a.error&&(f||(f=400))});a.send(function(a,b){var c=new bj(f,b,g);a?d.call(e,null,c):d.call(e,b,c)})}
ik.prototype.execute=function(a,b){var c;c=(new Hi(this.a.path)).va;c="/"==c.charAt(0)?c.substr(1):c;var d=this.a.headers||{};c&&(d.Key=c);if(c)if("GET"==this.a.method)kk(this,"getObject",d,a,b);else if("PUT"==this.a.method)kk(this,"putObject",d,a,b);else throw new Tb("HTTP method "+this.a.method);};function lk(a,b){this.a=a;this.c=mk(this,"Prefix")[0];this.b=b.type}lk.prototype.r=function(){return this.a.documentElement.getElementsByTagName("Contents").length};lk.prototype.keys=function(){var a=mk(this,"Key");if(this.c){var b=this.c.length,a=a.map(function(a){return a.substr(b)});"INTEGER"==this.b?a=a.map(function(a){return parseInt(a,10)}):"NUMERIC"==this.b&&(a=a.map(function(a){return parseFloat(a)}))}return a};
function mk(a,b){for(var c=[],d=a.a.documentElement.getElementsByTagName(b),e=d.length,f=0;f<e;f++)c[f]=d[f].textContent;return c}function nk(a){return mk(a,"LastModified").map(function(a){return(new Date(Date.parse(a))).toGMTString()})}
function ok(a){var b=a.a.documentElement.getElementsByTagName("NextMarker");return 1==b.length?b[0].textContent:"true"==a.a.documentElement.getElementsByTagName("IsTruncated")[0].textContent&&(a=a.a.documentElement.firstElementChild.lastElementChild)&&"Contents"==a.tagName?a.getElementsByTagName("Key")[0]:null};function pk(a,b,c){Cj.call(this,a,b,c);this.e=c.Options.bucket;if(!x(this.e)||ta(this.e))throw new H("bucket name required.");this.c||(this.c="https://"+this.e+".s3.amazonaws.com/");if(!0===b.c)throw new H('S3 object store "'+b.getName()+'" must not set autoIncrement to true.');}B(pk,Cj);l=pk.prototype;l.logger=I("ydn.db.sync.S3");l.Y=function(){var a=pk.l.Y.call(this);return a=a.concat(["bucket","maxKeys","prefix","delimiter"])};l.s=function(){this.b||(this.b=new hk(this.e));return this.b};
l.Kb=function(a){return this.c+this.f+a};l.t=function(a,b){return new Qj(this,a,b)};
l.Nb=function(a,b){var c=this;qd(a,function(d,e,f){Vc(a,d);c.gb(d,function(a){var e={},k=a[0]?qj(a[0]):null;null!=k&&(e.marker=k);0<c.f.length&&(e.prefix=c.f);0<b&&(e["max-keys"]=b);M(c.logger,c+" querying for newer entries starting from "+k);e=new hj(c.c,"GET",e);c.s().request(e).execute(function(b,e){if(200==dj(e)){for(var h=ej(e),h=h instanceof Document?h:Uj(h),k=new lk(h,c.d),h=k.keys(),k=nk(k),r=[],z=[],C=[],D=0,F=0;D<=a.length&&F<h.length;){var J=a[D]?qj(a[D]):null,S=h[F];if(D==a.length)z.push(S),
F++;else{var Ba=J?sd(J,S):-1;0==Ba?((S=rj(a[D]))&&k[F]&&S!=k[F]&&(k[F]>S?C.push(J):K(c.logger,'record "'+J+'" in database is more recent than server '+S+" vs "+k[F])),D++,F++):1==Ba?(r.push(J),D++):(z.push(S),F++)}}Ij(c,f,d,z,C,r)}else K(c.logger,"Invalid response status "+dj(e))})})},this)};
function qk(a,b){function c(f){null!=f&&(d.marker=f);M(a.logger,a+" querying for newer entries starting from "+f);e.request(new hj(a.c,"GET",d)).execute(function(d,e){if(200==dj(e)){var f=ej(e),f=f instanceof Document?f:Uj(f),f=new lk(f,a.d),m=ok(f),f=f.keys(),n=f.length;if(0==n)b([]),b=null;else for(var p=0,q=0;q<n;q++)a.t(f[q]).qa(function(){p++;p==n&&(m?c(m):b&&(b([this.T()]),b=null))})}else K(a.logger,"Invalid response status "+dj(e))})}var d={};0<a.f.length&&(d.prefix=a.f);var e=a.s();c();a.H=
!0}function rk(a,b){a.H||qd(b,function(a,b,e){u(a[0])?e(a):qk(this,e)},a)};function sk(a,b,c){vj.call(this,a,b,c)}B(sk,Qj);sk.prototype.logger=I("ydn.db.sync.entry.Gcs");function tk(a,b,c){pk.call(this,a,b,c);this.c="https://"+this.e+".storage.googleapis.com/"}B(tk,pk);tk.prototype.logger=I("ydn.db.sync.Gcs");tk.prototype.s=function(){this.b||(this.b=new Ej);return this.b};tk.prototype.t=function(a,b){return new sk(this,a,b)};function uk(a,b,c,d){this.b=u(b)?b:aj();this.a="sr"+vk++;this.e=c||0;this.d=!!d;this.c=a}var vk=0;
uk.prototype.execute=function(a,b){var c=this.c,d=new Hi(c.path),e;for(e in c.params)Ui(d,e,c.params[e]);this.b.send(this.a,d.toString(),c.method,c.body,c.headers,void 0,function(c){c=c.target;for(var d=(c.a&&4==rh(c)?c.a.getAllResponseHeaders():"").split("\n"),e={},k=0;k<d.length;k++){var m=d[k].indexOf(":");0<m&&(e[d[k].substr(0,m).toLowerCase()]=d[k].substr(m+1).trim())}d=k=vh(c);if(e["content-type"]&&/json/.test(e["content-type"]))if(A(k))d=k;else if(x(k))try{d=pe(k)}catch(n){d=k}c=new bj(sh(c),
k,e,uh(c));a&&(a.call(b,d,c),a=null)},this.e,void 0,this.d);this.b=null};uk.prototype.toString=function(){return"HTTPRequest:"+this.a};function Ej(a,b,c){this.c=u(a)?a:aj();this.a=b;this.b=c}Ej.prototype.request=function(a){if(this.a){a.headers||(a.headers={});for(var b in this.a)a.headers[b]=this.a[b]}this.b&&(a.path=this.b+a.path);return new uk(a,this.c)};function gk(a,b){this.a=a;this.b=!!b}gk.prototype.request=function(a){var b={path:a.path,method:a.method,headers:a.headers,params:a.params,body:a.body};this.b&&(b.callback=function(a,e){var f=c;f.b&&(f.b(a,gj(e)),f.b=null);f.a={tc:a,xa:e};b.callback=null});a=this.a.request(b);var c=new wk(a);return c};function wk(a){this.c=a||null}wk.prototype.execute=function(a){this.c?(this.c.execute(function(b,c){a(b,gj(c))}),this.c=null):this.a?(a(this.a.tc,gj(this.a.xa)),this.a=null):this.b=a};
function Dj(a){if(a){if(a instanceof Ej)return a;if(fa(a))return new gk({request:function(b){a(b)}},!0);if("request"in a)return new gk(a);throw new H(a+" is not a valid HTTP Client");}return null};function xk(a,b,c){vj.call(this,a,b,c)}B(xk,sk);xk.prototype.logger=I("ydn.db.sync.entry.GcsJson");xk.prototype.qa=function(a){var b=this.a,c=this;yj(this,function(d){var e={method:"GET",path:"storage/v1/b/"+b.e+"/o/"+encodeURIComponent(c.getName())};d&&(e.headers=tj(d));gapi.client.request(e).execute(function(d,e){c.d=new uj(c.key,gj(e).Ja(),b.g);d?(M(c.logger,c+": readServer updated"),c.c=d):(M(c.logger,c+": readServer request fail "+e),c.d=null,c.c=null);a.call(c,200)},e)})};function yk(a,b,c){tk.call(this,a,b,c)}B(yk,tk);l=yk.prototype;l.logger=I("ydn.db.sync.GcsJson");l.X=function(){var a=yk.l.X.call(this);a.key="name";return a};l.s=function(){if(!this.b)if(u(t.gapi))this.b=new gk(gapi.client);else throw new Vb("gapi not loaded");return yk.l.s.call(this)};l.t=function(a,b){return new xk(this,a,b)};
l.ha=function(){N(this.logger,"starting prefetch");var a=new E;G(mf(this.storage.a,this.a,null,null,1,0,!0,!1),function(b){var c={bucket:this.e};(b=b[0])&&(c.marker=b);var d=this;if(!t.gapi||t.gapi.client)throw Error("gapi lib not loaded");gapi.client.load("storage","v1",function(){var b=gapi.client.storage.objects.list({bucket:d.e});this.da&&(c.prefix=this.da);b.execute(function(b,c){if(b&&!b.error){var e=b.items||[];0<e.length?xj(d,null,e).Q(function(){a.j(!0)}):a.j(!1)}else e=d+": "+c,K(d.logger,
e),a.h(Error(e))})})},function(b){a.h(b)},this);return a};function zk(a,b,c){tk.call(this,a,b,c);this.G="full"}B(zk,tk);l=zk.prototype;l.logger=I("ydn.db.sync.GcsMeta");l.X=function(){var a=zk.l.X.call(this);a.key="name";return a};l.s=function(){!this.b&&gapi&&(this.b=new gk(gapi.client));return zk.l.s.call(this)};l.t=function(a,b){return new xk(this,a,b)};
l.ha=function(){N(this.logger,"starting prefetch");var a=new E;if(!t.gapi||!t.gapi.client)throw Error("gapi lib not loaded");var b=this;gapi.client.load("storage","v1",function(){function c(e){e&&(d.pageToken=e);gapi.client.storage.objects.list(d).execute(function(e,g){if(e&&!e.error){var h=e.items||[];if(e.nextPageToken)M(b.logger,"receiving "+h.length+" meta records, continuing next"),xj(b,h),c(e.nextPageToken);else if(0<h.length)xj(b,h).Q(function(){M(b.logger,"receiving "+h.length+" meta records, prefetching dane.");
a.j(!0)});else{var k=!!d.pageToken;M(b.logger,"prefetching done");a.j(k)}}else k=b+": "+g,K(b.logger,k),a.h(Error(k))})}var d={bucket:b.e};this.da&&(d.prefix=this.da);c()});return a};l.gb=function(a,b){if(0==a.length)b([]);else{var c=this.a,d=Oa(a,function(a){return new T(c,a)});G(Hj(this,d),function(d){for(var f=[],g=0;g<a.length;g++)f[g]=new pj(a[g],d[g],this.g,c);b(f)},function(a){K(this.logger,this+" error loading meta data "+a);b([])},this)}};function Ak(a,b,c){Cj.call(this,a,b,c)}B(Ak,Cj);Ak.prototype.Kb=function(a){return this.c+this.f+this.a+this.pa+a};Ak.prototype.logger=I("ydn.db.sync.Json");
Ak.prototype.Nb=function(a){function b(a,b){var c=new hj(e);d.s().request(c).execute(function(c){if(200==c.status){var e=(c.response instanceof Object?c.response:pe(c.responseText)).items;c=Oa(e,function(a){return a.id});for(var e=Oa(e,function(a){return a.updated}),h=[],p=[],q=[],r=0,z=0;r<=a.length&&z<c.length;){var C=qj(a[r]),D=c[z];if(r==a.length)p.push(D),z++;else{var F=sd(C,D);0==F?((D=rj(a[r]))&&e[z]&&D!=e[z]&&(new Date(e[z])>D?q.push(C):K(d.logger,'record "'+C+'" in database is more recent than server '+
D+" vs "+e[z])),r++,z++):1==F?(h.push(C),r++):(p.push(D),z++)}}Ij(d,function(){},b,p,q,h)}else K(d.logger,"Invalid response status "+c.status)})}var c=new Uc,d=this,e=this.c+this.f+this.a;a.R(function(a){Vc(c,a);this.gb(a,function(c){b(c,a)})},this)};function Bk(a,b,c){Cj.call(this,a,b,c)}B(Bk,Nj);function Ck(a,b,c){vj.call(this,a,b,c)}B(Ck,Qj);Ck.prototype.logger=I("ydn.db.sync.entry.S3Meta");function Dk(a,b,c){pk.call(this,a,b,c);this.da=c.Options.prefix;if("Key"!=b.keyPath)throw new H('s3-meta store "'+b.getName()+'" must use inline key with keyPath "Key"');this.G="meta"}B(Dk,pk);l=Dk.prototype;l.logger=I("ydn.db.sync.S3Meta");l.X=function(){var a=Dk.l.X.call(this);a.key="Key";a.modified="LastModified";a.etag="ETag";return a};l.t=function(a,b){return new Ck(this,a,b)};
l.ha=function(){function a(f){f&&(e.marker=f);c.listObjects(e).send(function(c,f){if(c){var k=d+": "+qe(c);K(d.logger,k);b.h(c instanceof Error?c:Error(k))}else{var m=f.Contents||[];f.IsTruncated?(M(d.logger,"receiving "+m.length+" meta records, continuing next"),xj(d,m),a(m[m.length-1].Key+"\uffff")):0<m.length?xj(d,m).Q(function(){M(d.logger,"receiving "+m.length+" meta records, prefetching dane.");b.j(!0)}):(k=!!e.marker,M(d.logger,"prefetching done"),b.j(k))}})}N(this.logger,"starting prefetch");
var b=new E,c=jk(this.s()),d=this,e={};this.da&&(e.prefix=this.da);a();return b};l.gb=function(){throw new Vb("loading meta data should not be necessary");};function Ek(a,b,c){vj.call(this,a,b,c)}B(Ek,bk);function Fk(a,b,c){ck.call(this,a,b,c);a=c.Options;this.ra=a.domain;this.ea=a.siteName;if(a=$d(b,"sites$parent"))Vd(a,function(a){for(var b=a.link||[],c=0;c<b.length;c++)if("http://schemas.google.com/sites/2008#parent"==b[c].rel)return b[c].href;return a.id.$t.replace(/\w+$/,"0")}),L(this.logger,"index sites$parent in "+b.getName()+" has set a generator.");if(a=$d(b,"alternate"))Vd(a,function(a){a=a.link||[];for(var b=0;b<a.length;b++)if("alternate"==a[b].rel)return a[b].href}),L(this.logger,"index alternate in "+
b.getName()+" has set a generator.")}B(Fk,ck);l=Fk.prototype;l.t=function(a,b){return new Ek(this,a,b)};l.Y=function(){var a=Fk.l.Y.call(this);return a=a.concat(["domain","siteName"])};l.W=function(){return"https://sites.google.com/feeds/content/"+this.ra+"/"+this.ea+"/"};l.ic=function(a){return"GET"!=a};
function Gk(a,b,c,d){var e={alt:"json",kind:a.e};"sites$parent"==c?(c=d.match(/\w+$/)[0],e.parent=c):"alternate"==c&&(c=d.replace(/https:\/\/sites.google.com\/a\/[^\/]+\/[^\/]+/,""),e.path=c);var f={},g=a.W();qd(b,function(c,k,m){Vc(b,c);if(k=c[0])k=gb(k,"updated","$t"),k=(new Date(1+ +new Date(k))).toISOString(),e["updated-min"]=k;k=new hj(g,"GET",e,f);a.s().request(k).execute(function(b,e){if(200==dj(e)){if(!b){var f=ej(e);x(f)&&(b=JSON.parse(f))}var g=(f=(b.feed||b).entry)?v(f)?f:[f]:[];0<g.length?
xj(a,g).Q(function(){m(g)}):m(c)}else 302==dj(e)?m(c):(f=a+": Invalid response status "+dj(e)+" for querying pageName: "+d,K(a.logger,f),m(Error(f),!0))})},a)}l.Eb=function(a,b,c){if(Kj(this))qd(a,function(d,e,f){Vc(a,d);Lj(this,function(a){!0===a?G(kf(this.storage.a,this.a,b,U.only(c),!1,0),function(a){f(a)},function(a){f(a,!0)},this):f(d)},function(a){f(a,!0)},this)},this);else return"alternate"==b||"alternate"==b?Gk(this,a,b,c):Fk.l.Eb.call(this,a,b,c)};Wd.prototype.b=null;
Z.prototype.Vb=function(a,b){var c=b.format;if("gdata-sites"==c)a.b=new Fk(this,a,b);else if("gdata"==c)a.b=new ck(this,a,b);else if("gdata-json"==c)a.b=new fk(this,a,b);else if("odata"==c)a.b=new Bk(this,a,b);else if("s3"==c)a.b=new pk(this,a,b);else if("s3-meta"==c)a.b=new Dk(this,a,b);else if("gcs"==c)a.b=new tk(this,a,b);else if("gcs-json"==c)a.b=new yk(this,a,b);else if("gcs-meta"==c)a.b=new zk(this,a,b);else if("atom"==c)a.b=new Nj(this,a,b);else if("json"==c)a.b=new Ak(this,a,b);else if("rest"==
c)a.b=new Cj(this,a,b);else throw new Tb("Sync format: "+c);ne(a,function(b,c){var f=b.Gb();if(!(this instanceof af)||this.M)if(!window.navigator||!u(window.navigator.onLine)||window.navigator.onLine)if("add"==f)f=c[1],a.b.add(b,f);else if("count"==f)c[1]||c[2]||a.b.count(b);else if("put"==f){var f=c[1],g=c[2];a.b.put(b,f,g)}else if("rm:iter"==f)g=c[1],Mj(a.b,b,g);else if("values:iter:index"==f){var f=c[1],g=c[2],h=c[3],k=c[4],m=c[5];!h&&!m&&g&&null!=g.lower&&null!=g.upper&&0==sd(g.lower,g.upper)&&
a.b.Eb(b,f,g.lower)}else if("keys"==f)g=c[1],k=c[2],h=c[3],m=c[4],a.b.keys(b,null,g,k,h,m,!1);else if("keys:iter:index"==f)f=c[1],g=c[2],k=c[3],h=c[4],m=c[5],a.b.keys(b,f,g,k,h,m,c[6]);else if("values"==f)g=c[1],k=c[2],h=c[3],m=c[4],g||m?g&&g.lower&&x(g.lower)&&g.lower==g.upper||!g&&m&&1==k&&h&&rk(a.b,b):a.b.N(b,k,h);else if(""!=f)if("get"==f)g=c[1],a.b.get(b,g);else if("values:array"==f)Jj(a.b,b,c[1]);else throw Error(f);})};function Hk(a,b,c){Z.call(this,a,b,c)}B(Hk,Z);ma("ydn.db.Storage",Hk);jj.prototype.getStatus=jj.prototype.e;jj.prototype.getClientValue=jj.prototype.c;jj.prototype.getServerValue=jj.prototype.T;ma("ydn.debug.log",function(a,b,c){a=a||"ydn";if(y(b))b=new Cc("log",b);else if(x(b)){b=b.toUpperCase();if(!Mc){Mc={};for(var d=0,e;e=Lc[d];d++)Mc[e.value]=e,Mc[e.name]=e}b=Mc[b]||null}else b=Ic;(d=I(a))?d.b=b:window.console.log("logger "+a+" not available.");u(c)?!Gi&&(a=Gi=new Ei(c),1!=a.c&&(c=Sc(),b=a.e,c.a||(c.a=[]),c.a.push(b),a.c=!0),a=Sc())&&(a.b=Fc):!Fi&&!Gi&&(a=Fi=new ti,1!=a.b&&(c=Sc(),b=a.e,c.a||(c.a=[]),c.a.push(b),a.b=!0),a=Sc())&&(a.b=Fc)});function Ik(a,b){ud.call(this);this.d=b;this.b=[];if(a>this.d)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var c=0;c<a;c++)this.b.push(this.a())}B(Ik,ud);Ik.prototype.a=function(){return{}};Ik.prototype.c=function(a){if(A(a))if(fa(a.ga))a.ga();else for(var b in a)delete a[b]};Ik.prototype.D=function(){Ik.l.D.call(this);for(var a=this.b;a.length;)this.c(a.pop());delete this.b};function Jk(){this.a=[];this.c=new cc;this.d=new cc;this.f=1;this.e=new Ik(0,4E3);this.e.a=function(){return new Kk};this.g=new Ik(0,50);this.g.a=function(){return new Lk};var a=this;this.b=new Ik(0,2E3);this.b.a=function(){return String(a.f++)};this.b.c=function(){}}I("goog.debug.Trace");function Lk(){this.time=this.count=0}Lk.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");return a.join("")};function Kk(){}
function Mk(a,b,c){var d=[];-1==b?d.push("    "):d.push(Nk(a.b-b));d.push(" ",Ok(a.b-0));0==a.a?d.push(" Start        "):1==a.a?(d.push(" Done "),d.push(Nk(a.e-a.startTime)," ms ")):d.push(" Comment      ");d.push(c,a);0<a.d&&d.push("[VarAlloc ",a.d,"] ");return d.join("")}Kk.prototype.toString=function(){return null==this.type?this.c:"["+this.type+"] "+this.c};
Jk.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.a.length;d++){var e=this.a[d];1==e.a&&c.pop();a.push(" ",Mk(e,b,c.join("")));b=e.b;a.push("\n");0==e.a&&c.push("|  ")}if(0!=this.c.r()){var f=la();a.push(" Unstopped timers:\n");bc(this.c,function(b){a.push("  ",b," (",f-b.startTime," ms, started at ",Ok(b.startTime),")\n")})}b=this.d.C();for(d=0;d<b.length;d++)c=this.d.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",0,"\n","Total comments created ",0,
"\n","Overhead start: ",0," ms\n","Overhead end: ",0," ms\n","Overhead comment: ",0," ms\n");return a.join("")};function Nk(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a}function Ok(a){a=Math.round(a);return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+a%1E3).substring(1,4)}new Jk;/*
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
function Pk(a){a.f||(a.f=new Rg);return a.f}rf.prototype.addEventListener=function(a,b,c,d){if("ready"==a)Lg(Pk(this),a,b,c,d);else{var e="created error fail ready deleted updated versionchange".split(" "),f=function(a){if(!Ta(e,a))throw new H('Invalid event type "'+a+'"');};if(w(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a);Eg(Pk(this),a,b,c,d)}};rf.prototype.removeEventListener=function(a,b,c,d){Mg(Pk(this),a,b,c,d)};rf.prototype.J=function(a){Sg(Pk(this),a)};rf.prototype.addEventListener=rf.prototype.addEventListener;rf.prototype.removeEventListener=rf.prototype.removeEventListener; 

//# sourceMappingURL=ydn.db-isw-sync-e-dev.js.map
return ydn;}, (this || {}));
            